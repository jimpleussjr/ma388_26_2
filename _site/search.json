[
  {
    "objectID": "lessons/lsn_14_logistic_regression.html",
    "href": "lessons/lsn_14_logistic_regression.html",
    "title": "MA388 Sabermetrics: Lesson 14",
    "section": "",
    "text": "Where is a pitch with location plate_x = -1 and plate_z = 2.5?"
  },
  {
    "objectID": "lessons/lsn_14_logistic_regression.html#measures-of-association-for-binary-responses",
    "href": "lessons/lsn_14_logistic_regression.html#measures-of-association-for-binary-responses",
    "title": "MA388 Sabermetrics: Lesson 14",
    "section": "Measures of Association for Binary Responses",
    "text": "Measures of Association for Binary Responses\nThe goal of our analysis is to assess the effect of the catcher on a called strike. For today’s example, let’s compare Yadier Molina and Buster Posey.\n \n\nName the response variable. Classify it as categorical or quantitative.\n\n\nName the explanatory variable. Classify it as categorical or quantitative.\n\n\nHere is summary data from May 2019 for Molina and Posey.\n\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(broom)\n\n# Retrieve pitch level data from May 2019. (See previous lesson.)\npitches &lt;- readRDS(\"statcast_may_2019.rds\")\n\n# Add catcher's name to the pitch data from the MLB master list.\n# This CSV file is available at https://www.smartfantasybaseball.com/tools/.\nmlbIDs &lt;- read_csv(\"./PLAYERIDMAP.csv\")\npitches &lt;- pitches |&gt; \n  left_join(select(mlbIDs, PLAYERNAME, MLBID),\n            by = c(\"fielder_2\" = \"MLBID\")) |&gt; \n  rename(catcher_name = PLAYERNAME)\n\n# Look only at pitches taken when Molina or Posey are catching.\npitches_taken_subset &lt;- pitches |&gt; \n  filter(catcher_name %in% c(\"Buster Posey\", \"Yadier Molina\"),\n         description %in% c(\"ball\", \"called_strike\"))\n\n# Form a 2x2 table.\npitches_taken_subset |&gt; \n  count(catcher_name, description) |&gt; \n  pivot_wider(id_cols = description, \n              names_from = catcher_name,\n              values_from = n) |&gt; \n  kable(caption = \"Results of taken pitches (May 2019)\")\n\n\nResults of taken pitches (May 2019)\n\n\ndescription\nBuster Posey\nYadier Molina\n\n\n\n\nball\n775\n1007\n\n\ncalled_strike\n364\n533\n\n\n\n\n\n\nCalculate the proportion of called strikes for each catcher.\n\n\nCalculate the odds of a called strike for each catcher.\n\n\nCalculate the log odds of a called strike for each catcher.\n\n\nCalculate the odds ratio for a called strike comparing Yadier Molina to Buster Posey.\n\n\nWhat are the limitations of this analysis in assessing the effect of catcher on called strikes? What are we failing to consider, and how might a model-based approach improve our analysis?"
  },
  {
    "objectID": "lessons/lsn_14_logistic_regression.html#logistic-regression",
    "href": "lessons/lsn_14_logistic_regression.html#logistic-regression",
    "title": "MA388 Sabermetrics: Lesson 14",
    "section": "Logistic Regression",
    "text": "Logistic Regression\nConsider the results in Table 1 again. We can apply the following logistic regression model to our data. Let \\(Y_i\\) be a random variable for whether pitch \\(i\\) was a called strike such that \\(Y_i \\sim \\text{Bernoulli}(\\pi_i)\\) and\n\\[\\log\\left(\\frac{\\pi_i}{1-\\pi_i}\\right) = \\beta_0 + \\beta_1 \\text{Molina}_i\\] where \\(\\text{Molina}_i = 1\\) if Yadier Molina was the catcher and \\(\\text{Molina}_i = 0\\) if Buster Posey was the catcher.\nDiscuss each component of the model above.\n\n\\(Y_i \\sim \\text{Bernoulli}(\\pi_i)\\)\n\n\n\\(\\log\\left(\\frac{\\pi_i}{1-\\pi_i}\\right) = \\beta_0 + \\beta_1 \\text{Molina}_i\\)\n\n\nInterpret \\(\\beta_0\\).\n\n\nInterpret \\(\\beta_1\\).\n\nLet’s fit the model above.\n\npitches_taken_subset |&gt; \n  glm(description == \"called_strike\" ~ catcher_name, \n      data = _,\n      family = \"binomial\") |&gt; \n  tidy() |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\nterm\nestimate\nstd.error\nstatistic\np.value\n\n\n\n\n(Intercept)\n-0.7557092\n0.0635419\n-11.89308\n0.0000000\n\n\ncatcher_nameYadier Molina\n0.1194997\n0.0831071\n1.43790\n0.1504626\n\n\n\n\n\nBased on this model, is there evidence Molina has more called strikes in the long term?\n\n\n\n\n\nBased on this model, is there evidence Molina caused the increase in called strikes (for example, by framing pitches)?\n\n\n\n\n\nName other variables to control for to provide stronger evidence Molina caused the increase.\n\n\n\n\n\nExplain why count might be a confounder of the relationship between catcher and called strikes.\n\n\n\n\n\nLet’s investigate how strong these relationships are:\n\npitches_taken_subset &lt;- pitches_taken_subset |&gt; \n  mutate(count = paste(balls,strikes, sep = \"-\"))\n\npitches_taken_subset |&gt; \n  count(catcher_name, count) |&gt; \n  group_by(catcher_name) |&gt; \n  mutate(prop = n/sum(n)) |&gt; \n  pivot_wider(id_cols = count, names_from = catcher_name, values_from = prop) |&gt; \n  kable(digits = 3)\n\n\n\n\ncount\nBuster Posey\nYadier Molina\n\n\n\n\n0-0\n0.330\n0.347\n\n\n0-1\n0.140\n0.123\n\n\n0-2\n0.066\n0.060\n\n\n1-0\n0.103\n0.111\n\n\n1-1\n0.090\n0.084\n\n\n1-2\n0.075\n0.066\n\n\n2-0\n0.031\n0.039\n\n\n2-1\n0.043\n0.051\n\n\n2-2\n0.066\n0.059\n\n\n3-0\n0.012\n0.016\n\n\n3-1\n0.010\n0.023\n\n\n3-2\n0.035\n0.022\n\n\n\n\npitches_taken_subset |&gt; \n  count(description, count) |&gt; \n  group_by(count) |&gt; \n  mutate(prop = n/sum(n)) |&gt; \n  pivot_wider(id_cols = description, names_from = count, values_from = prop) |&gt; \n  kable(digits = 3)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndescription\n0-0\n0-1\n0-2\n1-0\n1-1\n1-2\n2-0\n2-1\n2-2\n3-0\n3-1\n3-2\n\n\n\n\nball\n0.528\n0.748\n0.922\n0.604\n0.766\n0.882\n0.4\n0.701\n0.855\n0.205\n0.652\n0.865\n\n\ncalled_strike\n0.472\n0.252\n0.078\n0.396\n0.234\n0.118\n0.6\n0.299\n0.145\n0.795\n0.348\n0.135\n\n\n\n\n\nNext, let’s adjust for count in our model for called strikes. Here is the updated model.\n\\[\\log\\left(\\frac{\\pi_i}{1-\\pi_i}\\right) = \\beta_0 + \\beta_1 \\text{Molina}_i + \\beta_2\\text{count0-1}_i + \\ldots + \\beta_{12}\\text{count3-2}_i\\]\nwhere \\(\\text{countX-Y}\\) is an indicator of whether the pitch had X balls and Y strikes.\n\npitches_taken_subset |&gt; \n  glm(description == \"called_strike\" ~ catcher_name + count, \n      data = _,\n      family = \"binomial\") |&gt; \n  tidy() |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\nterm\nestimate\nstd.error\nstatistic\np.value\n\n\n\n\n(Intercept)\n-0.1429731\n0.0843064\n-1.6958749\n0.0899096\n\n\ncatcher_nameYadier Molina\n0.0525685\n0.0884053\n0.5946308\n0.5520903\n\n\ncount0-1\n-0.9728490\n0.1400530\n-6.9462937\n0.0000000\n\n\ncount0-2\n-2.3582783\n0.2963634\n-7.9573883\n0.0000000\n\n\ncount1-0\n-0.3111663\n0.1375763\n-2.2617723\n0.0237115\n\n\ncount1-1\n-1.0737305\n0.1690577\n-6.3512664\n0.0000000\n\n\ncount1-2\n-1.8946577\n0.2365813\n-8.0084856\n0.0000000\n\n\ncount2-0\n0.5153006\n0.2197385\n2.3450634\n0.0190238\n\n\ncount2-1\n-0.7404951\n0.2048653\n-3.6145463\n0.0003009\n\n\ncount2-2\n-1.6638610\n0.2304900\n-7.2187982\n0.0000000\n\n\ncount3-0\n1.4640085\n0.4021148\n3.6407728\n0.0002718\n\n\ncount3-1\n-0.5257107\n0.3170033\n-1.6583763\n0.0972415\n\n\ncount3-2\n-1.7377286\n0.3466271\n-5.0132513\n0.0000005\n\n\n\n\n\nBased on this count-adjusted model, is there evidence Molina has more called strikes in the long term?"
  },
  {
    "objectID": "lessons/textbook_toc.html",
    "href": "lessons/textbook_toc.html",
    "title": "textbook summary",
    "section": "",
    "text": "1  The Baseball Datasets\n\n1.1 Introduction\n1.2 The Lahman Database: Season-by-Season Data\n1.3 Retrosheet Game-by-Game Data\n1.4 Retrosheet Play-by-Play Data\n1.5 Pitch-by-Pitch Data\n1.6 Player Movement and Off-the-Bat Data\n1.7 Data Used in this Book\n1.8 Summary\n1.9 Further Reading\n1.10 Exercises\n\n2  Introduction to R\n\n2.1 Introduction\n2.2 Installing R and RStudio\n2.3 The Tidyverse\n2.4 Data Frames\n2.5 Vectors\n2.6 Objects and Containers in R\n2.7 Collection of R Commands\n2.8 Reading and Writing Data in R\n2.9 Packages\n2.10 Splitting, Applying, and Combining Data\n2.11 Getting Help\n2.12 Further Reading\n2.13 Exercises\n\n3  Graphics\n\n3.1 Introduction\n3.2 Character Variable\n3.3 Saving Graphs\n3.4 Numeric Variable: One-Dimensional Scatterplot and Histogram\n3.5 Two Numeric Variables\n3.6 A Numeric Variable and a Factor Variable\n3.7 Comparing Ruth, Aaron, Bonds, and A-Rod\n3.8 The 1998 Home Run Race\n3.9 Further Reading\n3.10 Exercises\n\n4  The Relation Between Runs and Wins\n\n4.1 Introduction\n4.2 The Teams Table in the Lahman Database\n4.3 Linear Regression\n4.4 The Pythagorean Formula for Winning Percentage\n4.5 How Many Runs for a Win?\n4.6 Further Reading\n4.7 Exercises\n\n5  Value of Plays Using Run Expectancy\n\n5.1 The Run Expectancy Matrix\n5.2 Runs Scored in the Remainder of the Inning\n5.3 Creating the Matrix\n5.4 Measuring Success of a Batting Play\n5.5 José Altuve\n5.6 Opportunity and Success for All Hitters\n5.7 Position in the Batting Lineup\n5.8 Run Values of Different Base Hits\n5.9 Value of Base Stealing\n5.10 Further Reading and Software\n5.11 Exercises\n\n6  Balls and Strikes Effects\n\n6.1 Introduction\n6.2 Hitter’s Counts and Pitcher’s Counts\n6.3 Behaviors by Count\n6.4 Further Reading\n6.5 Exercises\n\n7  Catcher Framing\n\n7.1 Introduction\n7.2 Acquiring Pitch-Level Data\n7.3 Where Is the Strike Zone?\n7.4 Modeling Called Strike Percentage\n7.5 Modeling Catcher Framing\n7.6 Further Reading\n7.7 Exercises\n\n8  Career Trajectories\n\n8.1 Introduction\n8.2 Mickey Mantle’s Batting Trajectory\n8.3 Comparing Trajectories\n8.4 General Patterns of Peak Ages\n8.5 Trajectories and Fielding Position\n8.6 Further Reading\n8.7 Exercises\n\n9  Simulation\n\n9.1 Introduction\n9.2 Simulating a Half Inning\n9.3 Simulating a Baseball Season\n9.4 Further Reading\n9.5 Exercises\n\n10  Exploring Streaky Performances\n\n10.1 Introduction\n10.2 The Great Streak\n10.3 Streaks in Individual At-Bats\n10.4 Local Patterns of Statcast Launch Velocity\n10.5 Further Reading\n10.6 Exercises\n\n11  Using a Database to Compute Park Factors\n\n11.1 Introduction\n11.2 Installing MySQL and Creating a Database\n11.3 Connecting R to MySQL\n11.4 Filling a MySQL Game Log Database from R\n11.5 Querying Data from R\n11.6 Building Your Own Baseball Database\n11.7 Calculating Basic Park Factors\n11.8 Further Reading\n11.9 Exercises\n\n12  Working with Large Data\n\n12.1 Introduction\n12.2 Acquiring a Year’s Worth of Statcast Data\n12.3 Storing Large Data Efficiently\n12.4 Performance Comparison\n12.5 Launch Angles and Exit Velocities, Revisited\n12.6 Further Reading\n12.7 Exercises\n\n13  Home Run Hitting\n\n13.1 Introduction\n13.2 Exploring a Season of Home Run Hitting\n13.3 Comparing Home Run Hitting in the 2021 and 2023 Seasons\n13.4 Further Reading\n13.5 Exercises\n\n14  Making a Scientific Presentation using Quarto\n\n14.1 Introduction to Slides in Quarto\n14.2 Example: Jim’s Presentation on Home Run Hitting\n14.3 Alternative Output Formats\n14.4 Further Reading\n14.5 Exercises\n\n15  Using Shiny for Baseball Applications\n\n15.1 Introduction\n15.2 Comparing Two Pitcher Trajectories\n15.3 Creating the Shiny App\n15.4 Sharing the App\n15.5 Tips for Getting Started Making Apps\n15.6 Further Reading\n15.7 Exercises\n\nAppendices\n\nA  Retrosheet Files Reference\nB  Historical Notes on PITCHf/x Data\nC  Statcast Data Reference\nReferences\n\n\nProblem Set descriptions:\n\nData set exploration and dplyr functions\nPlotting career trajectories\nRegression of Win% vs run differential\nSacrifice Bunt"
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html",
    "href": "lessons/lsn_8_runs_and_wins_II.html",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "",
    "text": "library(tidyverse)\nlibrary(Lahman)\nlibrary(knitr)\nlibrary(ggrepel)\nlibrary(broom)"
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html#review",
    "href": "lessons/lsn_8_runs_and_wins_II.html#review",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "Review",
    "text": "Review\nIn our last lesson, we discussed the following model:\n\\(Wins_i = \\beta_0 + \\beta_1 RD_i + \\epsilon_i \\quad \\epsilon_i \\sim \\text{Normal}\\left(0,\\sigma^2\\right)\\)\nwhere \\(Wins_i\\) and \\(RD_i\\) are the wins and run differential for team \\(i\\).\nInterpret the coefficients in this model."
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html#pythagorean-models",
    "href": "lessons/lsn_8_runs_and_wins_II.html#pythagorean-models",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "Pythagorean Models",
    "text": "Pythagorean Models\nDiscuss limitations for the regression model above.\n\n\n\n\n\nHere are three models:\n\\[\\begin{align}\nWpct &= \\beta_0 + \\beta_1 RD + \\epsilon \\\\\nWpct &= \\frac{R^2}{R^2 + RA^2} + \\epsilon \\\\\nWpct &= \\frac{R^k}{R^k + RA^k} + \\epsilon\n\\end{align}\\]\nwhere \\(Wpct\\) is Win Percentage, \\(R\\) is Runs Scored, \\(RA\\) is Runs Allowed, and \\(\\epsilon\\) is the random error. Recall that we fit Model 1 to the 1997-2001 seasons.\nBriefly discuss the strengths/limitations of each model.\n\n\n\n\n\nHow would you assess which model is the best? Please be specific."
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html#model-2-pythagorean-formula-bill-james",
    "href": "lessons/lsn_8_runs_and_wins_II.html#model-2-pythagorean-formula-bill-james",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "Model 2: Pythagorean Formula (Bill James)",
    "text": "Model 2: Pythagorean Formula (Bill James)\nFirst, let’s create a function to calculate the expected wins under a Pythagorean Formula.\n\n# Function to calculate expected wins using Pythagorean formula.\n# Arguments:\n# R - runs scored\n# RA - runs allowed\n# k - exponent\n# Value Returned:\n# expected win percentage\n\npyth_wins &lt;- function(R, RA, k = 2){\n  return(R^k/(R^k + RA^k))\n}\n\nUsing Model 2, let’s calculate the expected number of wins for each team (1997-2001).\n\nmy_teams = Teams |&gt;\n  filter(yearID &gt;= 1997, yearID &lt;= 2001) |&gt;\n  mutate(RD = R - RA,\n         Wpct = W/(W+L),\n         Wpct_pyth2 = pyth_wins(R,RA,2))\n\nNext, let’s compare graphically the predictions from Model 1 and 2.\n\n# Get predicted win percentages from Model 1.\n\nlin_fit &lt;- lm(Wpct ~ RD, data = my_teams)\nmy_teams &lt;- augment(lin_fit, data = my_teams)\n\n# Plot Model 1 and Model 2 predictions.\n\nmy_teams |&gt;\n  ggplot(aes(x = RD, y = .fitted)) + \n  geom_point(col = \"red\") +\n  # geom_point(aes(x = RD, y = Wpct)) +\n  geom_point(aes(x = RD, y = Wpct_pyth2)) +\n  labs(x = \"Run Differential\",\n       y = \"Win Percentage\",\n       title = \"Predicted Win Percentage - Models 1 and 2 (1997-2001)\")\n\n\n\n\n\n\n\nsummary(lin_fit)\n\n\nCall:\nlm(formula = Wpct ~ RD, data = my_teams)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.063492 -0.014889  0.001682  0.014852  0.060984 \n\nCoefficients:\n             Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) 5.000e-01  1.888e-03  264.85   &lt;2e-16 ***\nRD          5.994e-04  1.662e-05   36.06   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.02297 on 146 degrees of freedom\nMultiple R-squared:  0.8991,    Adjusted R-squared:  0.8984 \nF-statistic:  1301 on 1 and 146 DF,  p-value: &lt; 2.2e-16\n\n\nBriefly discuss how the models differ. \n\n\n\n\n\nNext, let’s compare the root mean square error (RMSE). Write an equation for the RMSE. \n\n\n\n\n\n\n# Model 1 RMSE\nsqrt(mean(my_teams$.resid^2))\n\n[1] 0.0228099\n\n# Note this is very close to the Residual Standard Error you could obtain from the model.\nsummary(lin_fit)$sigma\n\n[1] 0.02296561\n\n# Model 2 RMSE\n# Calculate residuals.\nmy_teams = my_teams |&gt;\n  mutate(.resid_pyth2 = Wpct - Wpct_pyth2)\n# Calculate RMSE for Model 2\nsqrt(mean(my_teams$.resid_pyth2^2))\n\n[1] 0.023058\n\n\nNext, let’s take a look at the residuals from Model 2.\n\n# Let's look at a summary of the residuals (min, max, mean, and quartiles).\nmy_teams |&gt;\n  pull(.resid_pyth2) |&gt; \n  summary()\n\n      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. \n-0.0659548 -0.0153919  0.0014263 -0.0001182  0.0158258  0.0612624 \n\nmy_teams |&gt;\n  ggplot(aes(x = Wpct,\n             y = .resid_pyth2)) +\n  geom_point() +\n  labs(x = \"Win Percentage\", y = \"Residuals\",\n       title = \"Residuals vs. Win Percentage (Model 2)\")\n\n\n\n\n\n\n\n\nNext, let’s try Model 3.\nHow do we find an estimate of \\(k\\) in Model 3? \n\n\n\n\n\n\nmy_teams = my_teams |&gt;\n  mutate(logWratio = log(W/L),\n         logRratio = log(R/RA))\n\n# Including 0 in formula means we don't include an intercept.\npythFit &lt;- lm(logWratio ~ 0 + logRratio, data = my_teams)\npythFit\n\n\nCall:\nlm(formula = logWratio ~ 0 + logRratio, data = my_teams)\n\nCoefficients:\nlogRratio  \n    1.904  \n\n\nWhy don’t we want an intercept in this model? (Warning: this is very unusual!) \n\nk = pythFit$coefficients[1]\n\n# Get predictions.\nmy_teams = my_teams |&gt;\n  mutate(Wpct_pyth_k = pyth_wins(R,RA,k = k))\n\n# Get residuals.\nmy_teams = my_teams |&gt;\n  mutate(.resid_pyth_k = Wpct - Wpct_pyth_k)\n\n# Calculate RMSE.\nsqrt(mean(my_teams$.resid_pyth_k^2))\n\n[1] 0.02279093\n\n\n\nmy_teams |&gt;\n  pull(.resid_pyth_k) |&gt; \n  summary()\n\n      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. \n-0.0677086 -0.0162629  0.0011648 -0.0001293  0.0139919  0.0609875 \n\nmy_teams |&gt;\n  ggplot(aes(x = Wpct,\n             y = .resid_pyth_k)) +\n  geom_point() +\n  labs(x = \"Win Percentage\", y = \"Residuals\",\n       title = \"Residuals vs. Win Percentage (Model 3)\") + \n  geom_smooth(method = \"lm\")\n\n\n\n\n\n\n\n\n\nmy_teams |&gt; \n  lm(.resid_pyth_k ~ Wpct, data = _) |&gt; \n  summary()\n\n\nCall:\nlm(formula = .resid_pyth_k ~ Wpct, data = my_teams)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.060232 -0.013571  0.001806  0.013704  0.060461 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -0.04941    0.01261  -3.917 0.000137 ***\nWpct         0.09857    0.02497   3.947 0.000122 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.02181 on 146 degrees of freedom\nMultiple R-squared:  0.09643,   Adjusted R-squared:  0.09024 \nF-statistic: 15.58 on 1 and 146 DF,  p-value: 0.0001225"
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html#how-many-runs-for-a-win-pg.-106",
    "href": "lessons/lsn_8_runs_and_wins_II.html#how-many-runs-for-a-win-pg.-106",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "How many runs for a win? (pg. 106)",
    "text": "How many runs for a win? (pg. 106)\nPreviously, we learned about the “10-for-1” rule of thumb (number of required runs scored for one additional win) using Model 1. Using Model 2, this quantity changes based on runs allowed. How can we find an expression for the number of required runs scored for one additional win?\n\n\n\n\n\nLet’s explore this for various combinations of runs scored and runs allowed. (Note \\(R\\) and \\(RA\\) below are runs scored per game and runs allowed per game.)\n\n# Function to compute incremental runs per win.\nIR &lt;- function(R = 5, RA = 5){\n  (R^2 + RA^2)^2 /(2*R*RA^2)\n}\n\nir_table &lt;- expand.grid(R = seq(3,6,0.5),\n                        RA = seq(3,6,0.5))\n\nir_table |&gt; \n  mutate(IRW = IR(R,RA)) |&gt;\n  spread(key = RA, value = IRW, sep = \"=\") |&gt;\n  round(1)\n\n    R RA=3 RA=3.5 RA=4 RA=4.5 RA=5 RA=5.5 RA=6\n1 3.0  6.0    6.1  6.5    7.0  7.7    8.5  9.4\n2 3.5  7.2    7.0  7.1    7.5  7.9    8.5  9.2\n3 4.0  8.7    8.1  8.0    8.1  8.4    8.8  9.4\n4 4.5 10.6    9.6  9.1    9.0  9.1    9.4  9.8\n5 5.0 12.8   11.3 10.5   10.1 10.0   10.1 10.3\n6 5.5 15.6   13.4 12.2   11.4 11.1   11.0 11.1\n7 6.0 18.8   15.8 14.1   13.0 12.4   12.1 12.0\n\n\nHow do the results of Model 2 compare to Model 1 (the “10-for-1” model) in terms of incremental runs per win?"
  },
  {
    "objectID": "lessons/lsn_5_r_graphics_II.html",
    "href": "lessons/lsn_5_r_graphics_II.html",
    "title": "MA388 Sabermetrics: Lesson 5",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)\nReview:\nI found the plot below here. Let’s recreate it! You can get part of the way there with what you already know.\nIt will help you to know the dates that correspond to the beginning of different eras:\nFirst, obtain the top-10 HR hitters for each year from 1900 to the present.\nLet’s plot what we have to far.\nNot let’s figure out how to color the points by era. We’ll need to introduce a factor variable that represents dates according to their corresponding eras. See the example in ABDWR section 3.2.1 for an example of the cut() function.\nbatting_df &lt;- batting_df |&gt; \n  mutate(era = cut(yearID,\n                   breaks = c(1899, 1919, 1941, 1960, 1976, \n                              1993, 2003, 2050),\n                   labels = c(\"Dead Ball\", \"Lively Ball\", \"Integration\",\n                              \"Expansion\", \"Free Agency\", \"Steroid\",\n                              \"Long Ball\")\n  )\n  )\nLet’s see a sample of what our data frame looks like now:\nbatting_df |&gt; \n  slice_sample(n = 10)\n\n   yearID HR         era\n1    1967 44   Expansion\n2    2001 49     Steroid\n3    1934 26 Lively Ball\n4    1920 11 Lively Ball\n5    1927 17 Lively Ball\n6    1935 25 Lively Ball\n7    1983 39 Free Agency\n8    1922 17 Lively Ball\n9    2024 39   Long Ball\n10   2020 17   Long Ball\nReady to add the color?"
  },
  {
    "objectID": "lessons/lsn_5_r_graphics_II.html#clemens-and-schilling",
    "href": "lessons/lsn_5_r_graphics_II.html#clemens-and-schilling",
    "title": "MA388 Sabermetrics: Lesson 5",
    "section": "Clemens and Schilling",
    "text": "Clemens and Schilling\n\n\n\nRoger Clemens\n\n\n\n\n\nCurt Schilling\n\n\nFirst, let’s create a data set containing all pitchers with an indicator of whether they are in the Hall of Fame.\n\n# Get career wins, earned run average, and strikeouts.\ncareers &lt;- Pitching |&gt; \n  group_by(playerID) |&gt; \n  summarize(W = sum(W),\n            ER = sum(ER),\n            IPouts = sum(IPouts),\n            SO = sum(SO)) |&gt; \n  mutate(ERA = 9*ER/(IPouts/3)) |&gt; \n  filter(IPouts/3 &gt; 500)\n\n# Add whether they were inducted in the Hall of Fame.\ncareers &lt;- HallOfFame |&gt; \n  filter(inducted == \"Y\",\n         category == \"Player\") |&gt; \n  select(playerID, inducted) |&gt; \n  right_join(careers) |&gt; \n  mutate(inducted = replace_na(inducted,\"N\"))\n\nLet’s look at career strikeouts by whether or not they were inducted.\n\ncareers |&gt; \n  ggplot(aes(x = SO, y = ERA, color = inducted)) +\n  geom_point(size = 1)\n\n\n\n\n\n\n\n\nLet’s figure out where Clemens and Schilling are.\n\nlibrary(ggrepel)\nclemschil &lt;- careers |&gt; \n  filter(playerID %in% c(\"clemero02\", \"schilcu01\")) \n\ncareers |&gt; \n  ggplot(aes(x = SO, y = ERA, color = inducted)) +\n  geom_point() +\n  geom_text_repel(data = clemschil, \n                  aes(x = SO, y = ERA, label = playerID),\n                  show.legend = FALSE)\n\n\n\n\nERA vs. SO by Hall of Fame status for pitchers with at least 500 innings pitched."
  },
  {
    "objectID": "lessons/lsn_5_r_graphics_II.html#your-turn",
    "href": "lessons/lsn_5_r_graphics_II.html#your-turn",
    "title": "MA388 Sabermetrics: Lesson 5",
    "section": "Your Turn",
    "text": "Your Turn\nIn the last figure, there is an uninducted player with about 2500 strikeouts and a 2.5 ERA. Determine who that player is and add his playerID to the plot above."
  },
  {
    "objectID": "lessons/lsn_3_intro_to_R_II.html",
    "href": "lessons/lsn_3_intro_to_R_II.html",
    "title": "MA388 Sabermetrics: Lesson 3",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)"
  },
  {
    "objectID": "lessons/lsn_3_intro_to_R_II.html#review",
    "href": "lessons/lsn_3_intro_to_R_II.html#review",
    "title": "MA388 Sabermetrics: Lesson 3",
    "section": "Review",
    "text": "Review\nKey Concepts\n\nfive tidyverse verbs\nrelational databases\n\nReview Questions\n\nUsing the Teams data frame, calculate average wins (W) per season for each MLB team from 2000-present. Order your results from the best teams to the worst.\n\n\n\n\n\n\nteamID\nW\nG\nWpct\n\n\n\n\nNYA\n2286\n3946\n0.579\n\n\nLAN\n2239\n3948\n0.567\n\n\nSLN\n2179\n3945\n0.552\n\n\nATL\n2152\n3945\n0.546\n\n\nBOS\n2145\n3947\n0.543\n\n\nANA\n425\n810\n0.525\n\n\nSFN\n2052\n3946\n0.520\n\n\nCLE\n2046\n3945\n0.519\n\n\nOAK\n2030\n3946\n0.514\n\n\nHOU\n2029\n3947\n0.514\n\n\nLAA\n1609\n3138\n0.513\n\n\nPHI\n2019\n3947\n0.512\n\n\nMIN\n1984\n3949\n0.502\n\n\nTOR\n1977\n3947\n0.501\n\n\nNYN\n1976\n3946\n0.501\n\n\nSEA\n1975\n3948\n0.500\n\n\nCHN\n1969\n3947\n0.499\n\n\nTBA\n1959\n3946\n0.496\n\n\nMIL\n1960\n3949\n0.496\n\n\nFLO\n963\n1942\n0.496\n\n\nTEX\n1937\n3949\n0.491\n\n\nARI\n1922\n3948\n0.487\n\n\nCHA\n1911\n3948\n0.484\n\n\nWAS\n1510\n3136\n0.482\n\n\nSDN\n1888\n3949\n0.478\n\n\nCIN\n1861\n3950\n0.471\n\n\nDET\n1841\n3943\n0.467\n\n\nCOL\n1809\n3949\n0.458\n\n\nBAL\n1805\n3948\n0.457\n\n\nMON\n368\n810\n0.454\n\n\nPIT\n1767\n3944\n0.448\n\n\nKCA\n1737\n3948\n0.440\n\n\nMIA\n868\n2002\n0.434\n\n\n\n\n\n\nUsing the Teams data frame, calculate how many World Series titles (WSWin) each team had during this period and add this information to your table in the previous question.\n\n\n\n\nWin Percentage and World Series Titles by Team (2000-present).\n\n\nteamID\nW\nG\nWpct\nWSWins\n\n\n\n\nNYA\n2286\n3946\n0.579\n2\n\n\nLAN\n2239\n3948\n0.567\n2\n\n\nSLN\n2179\n3945\n0.552\n2\n\n\nATL\n2152\n3945\n0.546\n1\n\n\nBOS\n2145\n3947\n0.543\n4\n\n\nANA\n425\n810\n0.525\n1\n\n\nSFN\n2052\n3946\n0.520\n3\n\n\nCLE\n2046\n3945\n0.519\n0\n\n\nOAK\n2030\n3946\n0.514\n0\n\n\nHOU\n2029\n3947\n0.514\n2\n\n\nLAA\n1609\n3138\n0.513\n0\n\n\nPHI\n2019\n3947\n0.512\n1\n\n\nMIN\n1984\n3949\n0.502\n0\n\n\nTOR\n1977\n3947\n0.501\n0\n\n\nNYN\n1976\n3946\n0.501\n0\n\n\nSEA\n1975\n3948\n0.500\n0\n\n\nCHN\n1969\n3947\n0.499\n1\n\n\nTBA\n1959\n3946\n0.496\n0\n\n\nMIL\n1960\n3949\n0.496\n0\n\n\nFLO\n963\n1942\n0.496\n1\n\n\nTEX\n1937\n3949\n0.491\n1\n\n\nARI\n1922\n3948\n0.487\n1\n\n\nCHA\n1911\n3948\n0.484\n1\n\n\nWAS\n1510\n3136\n0.482\n1\n\n\nSDN\n1888\n3949\n0.478\n0\n\n\nCIN\n1861\n3950\n0.471\n0\n\n\nDET\n1841\n3943\n0.467\n0\n\n\nCOL\n1809\n3949\n0.458\n0\n\n\nBAL\n1805\n3948\n0.457\n0\n\n\nMON\n368\n810\n0.454\n0\n\n\nPIT\n1767\n3944\n0.448\n0\n\n\nKCA\n1737\n3948\n0.440\n1\n\n\nMIA\n868\n2002\n0.434\n0"
  },
  {
    "objectID": "lessons/lsn_3_intro_to_R_II.html#introduction-to-r-day-2",
    "href": "lessons/lsn_3_intro_to_R_II.html#introduction-to-r-day-2",
    "title": "MA388 Sabermetrics: Lesson 3",
    "section": "Introduction to R (Day 2)",
    "text": "Introduction to R (Day 2)\n\nSplit, Apply, and Combine Data\nIt’s important in data science to be able to write procedures and apply them over a data set. The Marchi text refers to this as “splitting, applying, and combining data.” In other words, we split a data frame into pieces, apply a procedure or function to each piece, and then combine the results into a new data frame.\nWays to “split, apply, and combine”…\n\ngroup_by() and summarize() functions\nsplit() and map_df() functions\n\nIn general, these coding tasks involve three steps:\n\nWrite a function to perform the task on one split of the data.\nSplit the data on a variable.\nApply the function to each split of the data.\n\n\n\nExample\n\nThree steps:\n\nWrite a function that takes a data frame and returns the team with the most wins and whether they won the World Series.\nSplit the data frame on yearID.\nApply the function to each split.\n\n\n# Step 1 - Write a function.\nmostWins &lt;- function(data){\n  data |&gt; \n    arrange(-W) |&gt; \n    select(teamID, W, WSWin) |&gt; \n    head(1)\n}\n\n# Steps 2 and 3 - Split and apply.\nwinLeaders &lt;- Teams |&gt; \n  filter(yearID &gt;= 2000) |&gt; \n  split(~yearID) |&gt;\n  map_df(mostWins, .id = \"yearID\")\n\nwinLeaders |&gt; \n  kable(caption = \"Major League win leaders by season and whether they won the World Series.\")\n\n\nMajor League win leaders by season and whether they won the World Series.\n\n\nyearID\nteamID\nW\nWSWin\n\n\n\n\n2000\nSFN\n97\nN\n\n\n2001\nSEA\n116\nN\n\n\n2002\nNYA\n103\nN\n\n\n2003\nATL\n101\nN\n\n\n2004\nSLN\n105\nN\n\n\n2005\nSLN\n100\nN\n\n\n2006\nNYN\n97\nN\n\n\n2007\nBOS\n96\nY\n\n\n2008\nLAA\n100\nN\n\n\n2009\nNYA\n103\nY\n\n\n2010\nPHI\n97\nN\n\n\n2011\nPHI\n102\nN\n\n\n2012\nWAS\n98\nN\n\n\n2013\nBOS\n97\nY\n\n\n2014\nLAA\n98\nN\n\n\n2015\nSLN\n100\nN\n\n\n2016\nCHN\n103\nY\n\n\n2017\nLAN\n104\nN\n\n\n2018\nBOS\n108\nY\n\n\n2019\nHOU\n107\nN\n\n\n2020\nLAN\n43\nY\n\n\n2021\nSFN\n107\nN\n\n\n2022\nLAN\n111\nN\n\n\n2023\nATL\n104\nN\n\n\n2024\nLAN\n98\nY\n\n\n\n\n\n\n\n\nYour Turn\n\n\n\n\nMajor League win leaders by season and whether they won the World Series.\n\n\nyearID\nname\nHR\n\n\n\n\n2000\nHouston Astros\n249\n\n\n2001\nTexas Rangers\n246\n\n\n2002\nTexas Rangers\n230\n\n\n2003\nTexas Rangers\n239\n\n\n2004\nChicago White Sox\n242\n\n\n2005\nTexas Rangers\n260\n\n\n2006\nChicago White Sox\n236\n\n\n2007\nMilwaukee Brewers\n231\n\n\n2008\nChicago White Sox\n235\n\n\n2009\nNew York Yankees\n244\n\n\n2010\nToronto Blue Jays\n257\n\n\n2011\nNew York Yankees\n222\n\n\n2012\nNew York Yankees\n245\n\n\n2013\nBaltimore Orioles\n212\n\n\n2014\nBaltimore Orioles\n211\n\n\n2015\nToronto Blue Jays\n232\n\n\n2016\nBaltimore Orioles\n253\n\n\n2017\nNew York Yankees\n241\n\n\n2018\nNew York Yankees\n267\n\n\n2019\nMinnesota Twins\n307\n\n\n2020\nLos Angeles Dodgers\n118\n\n\n2021\nToronto Blue Jays\n262\n\n\n2022\nNew York Yankees\n254\n\n\n2023\nAtlanta Braves\n307\n\n\n2024\nNew York Yankees\n237\n\n\n\n\n\nWhat’s the difference between select() and pull()? One key difference is they return different data types.\n\nHRLeaders |&gt; \n  select(yearID)\n\n   yearID\n1    2000\n2    2001\n3    2002\n4    2003\n5    2004\n6    2005\n7    2006\n8    2007\n9    2008\n10   2009\n11   2010\n12   2011\n13   2012\n14   2013\n15   2014\n16   2015\n17   2016\n18   2017\n19   2018\n20   2019\n21   2020\n22   2021\n23   2022\n24   2023\n25   2024\n\nHRLeaders |&gt; \n  pull(yearID)\n\n [1] \"2000\" \"2001\" \"2002\" \"2003\" \"2004\" \"2005\" \"2006\" \"2007\" \"2008\" \"2009\"\n[11] \"2010\" \"2011\" \"2012\" \"2013\" \"2014\" \"2015\" \"2016\" \"2017\" \"2018\" \"2019\"\n[21] \"2020\" \"2021\" \"2022\" \"2023\" \"2024\""
  },
  {
    "objectID": "lessons/lsn_1_course_intro.html",
    "href": "lessons/lsn_1_course_intro.html",
    "title": "MA388 Sabermetrics: Lesson 1",
    "section": "",
    "text": "Contact Information\nLTC Jim Pleuss\njames.pleuss@westpoint.edu\nThayer Hall Room 233\n845-938-7675\nPACE: email, Teams, drop-in, phone\n\n\nCourse Overview\nSabermetrics\n\nCourse Texts/Videos/Blogs\nHands-on/Interactive\nR/RStudio\nCalendar Overview\nGraded Events (Problem Sets and Project)\n\n\n\nIntroductions\nAt some point this semester everyone in this room will be graded on their ability to name everyone else in this room from memory. Start learning names today.\nPlease tell us your:\n\nPreferred Name\nHometown\nMajor\nBranch/Desired Branch\nActivities (Sports, Clubs, Interests)\nUnique Skill / Random Fact\nSong (title and artist) that ups your mood anytime you hear it.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDAW, Section Marcher Role\nBottom line: Do the right thing. I don’t want to have to correct you, but I will. If you don’t know what the right thing to do is, just ask. Too easy!\n\n\nCourse Introduction\nThis course is about three big things (in my mind):\n\nbaseball\nstatistics\ndata science skills\n\nYou’re going to learn a lot about all three. My hope is that you will recognize that the statistics we study and the data science skills you learn through our study of baseball are applicable to many other domains outside of baseball. Are we tricking you into learning some valuable skills by making it about baseball? Maybe…\n\nYou can expect me to…\n\nBe kind and treat you with respect.\nBe approachable and available.\nGet to know you as an individual.\nBe enthusiastic and show relevance of the course to your life.\nSet the conditions for your success.\nUnderstand you have other things going on in your life.\nMake mistakes.\n\n\n\nI expect you to…\n\nKeep an open mind and grow as future officers in our profession.\nBe responsible for your learning.\nUse a variety of sources to aid in understanding.\nKeep me informed of what’s going on in your life.\nActively participate in class.\nBe respectful of your classmates\nMake mistakes. Maybe even more than me…\n\n\n\nCourse Documentation (located on Canvas)\n\nSyllabus (Course Calendar)\nInstructional Memo\nLesson Notes (prior to the lesson)\nProblem Sets (about 10 days in advance of due date)\n\n\n\nCourse Texts\nThe Marchi, Albert, and Baumer text is available online: https://beanumber.github.io/abdwr3e/.\nA collection of functions and data sets for the Marchi text is available here: https://github.com/beanumber/abdwr3edata.\nThe Costa, Huber, and Saccoman text will be provided by the instructor later in the semester.\n\n\nBaseball Video\nIf you need a short introduction to the rules and general flow of a baseball game, this video is a good place to start.\n\nhttps://www.youtube.com/watch?v=skOsApsF0jQ\n\n\n\n\nChapter 1 - Baseball Datasets\n\nThe Lahman Database - Season by Season Data (since 1871)\nRetrosheet - Game by Game Data (since 1871); Play by Play Data (since 1921)\nPITCHf/x - Pitch by Pitch (since 2008)\nStatcast - Launch Angle, Exit Velocity, Distance, Player Positioning (since 2015)\n\nHow do we get all this amazing baseball data? Read Section 1.7 in ABDWR closely. Some data we’ll use will come from packages, and some data will take a bit more effort to assemble…but we can do it.\n\n\n\nChapter 2 - Intro to R\nTidyverse Verbs\n\nselect()\nfilter()\nmutate()\ngroup_by()\nsummarize()\narrange()\n\nLet’s investigate how home run rates in Major League Baseball have changed over time. The R package Lahman imports data from Sean Lahman’s Baseball Archive. In this example, we will use the Batting data frame in the package.\n\nlibrary(Lahman)    # loads data frames in the Lahman package\nlibrary(knitr)     # prints pretty tables with the kable function\nlibrary(tidyverse) # tons of useful stuff - ggplot2, dplyr, ...\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.1.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\n# Batting data frame contains one line per player per season per stint.\n# Here are players with the most home runs for a single team in a season.\nBatting |&gt; \n  select(playerID, yearID, stint, lgID, HR, AB) |&gt; \n  arrange(-HR) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\nplayerID\nyearID\nstint\nlgID\nHR\nAB\n\n\n\n\nbondsba01\n2001\n1\nNL\n73\n476\n\n\nmcgwima01\n1998\n1\nNL\n70\n509\n\n\nsosasa01\n1998\n1\nNL\n66\n643\n\n\nmcgwima01\n1999\n1\nNL\n65\n521\n\n\nsosasa01\n2001\n1\nNL\n64\n577\n\n\nsosasa01\n1999\n1\nNL\n63\n625\n\n\njudgeaa01\n2022\n1\nAL\n62\n570\n\n\nmarisro01\n1961\n1\nAL\n61\n590\n\n\nruthba01\n1927\n1\nAL\n60\n540\n\n\nruthba01\n1921\n1\nAL\n59\n540\n\n\n\n\n\n\nTeams |&gt; \n  mutate(decade = floor(yearID/10)*10) |&gt; \n  relocate(decade,.after='yearID') |&gt; \n  summarize(HRs = sum(HR), Gs = sum(G),.by=decade) |&gt; \n  mutate(HRperG = HRs/Gs) |&gt; \n  arrange(decade) |&gt; \n  ggplot(aes(x=decade,y=HRperG))+\n  geom_bar(stat='identity')\n\n\n\n\n\n\n\n\nSteps to coding an exploration of home run rates over the years:\n\nInclude only players in Major League Baseball.\nCalculate the total number of home runs (HR) and at-bats (AB) each season.\nCalculate the home run rate each season.\n\n\n# Calculate the home run rate for each season.\nhomeRuns &lt;- Batting |&gt; \n  filter(lgID %in% c(\"AL\",\"NL\")) |&gt; \n  group_by(yearID) |&gt; \n  summarize(HR = sum(HR),\n            AB = sum(AB)) |&gt; \n  mutate(rate = HR/AB)\n\nhomeRuns |&gt; \n  head(10) |&gt; \n  kable(digits = 4)\n\n\n\n\nyearID\nHR\nAB\nrate\n\n\n\n\n1876\n40\n20121\n0.0020\n\n\n1877\n24\n13667\n0.0018\n\n\n1878\n23\n13644\n0.0017\n\n\n1879\n58\n24155\n0.0024\n\n\n1880\n62\n24301\n0.0026\n\n\n1881\n76\n24377\n0.0031\n\n\n1882\n126\n24769\n0.0051\n\n\n1883\n124\n29012\n0.0043\n\n\n1884\n321\n32687\n0.0098\n\n\n1885\n174\n31123\n0.0056\n\n\n\n\n\nLet’s look at a plot (more on plotting next lesson)…\n\nhomeRuns |&gt; \n  ggplot(aes(x = yearID,\n             y = rate)) +\n  geom_line() +\n  labs(x = \"Year\",\n       y = \"Home Run Rate\")\n\n\n\n\nHome run rate in Major League Baseball by year."
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html",
    "href": "lessons/lsn_2_intro_to_R.html",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)"
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html#compiling-an-.qmd-file",
    "href": "lessons/lsn_2_intro_to_R.html#compiling-an-.qmd-file",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "Compiling an .qmd file",
    "text": "Compiling an .qmd file\nYou’ll submit most assignments in this course as PDFs via Canvas. Let’s make sure you can produce a PDF from Quarto Markdown. If you already know how to do this, sit tight for a minute…\nIf this is new for you, you’ll need to install a TeX distribution. This is easy with TinyTeX.\n\ninstall.packages(\"tinytex\")\n\nWith that package loaded, you’re ready to install TeX.\n\ntinytex::install_tinytex()\n\nNow you should be able to download the source file for these class notes (see “lsn_2_intro_to_R.qmd”) and “Render to PDF.” Make sure this works before the end of class today."
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html#r-syntax-best-practices",
    "href": "lessons/lsn_2_intro_to_R.html#r-syntax-best-practices",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "R Syntax Best Practices",
    "text": "R Syntax Best Practices\n\nVariable Assignemnt\nA lot of folks like to use the = sign to assign variable names. While it generally does work, the more appropriate syntax is -&gt; or &lt;-, depending on which side of the argument your variable name is. = is used more for\n\n\nPiping\nThe pipe passes the output of the previous argument to the first argument of the following function. It’s incredibly useful for data munging. You are probably most familiar with the pipe that looks like %&gt;%. However, that pipe is specific to the dplyr package. There is now a pipe that is native to base R that is probably better to use |&gt;."
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html#review",
    "href": "lessons/lsn_2_intro_to_R.html#review",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "Review",
    "text": "Review\n\nYou are investigating whether the hit-and-run is a good strategy. Which data set should you use?\n\n\nYou are investigating whether pitchers throw more fastballs to hitters at the bottom of the batting order. Which data set would you use?\n\n\nUse R to find career batting average (H/AB) leaders of your favorite team. More specifically, select a team and report a table of the 10 players with at least 2500 at bats (AB) with the highest batting averages while playing for that team.\n\n\n\n\nRed Sox Career Batting Average Leaders\n\n\nplayerID\nH\nAB\nAVG\n\n\n\n\nwillite01\n2654\n7706\n0.344\n\n\nboggswa01\n2098\n6213\n0.338\n\n\nspeaktr01\n1327\n3935\n0.337\n\n\ngarcino01\n1281\n3968\n0.323\n\n\nrunnepe01\n825\n2578\n0.320\n\n\nfoxxji01\n1051\n3288\n0.320\n\n\npeskyjo01\n1277\n4085\n0.313\n\n\nramirma02\n1232\n3953\n0.312\n\n\nlynnfr01\n944\n3062\n0.308\n\n\ngoodmbi01\n1344\n4399\n0.306"
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html#merging-data-frames-pg-41",
    "href": "lessons/lsn_2_intro_to_R.html#merging-data-frames-pg-41",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "Merging Data Frames (pg 41)",
    "text": "Merging Data Frames (pg 41)\nWhen using a relational database (what does that mean again?), a common task is to add information from one table to another. For example, consider our table above from the review. Add the player’s name and when they played their final game.\n\n# I called my table from the review redSox.\n\nredSox &lt;- redSox |&gt;\n  left_join(select(People, playerID, nameLast, nameFirst, finalGame), by = \"playerID\" )\n\nYour turn…the HallofFame data frame contains data on every Hall of Fame ballot. Add to your table above whether the player is in the Hall of Fame. (hint: filter(inducted == \"Y\"))\n\n\n\nRed Sox career batting average leaders\n\n\n\n\n\n\n\n\n\n\n\n\n\nplayerID\nH\nAB\nAVG\nnameLast\nnameFirst\nfinalGame\nyearID\ninducted\n\n\n\n\nwillite01\n2654\n7706\n0.344\nWilliams\nTed\n1960-09-28\n1966\nY\n\n\nboggswa01\n2098\n6213\n0.338\nBoggs\nWade\n1999-08-27\n2005\nY\n\n\nspeaktr01\n1327\n3935\n0.337\nSpeaker\nTris\n1928-08-30\n1937\nY\n\n\ngarcino01\n1281\n3968\n0.323\nGarciaparra\nNomar\n2009-10-04\nNA\nNA\n\n\nrunnepe01\n825\n2578\n0.320\nRunnels\nPete\n1964-05-14\nNA\nNA\n\n\nfoxxji01\n1051\n3288\n0.320\nFoxx\nJimmie\n1945-09-23\n1951\nY\n\n\npeskyjo01\n1277\n4085\n0.313\nPesky\nJohnny\n1954-09-24\nNA\nNA\n\n\nramirma02\n1232\n3953\n0.312\nRamirez\nManny\n2011-04-06\nNA\nNA\n\n\nlynnfr01\n944\n3062\n0.308\nLynn\nFred\n1990-10-03\nNA\nNA\n\n\ngoodmbi01\n1344\n4399\n0.306\nGoodman\nBilly\n1962-09-30\nNA\nNA\n\n\n\n\n\nWhat cleaning would you still want to do to this table to make it more readable?\nWhat is the difference between left_join(), right_join(), inner_join(), and outer_join()?"
  },
  {
    "objectID": "lessons/lsn_4_r_graphics_I.html",
    "href": "lessons/lsn_4_r_graphics_I.html",
    "title": "MA388 Sabermetrics: Lesson 4",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)"
  },
  {
    "objectID": "lessons/lsn_4_r_graphics_I.html#henry-hank-aaron-1934-2021",
    "href": "lessons/lsn_4_r_graphics_I.html#henry-hank-aaron-1934-2021",
    "title": "MA388 Sabermetrics: Lesson 4",
    "section": "Henry (“Hank”) Aaron (1934-2021)",
    "text": "Henry (“Hank”) Aaron (1934-2021)\n\n\n\nHenry Aaron (Source: New York Times)"
  },
  {
    "objectID": "lessons/lsn_4_r_graphics_I.html#review",
    "href": "lessons/lsn_4_r_graphics_I.html#review",
    "title": "MA388 Sabermetrics: Lesson 4",
    "section": "Review",
    "text": "Review\nKey Concepts\n\nfive tidyverse verbs\nrelational databases\nsplit, apply, combine\n\nReview Question\n\nUsing the Batting data frame, determine who held the home run record by season from 1900 to the present. In other words, produce a table with one row per season indicating who the current career home run leader was in baseball at that time. Add their full name to the table using the People data frame.\n\nHere is one approach:\n\nAdd a column to the Batting data frame indicating each player’s cumulative home runs (hint: cumsum()) at the end of the season.\nWrite a function that takes a data frame and a year as arguments and returns the player with the most career home runs that year or earlier.\nMap the function over the seasons from 1900 to 2021.\nAdd player information from the People data frame.\n\n\n\n\nCareer home run leader by season. yearID indicates the season the record was set.\n\n\nyear\nplayerID\nHRcareer\nyearID\nnameFirst\nnameLast\n\n\n\n\n1900\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1901\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1902\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1903\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1904\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1905\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1906\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1907\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1908\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1909\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1910\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1911\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1912\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1913\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1914\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1915\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1916\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1917\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1918\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1919\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1920\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1921\nruthba01\n162\n1921\nBabe\nRuth\n\n\n1922\nruthba01\n197\n1922\nBabe\nRuth\n\n\n1923\nruthba01\n238\n1923\nBabe\nRuth\n\n\n1924\nruthba01\n284\n1924\nBabe\nRuth\n\n\n1925\nruthba01\n309\n1925\nBabe\nRuth\n\n\n1926\nruthba01\n356\n1926\nBabe\nRuth\n\n\n1927\nruthba01\n416\n1927\nBabe\nRuth\n\n\n1928\nruthba01\n470\n1928\nBabe\nRuth\n\n\n1929\nruthba01\n516\n1929\nBabe\nRuth\n\n\n1930\nruthba01\n565\n1930\nBabe\nRuth\n\n\n1931\nruthba01\n611\n1931\nBabe\nRuth\n\n\n1932\nruthba01\n652\n1932\nBabe\nRuth\n\n\n1933\nruthba01\n686\n1933\nBabe\nRuth\n\n\n1934\nruthba01\n708\n1934\nBabe\nRuth\n\n\n1935\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1936\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1937\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1938\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1939\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1940\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1941\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1942\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1943\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1944\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1945\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1946\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1947\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1948\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1949\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1950\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1951\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1952\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1953\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1954\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1955\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1956\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1957\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1958\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1959\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1960\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1961\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1962\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1963\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1964\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1965\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1966\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1967\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1968\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1969\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1970\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1971\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1972\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1973\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1974\naaronha01\n733\n1974\nHank\nAaron\n\n\n1975\naaronha01\n745\n1975\nHank\nAaron\n\n\n1976\naaronha01\n755\n1976\nHank\nAaron\n\n\n1977\naaronha01\n755\n1976\nHank\nAaron\n\n\n1978\naaronha01\n755\n1976\nHank\nAaron\n\n\n1979\naaronha01\n755\n1976\nHank\nAaron\n\n\n1980\naaronha01\n755\n1976\nHank\nAaron\n\n\n1981\naaronha01\n755\n1976\nHank\nAaron\n\n\n1982\naaronha01\n755\n1976\nHank\nAaron\n\n\n1983\naaronha01\n755\n1976\nHank\nAaron\n\n\n1984\naaronha01\n755\n1976\nHank\nAaron\n\n\n1985\naaronha01\n755\n1976\nHank\nAaron\n\n\n1986\naaronha01\n755\n1976\nHank\nAaron\n\n\n1987\naaronha01\n755\n1976\nHank\nAaron\n\n\n1988\naaronha01\n755\n1976\nHank\nAaron\n\n\n1989\naaronha01\n755\n1976\nHank\nAaron\n\n\n1990\naaronha01\n755\n1976\nHank\nAaron\n\n\n1991\naaronha01\n755\n1976\nHank\nAaron\n\n\n1992\naaronha01\n755\n1976\nHank\nAaron\n\n\n1993\naaronha01\n755\n1976\nHank\nAaron\n\n\n1994\naaronha01\n755\n1976\nHank\nAaron\n\n\n1995\naaronha01\n755\n1976\nHank\nAaron\n\n\n1996\naaronha01\n755\n1976\nHank\nAaron\n\n\n1997\naaronha01\n755\n1976\nHank\nAaron\n\n\n1998\naaronha01\n755\n1976\nHank\nAaron\n\n\n1999\naaronha01\n755\n1976\nHank\nAaron\n\n\n2000\naaronha01\n755\n1976\nHank\nAaron\n\n\n2001\naaronha01\n755\n1976\nHank\nAaron\n\n\n2002\naaronha01\n755\n1976\nHank\nAaron\n\n\n2003\naaronha01\n755\n1976\nHank\nAaron\n\n\n2004\naaronha01\n755\n1976\nHank\nAaron\n\n\n2005\naaronha01\n755\n1976\nHank\nAaron\n\n\n2006\naaronha01\n755\n1976\nHank\nAaron\n\n\n2007\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2008\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2009\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2010\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2011\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2012\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2013\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2014\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2015\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2016\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2017\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2018\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2019\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2020\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2021\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2022\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2023\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2024\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2025\nbondsba01\n762\n2007\nBarry\nBonds"
  },
  {
    "objectID": "lessons/lsn_4_r_graphics_I.html#plotting-using-ggplot",
    "href": "lessons/lsn_4_r_graphics_I.html#plotting-using-ggplot",
    "title": "MA388 Sabermetrics: Lesson 4",
    "section": "Plotting using ggplot",
    "text": "Plotting using ggplot\nIn this course, we will use ggplot for graphics. While the code initially seems more complex, ggplot allows us to easily add variables to plots using aesthetics. Here are a few aesthetics ggplot makes available:\n\ncolor\nfill\nlinetype\nlinewidth\nshape\n\n\nLong vs. Wide Format\nWith ggplot, you will typically want data in long format as opposed to wide format. What’s the difference?\n\n# Here are Hank Aaron's and Carl Yastrzemski's HR totals for 1965-70.\ndata_long &lt;- Batting |&gt; \n  filter(yearID &gt;= 1965, \n         yearID &lt;= 1970, \n         playerID %in% c(\"aaronha01\",\"yastrca01\")) |&gt; \n  select(yearID, playerID, HR)\n\n# This data is in long format.\ndata_long |&gt; kable()\n\n\n\n\nyearID\nplayerID\nHR\n\n\n\n\n1965\naaronha01\n32\n\n\n1966\naaronha01\n44\n\n\n1967\naaronha01\n39\n\n\n1968\naaronha01\n29\n\n\n1969\naaronha01\n44\n\n\n1970\naaronha01\n38\n\n\n1965\nyastrca01\n20\n\n\n1966\nyastrca01\n16\n\n\n1967\nyastrca01\n44\n\n\n1968\nyastrca01\n23\n\n\n1969\nyastrca01\n40\n\n\n1970\nyastrca01\n40\n\n\n\n\ndata_wide &lt;- data_long |&gt; \n  pivot_wider(id_cols = playerID, names_from = yearID, values_from = HR)\n\n# This data is in wide format.\ndata_wide |&gt; kable()\n\n\n\n\nplayerID\n1965\n1966\n1967\n1968\n1969\n1970\n\n\n\n\naaronha01\n32\n44\n39\n29\n44\n38\n\n\nyastrca01\n20\n16\n44\n23\n40\n40\n\n\n\n\n\nA basic ggplot has the data frame, aesthetic, and at least one layer. Going back to the Review, let’s plot the number of home runs for the career home run leader by year.\n\nleaders |&gt; \n  ggplot(aes(x = year, \n             y = HRcareer)) +  \n  geom_line()\n\n\n\n\n\n\n\n\nNow, let’s add the player’s name to the plot:\n\nleaders |&gt; \n  ggplot(aes(x = year, \n             y = HRcareer,\n             linetype = nameLast)) + \n  geom_line()\n\n\n\n\n\n\n\n\nNext, let’s change the labels:\n\nleaders |&gt; \n  ggplot(aes(x = as.numeric(year), \n             y = HRcareer,\n             linetype = nameLast)) +  \n  geom_line() +\n  labs(title = \"Home Run Leaders Since 1900\",\n       x = \"Year\", \n       y = \"Home Runs\", \n       linetype = \"Player\")\n\n\n\n\n\n\n\n\n\n\nYour Turn\nUsing the Batting data frame, plot a scatter plot of Hank Aaron’s home runs (\\(y\\)-axis) vs. batting average (\\(x\\)-axis) by season. Color the points in the plot by team name. Change the labels to “Home Runs”, “Batting Average”, and “Team”.\n\n\n\n\n\nHank Aaron’s home runs vs. batting average by year and team."
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html",
    "href": "lessons/lsn_6_runs_and_wins_I.html",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(ggrepel)\nlibrary(broom)"
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html#review",
    "href": "lessons/lsn_6_runs_and_wins_I.html#review",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "Review",
    "text": "Review\nWe finished our intro to R! I hope you feel more confident in your ability to work with databases and large data sets.\nMajor concepts:\n\nfive tidyverse verbs\nrelational databases\nsplit, apply, combine data\nplotting in R (ggplot)\n\nToday we begin our formal study of sabermetrics by answering a super important question: how many runs is a win?\nUsing the Teams data frame, plot the number of wins versus run differential (runs scored \\(R\\) - runs allowed \\(RA\\)) for all teams in the 2001 MLB season. Label the teams using the ggrepel package, color the points by lgID, and add a linear model using geom_smooth().\n\nteams2001 &lt;- Teams |&gt; \n  filter(yearID == 2001) |&gt; \n  mutate(RD = R - RA,\n         Wpct = W / G)\n\n\n\n\n\n\nWins vs. Run Differential (2001 MLB season)"
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html#introduction",
    "href": "lessons/lsn_6_runs_and_wins_I.html#introduction",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "Introduction",
    "text": "Introduction\nAt the end of 2001, the Oakland Athletics were losing three star players (Johnny Damon, Jason Giambi, and Jason Isringhausen) to free agency. Their general manager, Billy Beane, had a limited budget to work with as he looked for their replacements. He wanted to find players who were effective at producing runs but were undervalued in the market. At the time, teams used mostly traditional statistics like batting average (BA), home runs (HR), and runs batted in (RBI) to value players. However, evidence from sabermetrics suggested there were better statistics for determining players’ contributions to run scoring. The book Moneyball by Michael Lewis and the film by the same name follow the 2002 Oakland A’s.\nPut yourself in the position of Billy Beane. How would you approach this problem?"
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html#run-differential-and-wins",
    "href": "lessons/lsn_6_runs_and_wins_I.html#run-differential-and-wins",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "Run Differential and Wins",
    "text": "Run Differential and Wins\nIn Figure 1, is a linear model appropriate?\n\n\n\n\n\nIn Figure 1, how many wins are associated with a 100 run differential?\n\n\n\n\n\nA common rule of thumb in baseball is 10 additional net runs over the course of a season equals one additional win. This gives us a convenient way to evaluate the impact of different players and plays.\nTo be more formal, we could use linear regression.\n\\(Wins_i = \\beta_0 + \\beta_1 RD_i + \\epsilon_i \\quad \\epsilon_i \\sim \\text{Normal}(0,\\sigma^2)\\)\nwhere \\(Wins_i\\) and \\(RD_i\\) are the wins and run differential for team \\(i\\).\nInterpret the coefficients in this model.\n\n\n\n\n\n\n# Fit a linear regression model.\nwins_lm = lm(W ~ RD, data = teams2001)\n\n# Summary of linear model.\nwins_lm |&gt; \n  summary()\n\n\nCall:\nlm(formula = W ~ RD, data = teams2001)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.6914 -2.5399  0.2891  3.0442  8.4091 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) 80.93333    0.70715  114.45   &lt;2e-16 ***\nRD           0.10341    0.00598   17.29   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.873 on 28 degrees of freedom\nMultiple R-squared:  0.9144,    Adjusted R-squared:  0.9113 \nF-statistic:   299 on 1 and 28 DF,  p-value: &lt; 2.2e-16\n\n# Print a clean table of results.\nwins_lm |&gt; \n  tidy() |&gt; \n  kable(digits = 2)\n\n\n\n\nterm\nestimate\nstd.error\nstatistic\np.value\n\n\n\n\n(Intercept)\n80.93\n0.71\n114.45\n0\n\n\nRD\n0.10\n0.01\n17.29\n0\n\n\n\n\n\nCalculate the run differential that would typically result in one additional win.\n\n\n\n\n\nBased on the regression model, do you feel confident in your recommended run differential? Explain how you decided.\n\n\n\n\n\nLet’s look at the residuals for this regression. The broom package helps get model results for model diagnostic plots.\n\n# Look at the teams2001 column names before and after running the next line.\nteams2001 = augment(wins_lm, data = teams2001)\n\nteams2001 |&gt;\n  ggplot(aes(x = .fitted, y = .resid)) +\n  geom_point() +\n  geom_text_repel(data = filter(teams2001, abs(.resid) &gt; 7.5),\n                  aes(label = paste(teamID,yearID))) +\n  labs(x = \"Predicted Wins\", \n       y = \"Residuals\")\n\n\n\n\nFigure 2: Residuals vs. Fitted Values of the Linear Model for Wins\n\n\n\n\nWhat units are the residuals in?\n\n\n\n\n\nIn Figure 2, there are two labeled teams with large residuals. Briefly explain why these teams might have large residuals.\n\n\n\n\n\nAbove, we used run differential to predict number of wins. Typically, we use win percentage instead of wins. Does it matter?\nRepeat the above analysis using win percentage instead of wins. Report the run differential that typically results in one additional win."
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html#how-many-wins-to-make-the-playoffs",
    "href": "lessons/lsn_6_runs_and_wins_I.html#how-many-wins-to-make-the-playoffs",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "How many wins to make the playoffs?",
    "text": "How many wins to make the playoffs?\nLet’s see historically how many wins it takes to make the playoffs. Below, we will look at the five seasons (1997-2001) preceding the 2002 season. First, we need to add a variable playoff to the Teams table, which is an indicator of whether the team made the playoffs (1) or did not make the playoffs (2).\n\n# Get teams in the 1997-2001 seasons.\nmy_teams &lt;- Teams |&gt; \n  filter(yearID &gt;= 1997, yearID &lt;= 2001)\n\n# Obtain a list of teams who made the playoffs by year.\nplayoff_teams &lt;- SeriesPost |&gt; \n  filter(yearID &gt;= 1997, yearID &lt;= 2001) |&gt;\n  select(yearID, teamIDwinner, teamIDloser) |&gt; \n  pivot_longer(-yearID, \n               names_to = \"result\",\n               values_to = \"teamID\") |&gt; \n  select(-result) |&gt; \n  distinct() |&gt; \n  mutate(playoffs = \"yes\")\n\n# Add playoff information to my teams.\nmy_teams = my_teams |&gt; \n  left_join(playoff_teams, by = c(\"yearID\", \"teamID\")) |&gt;\n  mutate(playoffs = replace_na(playoffs, \"no\")) \n\n# Let's check whether we did this correctly.  \n# There should be eight playoff teams each year.\nmy_teams |&gt;\n  count(yearID, playoffs)\n\n   yearID playoffs  n\n1    1997       no 20\n2    1997      yes  8\n3    1998       no 22\n4    1998      yes  8\n5    1999       no 22\n6    1999      yes  8\n7    2000       no 22\n8    2000      yes  8\n9    2001       no 22\n10   2001      yes  8\n\n\nNext, let’s look at the data.\n\nmy_teams |&gt;\n  ggplot(aes(x = W, y = R, color = factor(playoffs))) +\n  geom_point() +\n  labs(x = \"Wins\", \n       y = \"Runs Scored\", \n       color = \"Made Playoffs\",\n       title = \"Wins and Making the Playoffs\") +\n  geom_text_repel(data = filter(my_teams, teamID == \"OAK\"),\n                  aes(x = W, y = R, label = paste(teamID,yearID)),\n                  show.legend = FALSE)\n\n\n\n\n\n\n\n\nBased on the figure above, if you were Billy Beane, how many wins should you shoot for in order to have a good chance of making the playoffs?\n\n\n\n\n\nBesides visual inspection, list methods you could use to assess whether a team will make the playoffs based on number of wins."
  },
  {
    "objectID": "lessons/lsn_9_runs_expectancy_matrix.html",
    "href": "lessons/lsn_9_runs_expectancy_matrix.html",
    "title": "MA388 Sabermetrics: Lesson 9",
    "section": "",
    "text": "library(tidyverse)\nlibrary(Lahman)\nlibrary(knitr)\nlibrary(ggrepel)\nlibrary(broom)"
  },
  {
    "objectID": "lessons/lsn_9_runs_expectancy_matrix.html#review",
    "href": "lessons/lsn_9_runs_expectancy_matrix.html#review",
    "title": "MA388 Sabermetrics: Lesson 9",
    "section": "Review",
    "text": "Review\nLast lesson, we discussed the following three models:\n\\[\\begin{align}\nWpct &= \\beta_0 + \\beta_1 RD + \\epsilon \\\\\nWpct &= \\frac{R^2}{R^2 + RA^2} + \\epsilon \\\\\nWpct &= \\frac{R^k}{R^k + RA^k} + \\epsilon\n\\end{align}\\]\n\nDetermine the value of \\(k\\) in the third model for the 2018 season.\nCalculate the predicted wins for each team in 2018 and plot the residuals vs. the predicted values.\n\n\n\n\n\n\nPythagorean predictions (2018)"
  },
  {
    "objectID": "lessons/lsn_9_runs_expectancy_matrix.html#value-of-plays",
    "href": "lessons/lsn_9_runs_expectancy_matrix.html#value-of-plays",
    "title": "MA388 Sabermetrics: Lesson 9",
    "section": "Value of Plays",
    "text": "Value of Plays\nUsing the 10-runs-per-win rule of thumb (or more precise estimates using the other models), we now have a nice way of converting runs to wins. This leads to our next obvious question – how do we score runs? Simply put, players make plays, and sometimes those plays lead to runs. It’s time to assess how many runs players and plays are worth.\n\nRun Expectancy Matrix\n* The first step is to calculate the run expectancy matrix. The run expectancy matrix tells us the average number of runs scored in the remainder of an inning for each state (runner/out combination) of an inning.\nThe state of the game consists of four digits. The first three digits indicate the location of runners on base. The last digit indicates the number of outs.\nExamples:\n\n“000 0” - no runners on base; no outs\n“111 2” - bases loaded; two outs\n“010 1” - runner on second base; one out\n\n\n\n\nRun Expectancy Matrices (source: http://tangotiger.net/re24.html)\n\n\nHow do we interpret the values in the matrix?\n\n\n\n\n\nDo you see any trends over time?\n\n\n\n\n\nWe are looking at run expectancy matrices. There is another type of matrix called a run probability matrix. Explain how they differ.\n\n\n\n\n\n\n\nRun Expectancy Matrix from Retrosheet Data\nTypically, we use Retrosheet play-by-play data to calculate the run expectancy matrix. Below, we will calculate it for 2011 using the code from our textbook.\n\n# Import Retrosheet play-by-play data from our textbook site.\n\nsite = \"https://raw.githubusercontent.com/maxtoki/baseball_R/\"\nfields &lt;- read_csv(file = paste(site, \"master/data/fields.csv\", sep =\"\"))\nretro2011 &lt;- read_csv(file = paste(site, \"master/data/all2011.csv\", sep = \"\"),\n                    col_names = pull(fields, Header),\n                    na = character())\ncolnames(retro2011) &lt;- tolower(colnames(retro2011))\n\nThis data frame contains one line for every play in the 2011 season. There are approximately 200,000 lines in this data set.\n\nretro2011 |&gt; \n  select(game_id, away_team_id, inn_ct, outs_ct,\n         bat_id, pit_id, event_cd) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\ngame_id\naway_team_id\ninn_ct\nouts_ct\nbat_id\npit_id\nevent_cd\n\n\n\n\nANA201104080\nTOR\n1\n0\ndavir003\nsante001\n2\n\n\nANA201104080\nTOR\n1\n1\nnix-j001\nsante001\n2\n\n\nANA201104080\nTOR\n1\n2\nbautj002\nsante001\n3\n\n\nANA201104080\nTOR\n1\n0\niztum001\ndrabk001\n14\n\n\nANA201104080\nTOR\n1\n0\nkendh001\ndrabk001\n3\n\n\nANA201104080\nTOR\n1\n1\nabreb001\ndrabk001\n6\n\n\nANA201104080\nTOR\n1\n2\nabreb001\ndrabk001\n14\n\n\nANA201104080\nTOR\n1\n2\nhuntt001\ndrabk001\n20\n\n\nANA201104080\nTOR\n1\n2\nwellv001\ndrabk001\n2\n\n\nANA201104080\nTOR\n2\n0\nlinda001\nsante001\n2\n\n\n\n\n\nTo understand what happened in this game, we’ll need to know what all the event codes are for various baseball outcomes described by the event_cd field.\n\n\n\nEvent codes\n\n\nIf we further consider the event_tx and pitch_seq_tx fields, we can more comprehensively reconstruct each at-bat. Let’s try to describe what happened in the first inning of this game. We’ll need to know the position numbers to interpret the event text strings.\n\n\n\nBaseball Position Numbers\n\n\n\n\nretro2011 |&gt; \n  select(inn_ct, outs_ct,\n         bat_id, pit_id, pitch_seq_tx, event_tx) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\ninn_ct\nouts_ct\nbat_id\npit_id\npitch_seq_tx\nevent_tx\n\n\n\n\n1\n0\ndavir003\nsante001\nFBSX\n9/F\n\n\n1\n1\nnix-j001\nsante001\nX\n9/F\n\n\n1\n2\nbautj002\nsante001\nCBCS\nK\n\n\n1\n0\niztum001\ndrabk001\nCBBBB\nW\n\n\n1\n0\nkendh001\ndrabk001\nBCSBS\nK\n\n\n1\n1\nabreb001\ndrabk001\nCBB1&gt;S\nCS2(26)\n\n\n1\n2\nabreb001\ndrabk001\nCBB1&gt;S.FBFB\nW\n\n\n1\n2\nhuntt001\ndrabk001\nCCX\nS9/L.1-H(E9/TH)(UR)(NR);B-3\n\n\n1\n2\nwellv001\ndrabk001\nBX\n63/G\n\n\n2\n0\nlinda001\nsante001\nCBBFX\n3/L-\n\n\n\n\n\n\n\n\nCalculate the Run Expectancy Matrix\nThe textbook provides the code below to generate the run expectancy matrix.\n\nretro2011 &lt;- retro2011 |&gt; \n  mutate(runs_before = away_score_ct + home_score_ct,\n         half_inning = paste(game_id, inn_ct, bat_home_id),\n         runs_scored = \n           (bat_dest_id &gt; 3) + (run1_dest_id &gt; 3) + \n           (run2_dest_id &gt; 3) + (run3_dest_id &gt; 3))\n\nhalf_innings &lt;- retro2011 |&gt;\n  group_by(half_inning) |&gt;\n  summarize(outs_inning = sum(event_outs_ct),\n            runs_inning = sum(runs_scored),\n            runs_start = first(runs_before),\n            max_runs = runs_inning + runs_start)\n\nretro2011 &lt;- retro2011 |&gt;\n  inner_join(half_innings, by = \"half_inning\") |&gt;\n  mutate(runs_roi = max_runs - runs_before)\n\nretro2011 &lt;- retro2011 |&gt;\n  mutate(bases = \n           paste(ifelse(base1_run_id &gt; '',1,0),\n                 ifelse(base2_run_id &gt; '',1,0),\n                 ifelse(base3_run_id &gt; '',1,0), sep = \"\"),\n         state = paste(bases, outs_ct))\n\nretro2011 &lt;- retro2011 |&gt;\n  mutate(is_runner1 =\n           as.numeric(run1_dest_id==1 | bat_dest_id == 1),\n         is_runner2 = \n           as.numeric(run1_dest_id == 2 | run2_dest_id == 2 |\n                        bat_dest_id == 2),\n         is_runner3 = \n           as.numeric(run1_dest_id == 3 | run2_dest_id == 3 |\n                        run3_dest_id == 3 | bat_dest_id == 3),\n         new_outs = outs_ct + event_outs_ct,\n         new_bases = paste(is_runner1,is_runner2, is_runner3, sep = \"\"),\n         new_state = paste(new_bases, new_outs))\n\n\n\nretro2011 &lt;- retro2011 |&gt;\n  filter((state != new_state) | (runs_scored &gt; 0))\n\nretro2011_complete &lt;- retro2011 |&gt;\n  filter(outs_inning == 3)\n\nerm_2011 &lt;- retro2011_complete |&gt;\n  group_by(bases, outs_ct) |&gt; # same as grouping by state\n  summarize(mean_run_value = mean(runs_roi))\n\nerm_2011_wide &lt;- erm_2011 |&gt; \n  pivot_wider(\n    names_from = outs_ct, \n    values_from = mean_run_value, \n    names_prefix = \"Outs=\"\n  )\n\nwrite_csv(erm_2011_wide, \"erm_2011_wide.csv\")\n\nerm_2011_wide |&gt; kable()\n\n\n\n\nbases\nOuts=0\nOuts=1\nOuts=2\n\n\n\n\n000\n0.4711649\n0.2546956\n0.0971845\n\n\n001\n1.4543568\n0.9374359\n0.3173913\n\n\n010\n1.0582804\n0.6501976\n0.3091673\n\n\n011\n1.9304897\n1.3388641\n0.5407407\n\n\n100\n0.8350992\n0.4960492\n0.2179536\n\n\n101\n1.7526998\n1.1496169\n0.4882597\n\n\n110\n1.4144549\n0.8739176\n0.4222569\n\n\n111\n2.1718266\n1.4745146\n0.7610094\n\n\n\n\n\nNow we use this expected run table to determine the value of every event.\n\nretro2011 &lt;- retro2011 |&gt; \n  left_join(erm_2011, join_by(\"bases\", \"outs_ct\")) |&gt; \n  rename(rv_start = mean_run_value) |&gt; \n  left_join(\n    erm_2011, \n    join_by(new_bases == bases, new_outs == outs_ct)\n  ) |&gt; \n  rename(rv_end = mean_run_value) |&gt; \n  replace_na(list(rv_end = 0)) |&gt; \n  mutate(run_value = rv_end - rv_start + runs_scored)\n\nNote the code above also adds some very useful columns to the play-by-play data related to the state and run expectancy at the start and end of each play.\n\nretro2011 |&gt; \n select(bat_id, event_cd, state, rv_start,\n        new_state, rv_end, runs_scored, run_value) |&gt;\n  head(10) |&gt; \n  kable(digits = 3)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nbat_id\nevent_cd\nstate\nrv_start\nnew_state\nrv_end\nruns_scored\nrun_value\n\n\n\n\ndavir003\n2\n000 0\n0.471\n000 1\n0.255\n0\n-0.216\n\n\nnix-j001\n2\n000 1\n0.255\n000 2\n0.097\n0\n-0.158\n\n\nbautj002\n3\n000 2\n0.097\n000 3\n0.000\n0\n-0.097\n\n\niztum001\n14\n000 0\n0.471\n100 0\n0.835\n0\n0.364\n\n\nkendh001\n3\n100 0\n0.835\n100 1\n0.496\n0\n-0.339\n\n\nabreb001\n6\n100 1\n0.496\n000 2\n0.097\n0\n-0.399\n\n\nabreb001\n14\n000 2\n0.097\n100 2\n0.218\n0\n0.121\n\n\nhuntt001\n20\n100 2\n0.218\n001 2\n0.317\n1\n1.099\n\n\nwellv001\n2\n001 2\n0.317\n001 3\n0.000\n0\n-0.317\n\n\nlinda001\n2\n000 0\n0.471\n000 1\n0.255\n0\n-0.216\n\n\n\n\n\n\nlibrary(baseballr) #the appendix does not tell you that you need this. \n\nretro_data&lt;-retrosheet_data(years=2022)\nretro2022 &lt;- retro_data |&gt;\npluck(\"2022\") |&gt;\npluck(\"events\")\nroster2022 &lt;- retro_data |&gt;\npluck(\"2022\") |&gt;\npluck(\"rosters\")\nroster2022_clean&lt;-roster2022 |&gt;\nselect(player_id,last_name,first_name) |&gt;\nrename(bat_id=player_id) |&gt; \n  distinct()\n\nstats&lt;-retro2022 |&gt; #I split the code chunk so I don't have to do the slow step every time I run it\nselect(bat_id,event_cd,bat_home_id) |&gt; #grab only the columns I want\nfilter(event_cd&gt;=20|event_cd==2|event_cd==3) |&gt; #events &gt;= 20 are hits, 2+3 are out/strikeout\ngroup_by(bat_id,bat_home_id) |&gt;\nmutate(\nhit=if_else(event_cd&gt;=20,1,0), #if play event was hit make it 1 if not 0\nab=1, #all of these are ABs, making them 1 to sum later\nhome_away=if_else(bat_home_id==1,\"Home\",\"Away\"))\n\nplayer_stats&lt;-stats |&gt;\ngroup_by(bat_id,home_away) |&gt;\nsummarize(AB=sum(ab),H=sum(hit),AVG=H/AB) |&gt;\nfilter(AB&gt;=100) #filter out players with &lt;100 ABs\n\nplayer_home_v_away&lt;-player_stats |&gt;\nselect(bat_id,home_away,AVG) |&gt;\npivot_wider(id_cols = bat_id,\nnames_from = home_away,\nvalues_from=AVG,\n)\n\nroster2022 |&gt; count(player_id) |&gt; arrange(-n)\n\n# A tibble: 1,495 × 2\n   player_id     n\n   &lt;chr&gt;     &lt;int&gt;\n 1 chany001      4\n 2 fordm002      4\n 3 abrea001      3\n 4 banda001      3\n 5 canor001      3\n 6 chavj001      3\n 7 duggs001      3\n 8 fairs001      3\n 9 gonzc002      3\n10 keucd001      3\n# ℹ 1,485 more rows\n\nplayer_home_v_away&lt;-player_home_v_away |&gt;\nleft_join(roster2022_clean,by=\"bat_id\")\nplayer_home_v_away |&gt;\nmutate(Difference=abs(Home-Away)) |&gt;\narrange(Difference) |&gt;\nhead(10) |&gt;\nselect(last_name,first_name,Difference)\n\n# A tibble: 10 × 4\n# Groups:   bat_id [10]\n   bat_id   last_name  first_name Difference\n   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;\n 1 darnt001 d'Arnaud   Travis       0       \n 2 vierm001 Vierling   Matt         0.000149\n 3 andre001 Andrus     Elvis        0.000569\n 4 wendj002 Wendle     Joey         0.000605\n 5 santc002 Santana    Carlos       0.00110 \n 6 merrw001 Merrifield Whit         0.00151 \n 7 heimj001 Heim       Jonah        0.00156 \n 8 smitp002 Smith      Pavin        0.00192 \n 9 estrt001 Estrada    Thairo       0.00196 \n10 rizza001 Rizzo      Anthony      0.00208"
  },
  {
    "objectID": "lessons/lsn_13_catcher_framing_visualization.html",
    "href": "lessons/lsn_13_catcher_framing_visualization.html",
    "title": "MA388 Sabermetrics: Lesson 13",
    "section": "",
    "text": "In this chapter, we investigate whether catchers have the ability to consistently frame close pitches, which some believe makes it more likely the umpire will call a strike.\n\n\nVideo 1\nVideo 2\n\n\n\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(baseballr)\n\nThe code below imports the all pitches thrown in May 2019.\n\n# If you've already collected the pitch data below, just load it.  Otherwise,\n# collect it from scratch.\n\nif(\"statcast_may_2019.rds\" %in% dir(getwd())){\n  pitches &lt;- readRDS(\"statcast_may_2019.rds\")\n}else{\n  \n  # Retrieve pitch-level data from May 2019.  \n\nget_statcast_pitches &lt;- function(start_day, end_day, chunk_size = 5) {\n\n  # Coerce to Date\n  start_day &lt;- as.Date(start_day)\n  end_day   &lt;- as.Date(end_day)\n\n  # Create sequence of chunk start dates\n  chunk_starts &lt;- seq(start_day, end_day, by = paste(chunk_size, \"days\"))\n\n  # Build data\n  pitch_data &lt;- map_dfr(chunk_starts, function(chunk_start) {\n\n    chunk_end &lt;- min(chunk_start + days(chunk_size - 1), end_day)\n       statcast_search(\n        start_date = chunk_start,\n        end_date   = chunk_end\n      )\n  })\n  return(pitch_data)\n}  \n  \n  # If we want to limit to a certain number of pitches, we might take the head()\n  # or sample_n() to get the number we want.\n  pitches &lt;- get_statcast_pitches('2019-05-01','2019-05-31')\n\n  saveRDS(pitches, \"statcast_may_2019.rds\")\n}\n\n\nHere is a small sample of the Statcast pitches and variables we’ve collected.\n\npitches %&gt;% \n  select(description, release_speed, pitch_name, \n         plate_x, plate_z, balls, strikes, fielder_2) %&gt;% \n  head(10) %&gt;% \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndescription\nrelease_speed\npitch_name\nplate_x\nplate_z\nballs\nstrikes\nfielder_2\n\n\n\n\nswinging_strike\n79.2\nChangeup\n-0.54\n1.79\n2\n2\n444489\n\n\nfoul\n89.3\nSinker\n-0.74\n2.42\n2\n2\n444489\n\n\nfoul\n79.5\nChangeup\n-0.32\n1.25\n2\n1\n444489\n\n\nball\n88.3\nSinker\n-1.28\n1.95\n1\n1\n444489\n\n\nball\n88.1\nSinker\n-1.82\n2.29\n0\n1\n444489\n\n\ncalled_strike\n87.5\nSinker\n-0.17\n2.11\n0\n0\n444489\n\n\nhit_into_play\n78.6\nChangeup\n-0.27\n1.20\n1\n2\n444489\n\n\nball\n79.0\nChangeup\n-1.25\n1.23\n0\n2\n444489\n\n\nfoul\n78.5\nChangeup\n0.49\n1.47\n0\n1\n444489\n\n\nfoul\n86.6\nSinker\n0.38\n2.52\n0\n0\n444489\n\n\n\n\n\nOne of the variables in pitches is the catcher’s ID. Let’s add the catcher’s name to each pitch in our data frame using the master list available at https://www.smartfantasybaseball.com/tools/.\n\n# This CSV is available at https://www.smartfantasybaseball.com/tools/.\nmlb_IDs &lt;- read_csv(\"./PLAYERIDMAP.csv\")\n\npitches &lt;- pitches %&gt;% \n  left_join(select(mlb_IDs, PLAYERNAME, MLBID),\n            by = c(\"fielder_2\" = \"MLBID\")) %&gt;% \n  rename(catcher_name = PLAYERNAME)\n\nLet’s look at the 10 catchers with the most pitches thrown to them in early May 2019.\n\ntop10catchers &lt;- pitches %&gt;% \n  count(catcher_name) %&gt;% \n  arrange(-n) %&gt;% \n  head(10) %&gt;%\n  pull(catcher_name)\n\ntop10catchers   \n\n [1] \"Yasmani Grandal\"   \"J.T. Realmuto\"     \"Willson Contreras\"\n [4] \"Yadier Molina\"     \"Elias Diaz\"        \"Martin Maldonado\" \n [7] \"Jorge Alfaro\"      \"Robinson Chirinos\" \"Wilson Ramos\"     \n[10] \"Josh Phegley\"     \n\n\n\nOkay, let’s see if we can see anything by looking at called strikes versus balls.\n\n# Let's plot the strike zone.\n# Note px and pz in the book are actually plate_x and plate_z, respectively.\nplate_width &lt;- 17 + 2 * (9/pi)\nk_zone_plot &lt;- ggplot(NULL, aes(x = plate_x, y = plate_z)) +  \n  geom_rect(xmin = -(plate_width / 2) / 12,\n            xmax = (plate_width / 2) / 12,\n            ymin = 1.5,\n            ymax = 3.6, \n            color = \"blue\",\n            alpha = 0) +\n  coord_equal() +\n  scale_x_continuous(\"Horizontal Location (ft)\", limits = c(-2,2)) +\n  scale_y_continuous(\"Vertical Location (ft)\", limits = c(0,5))\n\n# Look at only taken pitches caught by one of the 10 top catchers.\npitches_taken &lt;- pitches %&gt;% \n  filter(catcher_name %in% top10catchers,\n         description %in% c(\"ball\", \"called_strike\")) %&gt;% \n  mutate(description = str_replace(description, \"_\", \" \"))\n\n# Plot pitches that were balls or called strikes.\nk_zone_plot %+% pitches_taken +\n  aes(color = description) +\n  geom_point(alpha = 0.15, size = .5) +\n  scale_color_manual(values = c(\"blue\", \"red\")) +\n  facet_wrap(~catcher_name, ncol = 5) + \n  theme(legend.position = \"bottom\") + \n  labs(title = \"Strike vs. Ball Calls on Taken Pitches\",\n       color = \"Umpire Decision\")\n\n\n\n\n\n\n\n\nHow can we make some sense of the different panels in this figure? Look closely – does anything jump out at you?\n\nOkay, this is admittedly pretty subjective, and we can’t stop here. We need a quantitative assessment of how different catchers may or may not be contributing to different proportions of called strikes on pitches where batters didn’t swing.\n\npitches_taken %&gt;% \n  count(catcher_name, description) %&gt;% \n  group_by(catcher_name) %&gt;% \n  mutate(prop = n / sum(n)) %&gt;% \n  filter(description == \"called strike\") %&gt;% \n  arrange(-prop) %&gt;% \n  kable(digits = 3, \n        caption = \"Proportion of taken pitches that were called strikes by catcher.\")\n\n\nProportion of taken pitches that were called strikes by catcher.\n\n\ncatcher_name\ndescription\nn\nprop\n\n\n\n\nWilson Ramos\ncalled strike\n504\n0.362\n\n\nWillson Contreras\ncalled strike\n575\n0.356\n\n\nJ.T. Realmuto\ncalled strike\n602\n0.353\n\n\nYadier Molina\ncalled strike\n533\n0.346\n\n\nMartin Maldonado\ncalled strike\n496\n0.337\n\n\nRobinson Chirinos\ncalled strike\n471\n0.334\n\n\nYasmani Grandal\ncalled strike\n566\n0.325\n\n\nJosh Phegley\ncalled strike\n443\n0.320\n\n\nElias Diaz\ncalled strike\n466\n0.317\n\n\nJorge Alfaro\ncalled strike\n427\n0.302"
  },
  {
    "objectID": "lessons/lsn_13_catcher_framing_visualization.html#chapter-7",
    "href": "lessons/lsn_13_catcher_framing_visualization.html#chapter-7",
    "title": "MA388 Sabermetrics: Lesson 13",
    "section": "",
    "text": "In this chapter, we investigate whether catchers have the ability to consistently frame close pitches, which some believe makes it more likely the umpire will call a strike.\n\n\nVideo 1\nVideo 2\n\n\n\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(baseballr)\n\nThe code below imports the all pitches thrown in May 2019.\n\n# If you've already collected the pitch data below, just load it.  Otherwise,\n# collect it from scratch.\n\nif(\"statcast_may_2019.rds\" %in% dir(getwd())){\n  pitches &lt;- readRDS(\"statcast_may_2019.rds\")\n}else{\n  \n  # Retrieve pitch-level data from May 2019.  \n\nget_statcast_pitches &lt;- function(start_day, end_day, chunk_size = 5) {\n\n  # Coerce to Date\n  start_day &lt;- as.Date(start_day)\n  end_day   &lt;- as.Date(end_day)\n\n  # Create sequence of chunk start dates\n  chunk_starts &lt;- seq(start_day, end_day, by = paste(chunk_size, \"days\"))\n\n  # Build data\n  pitch_data &lt;- map_dfr(chunk_starts, function(chunk_start) {\n\n    chunk_end &lt;- min(chunk_start + days(chunk_size - 1), end_day)\n       statcast_search(\n        start_date = chunk_start,\n        end_date   = chunk_end\n      )\n  })\n  return(pitch_data)\n}  \n  \n  # If we want to limit to a certain number of pitches, we might take the head()\n  # or sample_n() to get the number we want.\n  pitches &lt;- get_statcast_pitches('2019-05-01','2019-05-31')\n\n  saveRDS(pitches, \"statcast_may_2019.rds\")\n}\n\n\nHere is a small sample of the Statcast pitches and variables we’ve collected.\n\npitches %&gt;% \n  select(description, release_speed, pitch_name, \n         plate_x, plate_z, balls, strikes, fielder_2) %&gt;% \n  head(10) %&gt;% \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndescription\nrelease_speed\npitch_name\nplate_x\nplate_z\nballs\nstrikes\nfielder_2\n\n\n\n\nswinging_strike\n79.2\nChangeup\n-0.54\n1.79\n2\n2\n444489\n\n\nfoul\n89.3\nSinker\n-0.74\n2.42\n2\n2\n444489\n\n\nfoul\n79.5\nChangeup\n-0.32\n1.25\n2\n1\n444489\n\n\nball\n88.3\nSinker\n-1.28\n1.95\n1\n1\n444489\n\n\nball\n88.1\nSinker\n-1.82\n2.29\n0\n1\n444489\n\n\ncalled_strike\n87.5\nSinker\n-0.17\n2.11\n0\n0\n444489\n\n\nhit_into_play\n78.6\nChangeup\n-0.27\n1.20\n1\n2\n444489\n\n\nball\n79.0\nChangeup\n-1.25\n1.23\n0\n2\n444489\n\n\nfoul\n78.5\nChangeup\n0.49\n1.47\n0\n1\n444489\n\n\nfoul\n86.6\nSinker\n0.38\n2.52\n0\n0\n444489\n\n\n\n\n\nOne of the variables in pitches is the catcher’s ID. Let’s add the catcher’s name to each pitch in our data frame using the master list available at https://www.smartfantasybaseball.com/tools/.\n\n# This CSV is available at https://www.smartfantasybaseball.com/tools/.\nmlb_IDs &lt;- read_csv(\"./PLAYERIDMAP.csv\")\n\npitches &lt;- pitches %&gt;% \n  left_join(select(mlb_IDs, PLAYERNAME, MLBID),\n            by = c(\"fielder_2\" = \"MLBID\")) %&gt;% \n  rename(catcher_name = PLAYERNAME)\n\nLet’s look at the 10 catchers with the most pitches thrown to them in early May 2019.\n\ntop10catchers &lt;- pitches %&gt;% \n  count(catcher_name) %&gt;% \n  arrange(-n) %&gt;% \n  head(10) %&gt;%\n  pull(catcher_name)\n\ntop10catchers   \n\n [1] \"Yasmani Grandal\"   \"J.T. Realmuto\"     \"Willson Contreras\"\n [4] \"Yadier Molina\"     \"Elias Diaz\"        \"Martin Maldonado\" \n [7] \"Jorge Alfaro\"      \"Robinson Chirinos\" \"Wilson Ramos\"     \n[10] \"Josh Phegley\"     \n\n\n\nOkay, let’s see if we can see anything by looking at called strikes versus balls.\n\n# Let's plot the strike zone.\n# Note px and pz in the book are actually plate_x and plate_z, respectively.\nplate_width &lt;- 17 + 2 * (9/pi)\nk_zone_plot &lt;- ggplot(NULL, aes(x = plate_x, y = plate_z)) +  \n  geom_rect(xmin = -(plate_width / 2) / 12,\n            xmax = (plate_width / 2) / 12,\n            ymin = 1.5,\n            ymax = 3.6, \n            color = \"blue\",\n            alpha = 0) +\n  coord_equal() +\n  scale_x_continuous(\"Horizontal Location (ft)\", limits = c(-2,2)) +\n  scale_y_continuous(\"Vertical Location (ft)\", limits = c(0,5))\n\n# Look at only taken pitches caught by one of the 10 top catchers.\npitches_taken &lt;- pitches %&gt;% \n  filter(catcher_name %in% top10catchers,\n         description %in% c(\"ball\", \"called_strike\")) %&gt;% \n  mutate(description = str_replace(description, \"_\", \" \"))\n\n# Plot pitches that were balls or called strikes.\nk_zone_plot %+% pitches_taken +\n  aes(color = description) +\n  geom_point(alpha = 0.15, size = .5) +\n  scale_color_manual(values = c(\"blue\", \"red\")) +\n  facet_wrap(~catcher_name, ncol = 5) + \n  theme(legend.position = \"bottom\") + \n  labs(title = \"Strike vs. Ball Calls on Taken Pitches\",\n       color = \"Umpire Decision\")\n\n\n\n\n\n\n\n\nHow can we make some sense of the different panels in this figure? Look closely – does anything jump out at you?\n\nOkay, this is admittedly pretty subjective, and we can’t stop here. We need a quantitative assessment of how different catchers may or may not be contributing to different proportions of called strikes on pitches where batters didn’t swing.\n\npitches_taken %&gt;% \n  count(catcher_name, description) %&gt;% \n  group_by(catcher_name) %&gt;% \n  mutate(prop = n / sum(n)) %&gt;% \n  filter(description == \"called strike\") %&gt;% \n  arrange(-prop) %&gt;% \n  kable(digits = 3, \n        caption = \"Proportion of taken pitches that were called strikes by catcher.\")\n\n\nProportion of taken pitches that were called strikes by catcher.\n\n\ncatcher_name\ndescription\nn\nprop\n\n\n\n\nWilson Ramos\ncalled strike\n504\n0.362\n\n\nWillson Contreras\ncalled strike\n575\n0.356\n\n\nJ.T. Realmuto\ncalled strike\n602\n0.353\n\n\nYadier Molina\ncalled strike\n533\n0.346\n\n\nMartin Maldonado\ncalled strike\n496\n0.337\n\n\nRobinson Chirinos\ncalled strike\n471\n0.334\n\n\nYasmani Grandal\ncalled strike\n566\n0.325\n\n\nJosh Phegley\ncalled strike\n443\n0.320\n\n\nElias Diaz\ncalled strike\n466\n0.317\n\n\nJorge Alfaro\ncalled strike\n427\n0.302"
  }
]