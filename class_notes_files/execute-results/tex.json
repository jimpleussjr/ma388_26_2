{
  "hash": "085f4500453c2faad10119ecee972525",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Class Code\"\nformat: pdf\neditor: visual\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(Lahman)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --\nv dplyr     1.1.4     v readr     2.1.5\nv forcats   1.0.0     v stringr   1.5.1\nv ggplot2   3.5.2     v tibble    3.3.0\nv lubridate 1.9.4     v tidyr     1.3.1\nv purrr     1.1.0     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx dplyr::filter() masks stats::filter()\nx dplyr::lag()    masks stats::lag()\ni Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\nlibrary(broom)\n```\n:::\n\n\n\n## Create top 10 Yankee career batting average\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nYankees <- \n  Batting |> \n  filter(teamID == 'NYA') |> \n  summarize(hits = sum(H),at_bats=sum(AB),.by='playerID') |> \n  mutate(BA = hits/at_bats) |> \n  filter(at_bats>=2500) |> \n  arrange(-BA) |>\n  head(10)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nYankees |> \n  left_join(select(People, playerID, nameLast, nameFirst, finalGame), by = \"playerID\" ) |> \n  left_join(select(HallOfFame, playerID, inducted, yearID)|> \n              filter(inducted!=\"N\")\n            , by = \"playerID\") |> \n  select(-playerID) |> \n  relocate(nameLast,nameFirst) |> \n  arrange(inducted,finalGame) |> \n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|nameLast  |nameFirst | hits| at_bats|        BA|finalGame  |inducted | yearID|\n|:---------|:---------|----:|-------:|---------:|:----------|:--------|------:|\n|Ruth      |Babe      | 2518|    7216| 0.3489468|1935-05-30 |Y        |   1936|\n|Combs     |Earle     | 1866|    5746| 0.3247477|1935-09-29 |Y        |   1970|\n|Gehrig    |Lou       | 2721|    8001| 0.3400825|1939-04-30 |Y        |   1939|\n|Dickey    |Bill      | 1969|    6300| 0.3125397|1946-09-08 |Y        |   1954|\n|DiMaggio  |Joe       | 2214|    6821| 0.3245858|1951-09-30 |Y        |   1955|\n|Jeter     |Derek     | 3465|   11195| 0.3095132|2014-09-28 |Y        |   2020|\n|Meusel    |Bob       | 1565|    5032| 0.3110095|1930-09-26 |NA       |     NA|\n|Chapman   |Ben       | 1079|    3539| 0.3048884|1946-05-12 |NA       |     NA|\n|Mattingly |Don       | 2153|    7003| 0.3074397|1995-10-01 |NA       |     NA|\n|Cano      |Robinson  | 1649|    5336| 0.3090330|2022-07-27 |NA       |     NA|\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nTeams |> \n  filter(yearID >1999) |> \n  select(teamID,W,G,WSWin) |> \n  # mutate(WSWin = ifelse(WSWin=='Y',1,0)) |>\n  group_by(teamID) |> \n  summarize(W=sum(W),G=sum(G),WSWins= sum(WSWin==\"Y\")) |> \n  mutate(Wpct=W/G) |> \n  arrange(-Wpct)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 33 x 5\n   teamID     W     G WSWins  Wpct\n   <fct>  <int> <int>  <int> <dbl>\n 1 NYA     2286  3946      2 0.579\n 2 LAN     2239  3948      2 0.567\n 3 SLN     2179  3945      2 0.552\n 4 ATL     2152  3945      1 0.546\n 5 BOS     2145  3947      4 0.543\n 6 ANA      425   810      1 0.525\n 7 SFN     2052  3946      3 0.520\n 8 CLE     2046  3945      0 0.519\n 9 OAK     2030  3946      0 0.514\n10 HOU     2029  3947      2 0.514\n# i 23 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\nnames(Teams)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"yearID\"         \"lgID\"           \"teamID\"         \"franchID\"      \n [5] \"divID\"          \"Rank\"           \"G\"              \"Ghome\"         \n [9] \"W\"              \"L\"              \"DivWin\"         \"WCWin\"         \n[13] \"LgWin\"          \"WSWin\"          \"R\"              \"AB\"            \n[17] \"H\"              \"X2B\"            \"X3B\"            \"HR\"            \n[21] \"BB\"             \"SO\"             \"SB\"             \"CS\"            \n[25] \"HBP\"            \"SF\"             \"RA\"             \"ER\"            \n[29] \"ERA\"            \"CG\"             \"SHO\"            \"SV\"            \n[33] \"IPouts\"         \"HA\"             \"HRA\"            \"BBA\"           \n[37] \"SOA\"            \"E\"              \"DP\"             \"FP\"            \n[41] \"name\"           \"park\"           \"attendance\"     \"BPF\"           \n[45] \"PPF\"            \"teamIDBR\"       \"teamIDlahman45\" \"teamIDretro\"   \n```\n\n\n:::\n:::\n\n\n### Lesson 3\n\n#### AY26-2 Notes\n\nNeed to change group_keys portion because if there are different numbers of rows for players or teams, the split won't match up appropriately. **Complete**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1 - Write a function.\nmostWins <- function(data){\n  data |> \n    arrange(-W) |> \n    select(teamID, W, WSWin) |> \n    head(1)\n}\n\n# Step 2 - Pull the years you will split on.\nyear <- Teams |> \n  filter(yearID >= 2000) |> \n  group_by(yearID) |> \n  group_keys() |> \n  pull(yearID)\n\n# Steps 3 and 4 - Split and apply.\nwinLeaders <- Teams |> \n  filter(yearID >= 2000) |> \n  split(year) |>\n  map_df(mostWins, .id = \"yearID\")\n\nwinLeaders |> \n  kable(caption = \"Major League win leaders by season and whether they won the World Series.\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Major League win leaders by season and whether they won the World Series.\n\n|yearID |teamID |   W|WSWin |\n|:------|:------|---:|:-----|\n|2000   |SFN    |  97|N     |\n|2001   |SEA    | 116|N     |\n|2002   |NYA    | 103|N     |\n|2003   |ATL    | 101|N     |\n|2004   |SLN    | 105|N     |\n|2005   |SLN    | 100|N     |\n|2006   |NYN    |  97|N     |\n|2007   |BOS    |  96|Y     |\n|2008   |LAA    | 100|N     |\n|2009   |NYA    | 103|Y     |\n|2010   |PHI    |  97|N     |\n|2011   |PHI    | 102|N     |\n|2012   |WAS    |  98|N     |\n|2013   |BOS    |  97|Y     |\n|2014   |LAA    |  98|N     |\n|2015   |SLN    | 100|N     |\n|2016   |CHN    | 103|Y     |\n|2017   |LAN    | 104|N     |\n|2018   |BOS    | 108|Y     |\n|2019   |HOU    | 107|N     |\n|2020   |LAN    |  43|Y     |\n|2021   |SFN    | 107|N     |\n|2022   |LAN    | 111|N     |\n|2023   |ATL    | 104|N     |\n|2024   |LAN    |  98|Y     |\n\n\n:::\n:::\n\n\n\n### Pulling in the various data frames\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(baseballr)\n\nBatting |> \n  filter(between(yearID, 2010,2025)) |> \n  left_join(People |> select(playerID,nameLast,nameFirst,bats)) |> \n  summarize(H=sum(H),AB=sum(AB),.by=c('yearID','bats')) |> \n  mutate(AVG = H/AB) |> \n  pivot_wider(id_cols='yearID',names_from = 'bats',values_from ='AVG')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(playerID)`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 15 x 4\n   yearID     R     L     B\n    <int> <dbl> <dbl> <dbl>\n 1   2010 0.257 0.259 0.256\n 2   2012 0.255 0.253 0.255\n 3   2013 0.253 0.255 0.254\n 4   2015 0.253 0.259 0.250\n 5   2011 0.253 0.257 0.259\n 6   2014 0.251 0.252 0.248\n 7   2016 0.256 0.255 0.255\n 8   2017 0.254 0.257 0.253\n 9   2019 0.251 0.251 0.260\n10   2021 0.246 0.242 0.239\n11   2023 0.248 0.249 0.248\n12   2024 0.243 0.244 0.243\n13   2022 0.247 0.239 0.231\n14   2020 0.251 0.238 0.234\n15   2018 0.248 0.249 0.245\n```\n\n\n:::\n:::\n\n\n\n### Lesson 4 In-Class\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhr_df <-\n  Batting |> \n  mutate(HRcareer = cumsum(HR),.by='playerID')\n\n\nhr_leader <- \n  function(data, year){\n    data |> \n      select(yearID,playerID,HRcareer) |> \n      filter(yearID<=year) |> \n      slice_max(HRcareer) |> \n      # arrange(-HRcareer) |> \n      # head(1) |> \n      mutate(year=year) |> \n      relocate(year)\n  }\n\n\nhome_runs<- \nmap_df(.x=1900:2025, .f = ~hr_leader(data=hr_df,year=.x)) |> \n  left_join(People |> select(playerID,nameLast,nameFirst),by='playerID')\n```\n:::\n\n\n\n### GGplot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhome_runs |> \n  ggplot(aes(x=year,y=HRcareer,color=nameLast))+\n  geom_line(linewidth=2)+\n  labs(x='Year',\n       y='Home Run Leader',\n       color='Player',\n       title='Career Homerun Leader by Year')\n```\n\n::: {.cell-output-display}\n![](class_notes_files/figure-pdf/unnamed-chunk-8-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n### Lesson 5\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbatting_df <- \n  Batting |> \n  slice_max(HR,n=10,by=yearID) |> \n  arrange(yearID) |> \n  mutate(era = cut(yearID,\n                   breaks = c(1899, 1919, 1941, 1960, 1976, \n                              1993, 2003, 2050),\n                   labels = c(\"Dead Ball\", \"Lively Ball\", \"Integration\",\n                              \"Expansion\", \"Free Agency\", \"Steroid\",\n                              \"Long Ball\")\n  )\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbatting_df |> \n  # filter(yearID>1899) |> \n  filter(!is.na(era)) |> \n  ggplot(aes(x=yearID, y=HR, color=era)) +\n  geom_point()+\n  geom_smooth()+\n  theme_classic()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](class_notes_files/figure-pdf/unnamed-chunk-10-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nSalaries %>% \n  mutate(decade = floor(yearID / 10) * 10) %>% \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  yearID teamID lgID  playerID  salary decade\n1   2004    SFN   NL aardsda01  300000   2000\n2   2007    CHA   AL aardsda01  387500   2000\n3   2008    BOS   AL aardsda01  403250   2000\n4   2009    SEA   AL aardsda01  419000   2000\n5   2010    SEA   AL aardsda01 2750000   2010\n6   2011    SEA   AL aardsda01 4500000   2010\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nSalaries %>% \n  mutate(decade = floor(yearID / 10) * 10) %>% \n  # ggplot(aes(x =decade, y = salary)) + \n  ggplot(aes(x = as.factor(decade), y = salary)) +\n  geom_boxplot() + \n  scale_y_continuous(labels = scales::comma) +\n  labs(title = \"MLB Salaries by Decade\",\n       y = \"Salary\",\n       x = \"Decade\") + \n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](class_notes_files/figure-pdf/unnamed-chunk-12-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get career wins, earned run average, and strikeouts.\ncareers <- Pitching %>% \n  group_by(playerID) %>% \n  summarize(W = sum(W),\n            ER = sum(ER),\n            IPouts = sum(IPouts),\n            SO = sum(SO)) %>% \n  mutate(ERA = 9*ER/(IPouts/3)) %>% \n  filter(IPouts/3 > 500)\n\n# Add whether they were inducted in the Hall of Fame.\ncareers <- HallOfFame %>% \n  filter(inducted == \"Y\",\n         category == \"Player\") %>% \n  select(playerID, inducted) %>% \n  right_join(careers) %>% \n  mutate(inducted = replace_na(inducted,\"N\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(playerID)`\n```\n\n\n:::\n\n```{.r .cell-code}\ncareers %>% \n  ggplot(aes(x = SO, y = ERA, color = inducted)) +\n  geom_point(size = 1)\n```\n\n::: {.cell-output-display}\n![](class_notes_files/figure-pdf/unnamed-chunk-13-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nclemschil <- careers %>% \n  filter(playerID %in% c(\"clemero02\", \"schilcu01\")) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggrepel)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'ggrepel' was built under R version 4.5.2\n```\n\n\n:::\n\n```{.r .cell-code}\nclemschil <- careers %>% \n  filter(playerID %in% c(\"clemero02\", \"schilcu01\")) \n\ncareers %>% \n  ggplot(aes(x = SO, y = ERA, color = inducted)) +\n  geom_point() +\n  geom_text_repel(data = clemschil, \n                  aes(x = SO, y = ERA, label = playerID),\n                  show.legend = FALSE)\n```\n\n::: {.cell-output-display}\n![](class_notes_files/figure-pdf/unnamed-chunk-14-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggrepel)\nclemschil <- careers %>% \n  filter(playerID %in% c(\"clemero02\", \"schilcu01\")) \n\ncareers %>% \n  ggplot(aes(x = SO, y = ERA, color = inducted)) +\n  geom_point() +\n  geom_text_repel(data = clemschil, \n                  aes(x = SO, y = ERA, label = playerID),\n                  show.legend = FALSE)\n```\n\n::: {.cell-output-display}\n![](class_notes_files/figure-pdf/unnamed-chunk-15-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n### Lesson 8\n\n#### AY26-2 Notes\n\nWent through the way we get to *k* from the pythagoreon model on the board which was good.\n\nAlso did the partial derivative with respect to Runs to find the incremental number of wins per net runs scored. \n\nRan out of time a little at the end to get to the incremental runs model.\n\n\n\n\n### Lesson 9\n\n#### AY26-2 Notes\n\nWent well. Good to emphasize the retrosheet and statcast at the end.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(Lahman)\n\nteams2018 <- Teams |> \n  filter(yearID == 2018) |> \n  mutate(Wpct = W/(W+L),\n         logWL = log(W/L),\n         logRRA = log(R/RA))\n\nk <- teams2018 |> \n  lm(logWL ~ 0 + logRRA, data = _) |> \n  tidy() |> \n  pull(estimate)\n\nteams2018 |> \n  mutate(pred_Wpct = R^k/(R^k+RA^k),\n         residual = Wpct - pred_Wpct) |> \n  ggplot(aes(x=pred_Wpct,y=residual,label=teamID)) +\n  geom_point()+\n  geom_text_repel()+\n  labs(x=\"Predicted Win Percentage\",y='Residuals')\n```\n\n::: {.cell-output-display}\n![](class_notes_files/figure-pdf/unnamed-chunk-16-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(baseballr)\n\nbaseballr::retrosheet_data(years_to_acquire = 2018) |> \n  pluck('events') \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNULL\n```\n\n\n:::\n:::\n\n\n### Lesson 10\n\n#### AY26-2 Notes\n\nMake sure the RunExpectancyMatrix.R is in the files for cadets to download. Maybe use the RunExpectancyMatrixFunctions.R file instead.\n\nMaking them re-run the data from last class was a little clunky.\n\nDidn't have enough time to really dive into the run value by `hit_type` much. Need more on the motivation of each.\n\nShould explain how those values aren't perfectly linear and aren't direct multiples of each other like slugging percentage. \n\n### Lesson 11\n\n#### AY26-2 Notes\n\nTalked about the RunExpectancyMatrixFunctions.R script and Problem Set 3, but still had some extra time at the end.\n\nAdd in some Regular expression from AI prompts for the end of class\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(baseballr)\nretro2024 <-\nretrosheet_data(years_to_acquire = '2024') |>\npluck('2024') |>\npluck('events')\n# Add states and run values, output as retro_event_run_value\n# Also gives the run expectancy matrix as erm_wide\nsource(\"./RunExpectancyMatrixFunctions.R\")\nget_run_expectancy_retro(retro2024)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'bases'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n\n\n### Lesson 12\n\n#### AY26-2 Notes\n\nWent through Statcast data in more detail, got to talk about LOESS smoothing which is fun. Would love to dedicate more time to that.\n\nNot a ton of cadet interaction. Could improve upon that and leave out the last chunk of the data.\n",
    "supporting": [
      "class_notes_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}