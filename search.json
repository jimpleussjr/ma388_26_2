[
  {
    "objectID": "lessons/textbook_toc.html",
    "href": "lessons/textbook_toc.html",
    "title": "textbook summary",
    "section": "",
    "text": "1  The Baseball Datasets\n\n1.1 Introduction\n1.2 The Lahman Database: Season-by-Season Data\n1.3 Retrosheet Game-by-Game Data\n1.4 Retrosheet Play-by-Play Data\n1.5 Pitch-by-Pitch Data\n1.6 Player Movement and Off-the-Bat Data\n1.7 Data Used in this Book\n1.8 Summary\n1.9 Further Reading\n1.10 Exercises\n\n2  Introduction to R\n\n2.1 Introduction\n2.2 Installing R and RStudio\n2.3 The Tidyverse\n2.4 Data Frames\n2.5 Vectors\n2.6 Objects and Containers in R\n2.7 Collection of R Commands\n2.8 Reading and Writing Data in R\n2.9 Packages\n2.10 Splitting, Applying, and Combining Data\n2.11 Getting Help\n2.12 Further Reading\n2.13 Exercises\n\n3  Graphics\n\n3.1 Introduction\n3.2 Character Variable\n3.3 Saving Graphs\n3.4 Numeric Variable: One-Dimensional Scatterplot and Histogram\n3.5 Two Numeric Variables\n3.6 A Numeric Variable and a Factor Variable\n3.7 Comparing Ruth, Aaron, Bonds, and A-Rod\n3.8 The 1998 Home Run Race\n3.9 Further Reading\n3.10 Exercises\n\n4  The Relation Between Runs and Wins\n\n4.1 Introduction\n4.2 The Teams Table in the Lahman Database\n4.3 Linear Regression\n4.4 The Pythagorean Formula for Winning Percentage\n4.5 How Many Runs for a Win?\n4.6 Further Reading\n4.7 Exercises\n\n5  Value of Plays Using Run Expectancy\n\n5.1 The Run Expectancy Matrix\n5.2 Runs Scored in the Remainder of the Inning\n5.3 Creating the Matrix\n5.4 Measuring Success of a Batting Play\n5.5 José Altuve\n5.6 Opportunity and Success for All Hitters\n5.7 Position in the Batting Lineup\n5.8 Run Values of Different Base Hits\n5.9 Value of Base Stealing\n5.10 Further Reading and Software\n5.11 Exercises\n\n6  Balls and Strikes Effects\n\n6.1 Introduction\n6.2 Hitter’s Counts and Pitcher’s Counts\n6.3 Behaviors by Count\n6.4 Further Reading\n6.5 Exercises\n\n7  Catcher Framing\n\n7.1 Introduction\n7.2 Acquiring Pitch-Level Data\n7.3 Where Is the Strike Zone?\n7.4 Modeling Called Strike Percentage\n7.5 Modeling Catcher Framing\n7.6 Further Reading\n7.7 Exercises\n\n8  Career Trajectories\n\n8.1 Introduction\n8.2 Mickey Mantle’s Batting Trajectory\n8.3 Comparing Trajectories\n8.4 General Patterns of Peak Ages\n8.5 Trajectories and Fielding Position\n8.6 Further Reading\n8.7 Exercises\n\n9  Simulation\n\n9.1 Introduction\n9.2 Simulating a Half Inning\n9.3 Simulating a Baseball Season\n9.4 Further Reading\n9.5 Exercises\n\n10  Exploring Streaky Performances\n\n10.1 Introduction\n10.2 The Great Streak\n10.3 Streaks in Individual At-Bats\n10.4 Local Patterns of Statcast Launch Velocity\n10.5 Further Reading\n10.6 Exercises\n\n11  Using a Database to Compute Park Factors\n\n11.1 Introduction\n11.2 Installing MySQL and Creating a Database\n11.3 Connecting R to MySQL\n11.4 Filling a MySQL Game Log Database from R\n11.5 Querying Data from R\n11.6 Building Your Own Baseball Database\n11.7 Calculating Basic Park Factors\n11.8 Further Reading\n11.9 Exercises\n\n12  Working with Large Data\n\n12.1 Introduction\n12.2 Acquiring a Year’s Worth of Statcast Data\n12.3 Storing Large Data Efficiently\n12.4 Performance Comparison\n12.5 Launch Angles and Exit Velocities, Revisited\n12.6 Further Reading\n12.7 Exercises\n\n13  Home Run Hitting\n\n13.1 Introduction\n13.2 Exploring a Season of Home Run Hitting\n13.3 Comparing Home Run Hitting in the 2021 and 2023 Seasons\n13.4 Further Reading\n13.5 Exercises\n\n14  Making a Scientific Presentation using Quarto\n\n14.1 Introduction to Slides in Quarto\n14.2 Example: Jim’s Presentation on Home Run Hitting\n14.3 Alternative Output Formats\n14.4 Further Reading\n14.5 Exercises\n\n15  Using Shiny for Baseball Applications\n\n15.1 Introduction\n15.2 Comparing Two Pitcher Trajectories\n15.3 Creating the Shiny App\n15.4 Sharing the App\n15.5 Tips for Getting Started Making Apps\n15.6 Further Reading\n15.7 Exercises\n\nAppendices\n\nA  Retrosheet Files Reference\nB  Historical Notes on PITCHf/x Data\nC  Statcast Data Reference\nReferences\n\n\nProblem Set descriptions:\n\nData set exploration and dplyr functions\nPlotting career trajectories\nRegression of Win% vs run differential\nSacrifice Bunt"
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html",
    "href": "lessons/lsn_8_runs_and_wins_II.html",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "",
    "text": "library(tidyverse)\nlibrary(Lahman)\nlibrary(knitr)\nlibrary(ggrepel)\nlibrary(broom)"
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html#review",
    "href": "lessons/lsn_8_runs_and_wins_II.html#review",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "Review",
    "text": "Review\nIn our last lesson, we discussed the following model:\n\\(Wins_i = \\beta_0 + \\beta_1 RD_i + \\epsilon_i \\quad \\epsilon_i \\sim \\text{Normal}\\left(0,\\sigma^2\\right)\\)\nwhere \\(Wins_i\\) and \\(RD_i\\) are the wins and run differential for team \\(i\\).\nInterpret the coefficients in this model."
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html#pythagorean-models",
    "href": "lessons/lsn_8_runs_and_wins_II.html#pythagorean-models",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "Pythagorean Models",
    "text": "Pythagorean Models\nDiscuss limitations for the regression model above.\n\n\n\n\n\nHere are three models:\n\\[\\begin{align}\nWpct &= \\beta_0 + \\beta_1 RD + \\epsilon \\\\\nWpct &= \\frac{R^2}{R^2 + RA^2} + \\epsilon \\\\\nWpct &= \\frac{R^k}{R^k + RA^k} + \\epsilon\n\\end{align}\\]\nwhere \\(Wpct\\) is Win Percentage, \\(R\\) is Runs Scored, \\(RA\\) is Runs Allowed, and \\(\\epsilon\\) is the random error. Recall that we fit Model 1 to the 1997-2001 seasons.\nBriefly discuss the strengths/limitations of each model.\n\n\n\n\n\nHow would you assess which model is the best? Please be specific."
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html#model-2-pythagorean-formula-bill-james",
    "href": "lessons/lsn_8_runs_and_wins_II.html#model-2-pythagorean-formula-bill-james",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "Model 2: Pythagorean Formula (Bill James)",
    "text": "Model 2: Pythagorean Formula (Bill James)\nFirst, let’s create a function to calculate the expected wins under a Pythagorean Formula.\n\n# Function to calculate expected wins using Pythagorean formula.\n# Arguments:\n# R - runs scored\n# RA - runs allowed\n# k - exponent\n# Value Returned:\n# expected win percentage\n\npyth_wins &lt;- function(R, RA, k = 2){\n  return(R^k/(R^k + RA^k))\n}\n\nUsing Model 2, let’s calculate the expected number of wins for each team (1997-2001).\n\nmy_teams = Teams |&gt;\n  filter(yearID &gt;= 1997, yearID &lt;= 2001) |&gt;\n  mutate(RD = R - RA,\n         Wpct = W/(W+L),\n         Wpct_pyth2 = pyth_wins(R,RA,2))\n\nNext, let’s compare graphically the predictions from Model 1 and 2.\n\n# Get predicted win percentages from Model 1.\n\nlin_fit &lt;- lm(Wpct ~ RD, data = my_teams)\nmy_teams &lt;- augment(lin_fit, data = my_teams)\n\n# Plot Model 1 and Model 2 predictions.\n\nmy_teams |&gt;\n  ggplot(aes(x = RD, y = .fitted)) + \n  geom_point(col = \"red\") +\n  # geom_point(aes(x = RD, y = Wpct)) +\n  geom_point(aes(x = RD, y = Wpct_pyth2)) +\n  labs(x = \"Run Differential\",\n       y = \"Win Percentage\",\n       title = \"Predicted Win Percentage - Models 1 and 2 (1997-2001)\")\n\n\n\n\n\n\n\nsummary(lin_fit)\n\n\nCall:\nlm(formula = Wpct ~ RD, data = my_teams)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.063492 -0.014889  0.001682  0.014852  0.060984 \n\nCoefficients:\n             Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) 5.000e-01  1.888e-03  264.85   &lt;2e-16 ***\nRD          5.994e-04  1.662e-05   36.06   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.02297 on 146 degrees of freedom\nMultiple R-squared:  0.8991,    Adjusted R-squared:  0.8984 \nF-statistic:  1301 on 1 and 146 DF,  p-value: &lt; 2.2e-16\n\n\nBriefly discuss how the models differ. \n\n\n\n\n\nNext, let’s compare the root mean square error (RMSE). Write an equation for the RMSE. \n\n\n\n\n\n\n# Model 1 RMSE\nsqrt(mean(my_teams$.resid^2))\n\n[1] 0.0228099\n\n# Note this is very close to the Residual Standard Error you could obtain from the model.\nsummary(lin_fit)$sigma\n\n[1] 0.02296561\n\n# Model 2 RMSE\n# Calculate residuals.\nmy_teams = my_teams |&gt;\n  mutate(.resid_pyth2 = Wpct - Wpct_pyth2)\n# Calculate RMSE for Model 2\nsqrt(mean(my_teams$.resid_pyth2^2))\n\n[1] 0.023058\n\n\nNext, let’s take a look at the residuals from Model 2.\n\n# Let's look at a summary of the residuals (min, max, mean, and quartiles).\nmy_teams |&gt;\n  pull(.resid_pyth2) |&gt; \n  summary()\n\n      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. \n-0.0659548 -0.0153919  0.0014263 -0.0001182  0.0158258  0.0612624 \n\nmy_teams |&gt;\n  ggplot(aes(x = Wpct,\n             y = .resid_pyth2)) +\n  geom_point() +\n  labs(x = \"Win Percentage\", y = \"Residuals\",\n       title = \"Residuals vs. Win Percentage (Model 2)\")\n\n\n\n\n\n\n\n\nNext, let’s try Model 3.\nHow do we find an estimate of \\(k\\) in Model 3? \n\n\n\n\n\n\nmy_teams = my_teams |&gt;\n  mutate(logWratio = log(W/L),\n         logRratio = log(R/RA))\n\n# Including 0 in formula means we don't include an intercept.\npythFit &lt;- lm(logWratio ~ 0 + logRratio, data = my_teams)\npythFit\n\n\nCall:\nlm(formula = logWratio ~ 0 + logRratio, data = my_teams)\n\nCoefficients:\nlogRratio  \n    1.904  \n\n\nWhy don’t we want an intercept in this model? (Warning: this is very unusual!) \n\nk = pythFit$coefficients[1]\n\n# Get predictions.\nmy_teams = my_teams |&gt;\n  mutate(Wpct_pyth_k = pyth_wins(R,RA,k = k))\n\n# Get residuals.\nmy_teams = my_teams |&gt;\n  mutate(.resid_pyth_k = Wpct - Wpct_pyth_k)\n\n# Calculate RMSE.\nsqrt(mean(my_teams$.resid_pyth_k^2))\n\n[1] 0.02279093\n\n\n\nmy_teams |&gt;\n  pull(.resid_pyth_k) |&gt; \n  summary()\n\n      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. \n-0.0677086 -0.0162629  0.0011648 -0.0001293  0.0139919  0.0609875 \n\nmy_teams |&gt;\n  ggplot(aes(x = Wpct,\n             y = .resid_pyth_k)) +\n  geom_point() +\n  labs(x = \"Win Percentage\", y = \"Residuals\",\n       title = \"Residuals vs. Win Percentage (Model 3)\") + \n  geom_smooth(method = \"lm\")\n\n\n\n\n\n\n\n\n\nmy_teams |&gt; \n  lm(.resid_pyth_k ~ Wpct, data = _) |&gt; \n  summary()\n\n\nCall:\nlm(formula = .resid_pyth_k ~ Wpct, data = my_teams)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.060232 -0.013571  0.001806  0.013704  0.060461 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -0.04941    0.01261  -3.917 0.000137 ***\nWpct         0.09857    0.02497   3.947 0.000122 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.02181 on 146 degrees of freedom\nMultiple R-squared:  0.09643,   Adjusted R-squared:  0.09024 \nF-statistic: 15.58 on 1 and 146 DF,  p-value: 0.0001225"
  },
  {
    "objectID": "lessons/lsn_8_runs_and_wins_II.html#how-many-runs-for-a-win-pg.-106",
    "href": "lessons/lsn_8_runs_and_wins_II.html#how-many-runs-for-a-win-pg.-106",
    "title": "MA388 Sabermetrics: Lesson 8",
    "section": "How many runs for a win? (pg. 106)",
    "text": "How many runs for a win? (pg. 106)\nPreviously, we learned about the “10-for-1” rule of thumb (number of required runs scored for one additional win) using Model 1. Using Model 2, this quantity changes based on runs allowed. How can we find an expression for the number of required runs scored for one additional win?\n\n\n\n\n\nLet’s explore this for various combinations of runs scored and runs allowed. (Note \\(R\\) and \\(RA\\) below are runs scored per game and runs allowed per game.)\n\n# Function to compute incremental runs per win.\nIR &lt;- function(R = 5, RA = 5){\n  (R^2 + RA^2)^2 /(2*R*RA^2)\n}\n\nir_table &lt;- expand.grid(R = seq(3,6,0.5),\n                        RA = seq(3,6,0.5))\n\nir_table |&gt; \n  mutate(IRW = IR(R,RA)) |&gt;\n  spread(key = RA, value = IRW, sep = \"=\") |&gt;\n  round(1)\n\n    R RA=3 RA=3.5 RA=4 RA=4.5 RA=5 RA=5.5 RA=6\n1 3.0  6.0    6.1  6.5    7.0  7.7    8.5  9.4\n2 3.5  7.2    7.0  7.1    7.5  7.9    8.5  9.2\n3 4.0  8.7    8.1  8.0    8.1  8.4    8.8  9.4\n4 4.5 10.6    9.6  9.1    9.0  9.1    9.4  9.8\n5 5.0 12.8   11.3 10.5   10.1 10.0   10.1 10.3\n6 5.5 15.6   13.4 12.2   11.4 11.1   11.0 11.1\n7 6.0 18.8   15.8 14.1   13.0 12.4   12.1 12.0\n\n\nHow do the results of Model 2 compare to Model 1 (the “10-for-1” model) in terms of incremental runs per win?"
  },
  {
    "objectID": "lessons/lsn_5_r_graphics_II.html",
    "href": "lessons/lsn_5_r_graphics_II.html",
    "title": "MA388 Sabermetrics: Lesson 5",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)\nReview:\nI found the plot below here. Let’s recreate it! You can get part of the way there with what you already know.\nIt will help you to know the dates that correspond to the beginning of different eras:\nFirst, obtain the top-10 HR hitters for each year from 1900 to the present.\nLet’s plot what we have to far.\nNot let’s figure out how to color the points by era. We’ll need to introduce a factor variable that represents dates according to their corresponding eras. See the example in ABDWR section 3.2.1 for an example of the cut() function.\nbatting_df &lt;- batting_df |&gt; \n  mutate(era = cut(yearID,\n                   breaks = c(1899, 1919, 1941, 1960, 1976, \n                              1993, 2003, 2050),\n                   labels = c(\"Dead Ball\", \"Lively Ball\", \"Integration\",\n                              \"Expansion\", \"Free Agency\", \"Steroid\",\n                              \"Long Ball\")\n  )\n  )\nLet’s see a sample of what our data frame looks like now:\nbatting_df |&gt; \n  slice_sample(n = 10)\n\n   yearID HR         era\n1    1967 44   Expansion\n2    2001 49     Steroid\n3    1934 26 Lively Ball\n4    1920 11 Lively Ball\n5    1927 17 Lively Ball\n6    1935 25 Lively Ball\n7    1983 39 Free Agency\n8    1922 17 Lively Ball\n9    2024 39   Long Ball\n10   2020 17   Long Ball\nReady to add the color?"
  },
  {
    "objectID": "lessons/lsn_5_r_graphics_II.html#clemens-and-schilling",
    "href": "lessons/lsn_5_r_graphics_II.html#clemens-and-schilling",
    "title": "MA388 Sabermetrics: Lesson 5",
    "section": "Clemens and Schilling",
    "text": "Clemens and Schilling\n\n\n\nRoger Clemens\n\n\n\n\n\nCurt Schilling\n\n\nFirst, let’s create a data set containing all pitchers with an indicator of whether they are in the Hall of Fame.\n\n# Get career wins, earned run average, and strikeouts.\ncareers &lt;- Pitching |&gt; \n  group_by(playerID) |&gt; \n  summarize(W = sum(W),\n            ER = sum(ER),\n            IPouts = sum(IPouts),\n            SO = sum(SO)) |&gt; \n  mutate(ERA = 9*ER/(IPouts/3)) |&gt; \n  filter(IPouts/3 &gt; 500)\n\n# Add whether they were inducted in the Hall of Fame.\ncareers &lt;- HallOfFame |&gt; \n  filter(inducted == \"Y\",\n         category == \"Player\") |&gt; \n  select(playerID, inducted) |&gt; \n  right_join(careers) |&gt; \n  mutate(inducted = replace_na(inducted,\"N\"))\n\nLet’s look at career strikeouts by whether or not they were inducted.\n\ncareers |&gt; \n  ggplot(aes(x = SO, y = ERA, color = inducted)) +\n  geom_point(size = 1)\n\n\n\n\n\n\n\n\nLet’s figure out where Clemens and Schilling are.\n\nlibrary(ggrepel)\nclemschil &lt;- careers |&gt; \n  filter(playerID %in% c(\"clemero02\", \"schilcu01\")) \n\ncareers |&gt; \n  ggplot(aes(x = SO, y = ERA, color = inducted)) +\n  geom_point() +\n  geom_text_repel(data = clemschil, \n                  aes(x = SO, y = ERA, label = playerID),\n                  show.legend = FALSE)\n\n\n\n\nERA vs. SO by Hall of Fame status for pitchers with at least 500 innings pitched."
  },
  {
    "objectID": "lessons/lsn_5_r_graphics_II.html#your-turn",
    "href": "lessons/lsn_5_r_graphics_II.html#your-turn",
    "title": "MA388 Sabermetrics: Lesson 5",
    "section": "Your Turn",
    "text": "Your Turn\nIn the last figure, there is an uninducted player with about 2500 strikeouts and a 2.5 ERA. Determine who that player is and add his playerID to the plot above."
  },
  {
    "objectID": "lessons/lsn_3_intro_to_R_II.html",
    "href": "lessons/lsn_3_intro_to_R_II.html",
    "title": "MA388 Sabermetrics: Lesson 3",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)"
  },
  {
    "objectID": "lessons/lsn_3_intro_to_R_II.html#review",
    "href": "lessons/lsn_3_intro_to_R_II.html#review",
    "title": "MA388 Sabermetrics: Lesson 3",
    "section": "Review",
    "text": "Review\nKey Concepts\n\nfive tidyverse verbs\nrelational databases\n\nReview Questions\n\nUsing the Teams data frame, calculate average wins (W) per season for each MLB team from 2000-present. Order your results from the best teams to the worst.\n\n\n\n\n\n\nteamID\nW\nG\nWpct\n\n\n\n\nNYA\n2286\n3946\n0.579\n\n\nLAN\n2239\n3948\n0.567\n\n\nSLN\n2179\n3945\n0.552\n\n\nATL\n2152\n3945\n0.546\n\n\nBOS\n2145\n3947\n0.543\n\n\nANA\n425\n810\n0.525\n\n\nSFN\n2052\n3946\n0.520\n\n\nCLE\n2046\n3945\n0.519\n\n\nOAK\n2030\n3946\n0.514\n\n\nHOU\n2029\n3947\n0.514\n\n\nLAA\n1609\n3138\n0.513\n\n\nPHI\n2019\n3947\n0.512\n\n\nMIN\n1984\n3949\n0.502\n\n\nTOR\n1977\n3947\n0.501\n\n\nNYN\n1976\n3946\n0.501\n\n\nSEA\n1975\n3948\n0.500\n\n\nCHN\n1969\n3947\n0.499\n\n\nTBA\n1959\n3946\n0.496\n\n\nMIL\n1960\n3949\n0.496\n\n\nFLO\n963\n1942\n0.496\n\n\nTEX\n1937\n3949\n0.491\n\n\nARI\n1922\n3948\n0.487\n\n\nCHA\n1911\n3948\n0.484\n\n\nWAS\n1510\n3136\n0.482\n\n\nSDN\n1888\n3949\n0.478\n\n\nCIN\n1861\n3950\n0.471\n\n\nDET\n1841\n3943\n0.467\n\n\nCOL\n1809\n3949\n0.458\n\n\nBAL\n1805\n3948\n0.457\n\n\nMON\n368\n810\n0.454\n\n\nPIT\n1767\n3944\n0.448\n\n\nKCA\n1737\n3948\n0.440\n\n\nMIA\n868\n2002\n0.434\n\n\n\n\n\n\nUsing the Teams data frame, calculate how many World Series titles (WSWin) each team had during this period and add this information to your table in the previous question.\n\n\n\n\nWin Percentage and World Series Titles by Team (2000-present).\n\n\nteamID\nW\nG\nWpct\nWSWins\n\n\n\n\nNYA\n2286\n3946\n0.579\n2\n\n\nLAN\n2239\n3948\n0.567\n2\n\n\nSLN\n2179\n3945\n0.552\n2\n\n\nATL\n2152\n3945\n0.546\n1\n\n\nBOS\n2145\n3947\n0.543\n4\n\n\nANA\n425\n810\n0.525\n1\n\n\nSFN\n2052\n3946\n0.520\n3\n\n\nCLE\n2046\n3945\n0.519\n0\n\n\nOAK\n2030\n3946\n0.514\n0\n\n\nHOU\n2029\n3947\n0.514\n2\n\n\nLAA\n1609\n3138\n0.513\n0\n\n\nPHI\n2019\n3947\n0.512\n1\n\n\nMIN\n1984\n3949\n0.502\n0\n\n\nTOR\n1977\n3947\n0.501\n0\n\n\nNYN\n1976\n3946\n0.501\n0\n\n\nSEA\n1975\n3948\n0.500\n0\n\n\nCHN\n1969\n3947\n0.499\n1\n\n\nTBA\n1959\n3946\n0.496\n0\n\n\nMIL\n1960\n3949\n0.496\n0\n\n\nFLO\n963\n1942\n0.496\n1\n\n\nTEX\n1937\n3949\n0.491\n1\n\n\nARI\n1922\n3948\n0.487\n1\n\n\nCHA\n1911\n3948\n0.484\n1\n\n\nWAS\n1510\n3136\n0.482\n1\n\n\nSDN\n1888\n3949\n0.478\n0\n\n\nCIN\n1861\n3950\n0.471\n0\n\n\nDET\n1841\n3943\n0.467\n0\n\n\nCOL\n1809\n3949\n0.458\n0\n\n\nBAL\n1805\n3948\n0.457\n0\n\n\nMON\n368\n810\n0.454\n0\n\n\nPIT\n1767\n3944\n0.448\n0\n\n\nKCA\n1737\n3948\n0.440\n1\n\n\nMIA\n868\n2002\n0.434\n0"
  },
  {
    "objectID": "lessons/lsn_3_intro_to_R_II.html#introduction-to-r-day-2",
    "href": "lessons/lsn_3_intro_to_R_II.html#introduction-to-r-day-2",
    "title": "MA388 Sabermetrics: Lesson 3",
    "section": "Introduction to R (Day 2)",
    "text": "Introduction to R (Day 2)\n\nSplit, Apply, and Combine Data\nIt’s important in data science to be able to write procedures and apply them over a data set. The Marchi text refers to this as “splitting, applying, and combining data.” In other words, we split a data frame into pieces, apply a procedure or function to each piece, and then combine the results into a new data frame.\nWays to “split, apply, and combine”…\n\ngroup_by() and summarize() functions\nsplit() and map_df() functions\n\nIn general, these coding tasks involve four steps:\n\nWrite a function to perform the task on one split of the data.\nPull the individual values of the variable you are splitting on.\nSplit the data on a variable.\nApply the function to each split of the data.\n\n\n\nExample\n\nFour steps:\n\nWrite a function that takes a data frame and returns the team with the most wins and whether they won the World Series.\nPull the yearIDs you will split on.\nSplit the data frame on year.\nApply the function to each split.\n\n\n# Step 1 - Write a function.\nmostWins &lt;- function(data){\n  data |&gt; \n    arrange(-W) |&gt; \n    select(teamID, W, WSWin) |&gt; \n    head(1)\n}\n\n# Step 2 - Pull the years you will split on.\nyear &lt;- Teams |&gt; \n  filter(yearID &gt;= 2000) |&gt; \n  group_by(yearID) |&gt; \n  group_keys() |&gt; \n  pull(yearID)\n\n# Steps 3 and 4 - Split and apply.\nwinLeaders &lt;- Teams |&gt; \n  filter(yearID &gt;= 2000) |&gt; \n  split(year) |&gt;\n  map_df(mostWins, .id = \"yearID\")\n\nwinLeaders |&gt; \n  kable(caption = \"Major League win leaders by season and whether they won the World Series.\")\n\n\nMajor League win leaders by season and whether they won the World Series.\n\n\nyearID\nteamID\nW\nWSWin\n\n\n\n\n2000\nSFN\n97\nN\n\n\n2001\nSEA\n116\nN\n\n\n2002\nNYA\n103\nN\n\n\n2003\nATL\n101\nN\n\n\n2004\nSLN\n105\nN\n\n\n2005\nSLN\n100\nN\n\n\n2006\nNYN\n97\nN\n\n\n2007\nBOS\n96\nY\n\n\n2008\nLAA\n100\nN\n\n\n2009\nNYA\n103\nY\n\n\n2010\nPHI\n97\nN\n\n\n2011\nPHI\n102\nN\n\n\n2012\nWAS\n98\nN\n\n\n2013\nBOS\n97\nY\n\n\n2014\nLAA\n98\nN\n\n\n2015\nSLN\n100\nN\n\n\n2016\nCHN\n103\nY\n\n\n2017\nLAN\n104\nN\n\n\n2018\nBOS\n108\nY\n\n\n2019\nHOU\n107\nN\n\n\n2020\nLAN\n43\nY\n\n\n2021\nSFN\n107\nN\n\n\n2022\nLAN\n111\nN\n\n\n2023\nATL\n104\nN\n\n\n2024\nLAN\n98\nY\n\n\n\n\n\n\n\n\nYour Turn\n\n\n\n\nMajor League win leaders by season and whether they won the World Series.\n\n\nyearID\nname\nHR\n\n\n\n\n2000\nHouston Astros\n249\n\n\n2001\nTexas Rangers\n246\n\n\n2002\nTexas Rangers\n230\n\n\n2003\nTexas Rangers\n239\n\n\n2004\nChicago White Sox\n242\n\n\n2005\nTexas Rangers\n260\n\n\n2006\nChicago White Sox\n236\n\n\n2007\nMilwaukee Brewers\n231\n\n\n2008\nChicago White Sox\n235\n\n\n2009\nNew York Yankees\n244\n\n\n2010\nToronto Blue Jays\n257\n\n\n2011\nNew York Yankees\n222\n\n\n2012\nNew York Yankees\n245\n\n\n2013\nBaltimore Orioles\n212\n\n\n2014\nBaltimore Orioles\n211\n\n\n2015\nToronto Blue Jays\n232\n\n\n2016\nBaltimore Orioles\n253\n\n\n2017\nNew York Yankees\n241\n\n\n2018\nNew York Yankees\n267\n\n\n2019\nMinnesota Twins\n307\n\n\n2020\nLos Angeles Dodgers\n118\n\n\n2021\nToronto Blue Jays\n262\n\n\n2022\nNew York Yankees\n254\n\n\n2023\nAtlanta Braves\n307\n\n\n2024\nNew York Yankees\n237\n\n\n\n\n\nWhat’s the difference between select() and pull()? One key difference is they return different data types.\n\nHRLeaders |&gt; \n  select(yearID)\n\n   yearID\n1    2000\n2    2001\n3    2002\n4    2003\n5    2004\n6    2005\n7    2006\n8    2007\n9    2008\n10   2009\n11   2010\n12   2011\n13   2012\n14   2013\n15   2014\n16   2015\n17   2016\n18   2017\n19   2018\n20   2019\n21   2020\n22   2021\n23   2022\n24   2023\n25   2024\n\nHRLeaders |&gt; \n  pull(yearID)\n\n [1] \"2000\" \"2001\" \"2002\" \"2003\" \"2004\" \"2005\" \"2006\" \"2007\" \"2008\" \"2009\"\n[11] \"2010\" \"2011\" \"2012\" \"2013\" \"2014\" \"2015\" \"2016\" \"2017\" \"2018\" \"2019\"\n[21] \"2020\" \"2021\" \"2022\" \"2023\" \"2024\""
  },
  {
    "objectID": "lessons/lsn_1_course_intro.html",
    "href": "lessons/lsn_1_course_intro.html",
    "title": "MA388 Sabermetrics: Lesson 1",
    "section": "",
    "text": "Contact Information\nLTC Jim Pleuss\njames.pleuss@westpoint.edu\nThayer Hall Room 233\n845-938-7675\nPACE: email, Teams, drop-in, phone\n\n\nCourse Overview\nSabermetrics\n\nCourse Texts/Videos/Blogs\nHands-on/Interactive\nR/RStudio\nCalendar Overview\nGraded Events (Problem Sets and Project)\n\n\n\nIntroductions\nAt some point this semester everyone in this room will be graded on their ability to name everyone else in this room from memory. Start learning names today.\nPlease tell us your:\n\nPreferred Name\nHometown\nMajor\nBranch/Desired Branch\nActivities (Sports, Clubs, Interests)\nUnique Skill / Random Fact\nSong (title and artist) that ups your mood anytime you hear it.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDAW, Section Marcher Role\nBottom line: Do the right thing. I don’t want to have to correct you, but I will. If you don’t know what the right thing to do is, just ask. Too easy!\n\n\nCourse Introduction\nThis course is about three big things (in my mind):\n\nbaseball\nstatistics\ndata science skills\n\nYou’re going to learn a lot about all three. My hope is that you will recognize that the statistics we study and the data science skills you learn through our study of baseball are applicable to many other domains outside of baseball. Are we tricking you into learning some valuable skills by making it about baseball? Maybe…\n\nYou can expect me to…\n\nBe kind and treat you with respect.\nBe approachable and available.\nGet to know you as an individual.\nBe enthusiastic and show relevance of the course to your life.\nSet the conditions for your success.\nUnderstand you have other things going on in your life.\nMake mistakes.\n\n\n\nI expect you to…\n\nKeep an open mind and grow as future officers in our profession.\nBe responsible for your learning.\nUse a variety of sources to aid in understanding.\nKeep me informed of what’s going on in your life.\nActively participate in class.\nBe respectful of your classmates\nMake mistakes. Maybe even more than me…\n\n\n\nCourse Documentation (located on Canvas)\n\nSyllabus (Course Calendar)\nInstructional Memo\nLesson Notes (prior to the lesson)\nProblem Sets (about 10 days in advance of due date)\n\n\n\nCourse Texts\nThe Marchi, Albert, and Baumer text is available online: https://beanumber.github.io/abdwr3e/.\nA collection of functions and data sets for the Marchi text is available here: https://github.com/beanumber/abdwr3edata.\nThe Costa, Huber, and Saccoman text will be provided by the instructor later in the semester.\n\n\nBaseball Video\nIf you need a short introduction to the rules and general flow of a baseball game, this video is a good place to start.\n\nhttps://www.youtube.com/watch?v=skOsApsF0jQ\n\n\n\n\nChapter 1 - Baseball Datasets\n\nThe Lahman Database - Season by Season Data (since 1871)\nRetrosheet - Game by Game Data (since 1871); Play by Play Data (since 1921)\nPITCHf/x - Pitch by Pitch (since 2008)\nStatcast - Launch Angle, Exit Velocity, Distance, Player Positioning (since 2015)\n\nHow do we get all this amazing baseball data? Read Section 1.7 in ABDWR closely. Some data we’ll use will come from packages, and some data will take a bit more effort to assemble…but we can do it.\n\n\n\nChapter 2 - Intro to R\nTidyverse Verbs\n\nselect()\nfilter()\nmutate()\ngroup_by()\nsummarize()\narrange()\n\nLet’s investigate how home run rates in Major League Baseball have changed over time. The R package Lahman imports data from Sean Lahman’s Baseball Archive. In this example, we will use the Batting data frame in the package.\n\nlibrary(Lahman)    # loads data frames in the Lahman package\nlibrary(knitr)     # prints pretty tables with the kable function\nlibrary(tidyverse) # tons of useful stuff - ggplot2, dplyr, ...\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.1.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\n# Batting data frame contains one line per player per season per stint.\n# Here are players with the most home runs for a single team in a season.\nBatting |&gt; \n  select(playerID, yearID, stint, lgID, HR, AB) |&gt; \n  arrange(-HR) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\nplayerID\nyearID\nstint\nlgID\nHR\nAB\n\n\n\n\nbondsba01\n2001\n1\nNL\n73\n476\n\n\nmcgwima01\n1998\n1\nNL\n70\n509\n\n\nsosasa01\n1998\n1\nNL\n66\n643\n\n\nmcgwima01\n1999\n1\nNL\n65\n521\n\n\nsosasa01\n2001\n1\nNL\n64\n577\n\n\nsosasa01\n1999\n1\nNL\n63\n625\n\n\njudgeaa01\n2022\n1\nAL\n62\n570\n\n\nmarisro01\n1961\n1\nAL\n61\n590\n\n\nruthba01\n1927\n1\nAL\n60\n540\n\n\nruthba01\n1921\n1\nAL\n59\n540\n\n\n\n\n\n\nTeams |&gt; \n  mutate(decade = floor(yearID/10)*10) |&gt; \n  relocate(decade,.after='yearID') |&gt; \n  summarize(HRs = sum(HR), Gs = sum(G),.by=decade) |&gt; \n  mutate(HRperG = HRs/Gs) |&gt; \n  arrange(decade) |&gt; \n  ggplot(aes(x=decade,y=HRperG))+\n  geom_bar(stat='identity')\n\n\n\n\n\n\n\n\nSteps to coding an exploration of home run rates over the years:\n\nInclude only players in Major League Baseball.\nCalculate the total number of home runs (HR) and at-bats (AB) each season.\nCalculate the home run rate each season.\n\n\n# Calculate the home run rate for each season.\nhomeRuns &lt;- Batting |&gt; \n  filter(lgID %in% c(\"AL\",\"NL\")) |&gt; \n  group_by(yearID) |&gt; \n  summarize(HR = sum(HR),\n            AB = sum(AB)) |&gt; \n  mutate(rate = HR/AB)\n\nhomeRuns |&gt; \n  head(10) |&gt; \n  kable(digits = 4)\n\n\n\n\nyearID\nHR\nAB\nrate\n\n\n\n\n1876\n40\n20121\n0.0020\n\n\n1877\n24\n13667\n0.0018\n\n\n1878\n23\n13644\n0.0017\n\n\n1879\n58\n24155\n0.0024\n\n\n1880\n62\n24301\n0.0026\n\n\n1881\n76\n24377\n0.0031\n\n\n1882\n126\n24769\n0.0051\n\n\n1883\n124\n29012\n0.0043\n\n\n1884\n321\n32687\n0.0098\n\n\n1885\n174\n31123\n0.0056\n\n\n\n\n\nLet’s look at a plot (more on plotting next lesson)…\n\nhomeRuns |&gt; \n  ggplot(aes(x = yearID,\n             y = rate)) +\n  geom_line() +\n  labs(x = \"Year\",\n       y = \"Home Run Rate\")\n\n\n\n\nHome run rate in Major League Baseball by year."
  },
  {
    "objectID": "lessons/lsn_11_swinging_tendencies.html",
    "href": "lessons/lsn_11_swinging_tendencies.html",
    "title": "MA388 Sabermetrics: Lesson 11",
    "section": "",
    "text": "library(tidyverse)\nlibrary(Lahman)\nlibrary(knitr)"
  },
  {
    "objectID": "lessons/lsn_11_swinging_tendencies.html#chapter-6",
    "href": "lessons/lsn_11_swinging_tendencies.html#chapter-6",
    "title": "MA388 Sabermetrics: Lesson 11",
    "section": "Chapter 6",
    "text": "Chapter 6\nIn Chapter 5, we used run values to evaluate players (RE24) and plays (sacrifice bunting). In this chapter, we’ll use run values to evaluate other aspects of the game. Along the way, you’ll gain some experience working with strings. For example, we might want to investigate the effect of ball-strike count on expected runs.\nWhy does ball-strike count affect expected runs?\nThe goal of today is to calculate the change in expected run value for at-bats passing through each count. Retrosheet play-by-play data records the sequence of pitches in each at-bat in the variable pitch_seq_tx.\n\n# Load the 2011 Retrosheet play-by-play data for 2011.\nsite = \"https://raw.githubusercontent.com/maxtoki/baseball_R/\"\nfields &lt;- read_csv(file = paste(site, \"master/data/fields.csv\", sep =\"\"))\nretro2011 &lt;- read_csv(file = paste(site, \"master/data/all2011.csv\", sep = \"\"),\n                    col_names = pull(fields, Header),\n                    na = character())\ncolnames(retro2011) &lt;- tolower(colnames(retro2011))\n\n# Add states and run_value to every play.\n# (Note the data set has to be called retro2011.)\nsource(\"./RunExpectancyMatrix.R\")\n\nretro2011 |&gt; \n  select(game_id, bat_id, pit_id, pitch_seq_tx, event_cd, inn_ct, outs_ct) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\ngame_id\nbat_id\npit_id\npitch_seq_tx\nevent_cd\ninn_ct\nouts_ct\n\n\n\n\nANA201104080\ndavir003\nsante001\nFBSX\n2\n1\n0\n\n\nANA201104080\nnix-j001\nsante001\nX\n2\n1\n1\n\n\nANA201104080\nbautj002\nsante001\nCBCS\n3\n1\n2\n\n\nANA201104080\niztum001\ndrabk001\nCBBBB\n14\n1\n0\n\n\nANA201104080\nkendh001\ndrabk001\nBCSBS\n3\n1\n0\n\n\nANA201104080\nabreb001\ndrabk001\nCBB1&gt;S\n6\n1\n1\n\n\nANA201104080\nabreb001\ndrabk001\nCBB1&gt;S.FBFB\n14\n1\n2\n\n\nANA201104080\nhuntt001\ndrabk001\nCCX\n20\n1\n2\n\n\nANA201104080\nwellv001\ndrabk001\nBX\n2\n1\n2\n\n\nANA201104080\nlinda001\nsante001\nCBBFX\n2\n2\n0\n\n\n\n\n\nBriefly explain what happened in the first plate appearance of the season pitch_seq_tx = \"FBSX\". Pitch and event codes are at the end of these lesson notes.\nUnfortunately, we have some work to do to get our data in a useful format. Currently, we just have the pitch sequence. Instead, we want a variable for each count indicating whether the plate appearance passed through the count. For example, we’ll create a variable called “c01” indicating whether the plate appearance ever passed through a no balls, one strike count.\nOutline steps to transform the pitch sequence into the indicator variables discussed above for each count.\n\nRegular Expressions\nRegular expressions are useful for detecting and replacing patterns in strings (what’s a string again?). Every programming language uses them. Here is a useful cheat sheet for regular expressions in R.\nSome useful string functions in R include (all from the stringr package with its cheat sheet located here):\n\nstr_detect() (replaces the grepl() function) - detects the presence of a pattern in a string\nstr_replace_all() (replaces the gsub() function) - replaces part of a string with another string\nstr_sub() - extracts substrings based on their location in the string\n\n\nFirst, we are going to remove characters in the pitch sequence that aren’t actual pitches (pick off attempts, stolen bases, etc).\n\nWhich function above should I use?\n\nretro2011 &lt;- retro2011 |&gt; \n  mutate(pseq = str_replace_all(pitch_seq_tx, \"[.&gt;123N+*]\", replacement = \"\"))\nretro2011 |&gt; \n  select(game_id, pitch_seq_tx,pseq) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\ngame_id\npitch_seq_tx\npseq\n\n\n\n\nANA201104080\nFBSX\nFBSX\n\n\nANA201104080\nX\nX\n\n\nANA201104080\nCBCS\nCBCS\n\n\nANA201104080\nCBBBB\nCBBBB\n\n\nANA201104080\nBCSBS\nBCSBS\n\n\nANA201104080\nCBB1&gt;S\nCBBS\n\n\nANA201104080\nCBB1&gt;S.FBFB\nCBBSFBFB\n\n\nANA201104080\nCCX\nCCX\n\n\nANA201104080\nBX\nBX\n\n\nANA201104080\nCBBFX\nCBBFX\n\n\n\n\n\n\nSecond, let’s create the “c10” variable indicating the plate appearance passes through a one ball, no strikes count. This occurs when the first pitch of the sequence is B, I, P, or V. In the regular expression below, the “^” indicates the pattern must occur at the beginning of the string.\n\n\nretro2011 &lt;- retro2011 |&gt; \n  mutate(c10 = str_detect(pseq, \"^[BIPV]\"))\n\nretro2011 |&gt; \n  select(game_id, pitch_seq_tx, pseq, c10) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\ngame_id\npitch_seq_tx\npseq\nc10\n\n\n\n\nANA201104080\nFBSX\nFBSX\nFALSE\n\n\nANA201104080\nX\nX\nFALSE\n\n\nANA201104080\nCBCS\nCBCS\nFALSE\n\n\nANA201104080\nCBBBB\nCBBBB\nFALSE\n\n\nANA201104080\nBCSBS\nBCSBS\nTRUE\n\n\nANA201104080\nCBB1&gt;S\nCBBS\nFALSE\n\n\nANA201104080\nCBB1&gt;S.FBFB\nCBBSFBFB\nFALSE\n\n\nANA201104080\nCCX\nCCX\nFALSE\n\n\nANA201104080\nBX\nBX\nTRUE\n\n\nANA201104080\nCBBFX\nCBBFX\nFALSE\n\n\n\n\n\n\nNext, let’s create the “c01” variable indicating the plate appearance passes through a no balls, one strike count. This occurs when the first pitch of the sequence is C, F, K, L, M, O, Q, R, S, or T.\n\n\nretro2011 &lt;- retro2011 |&gt; \n  mutate(c01 = str_detect(pseq, \"^[CFKLMOQRST]\"))\n\nretro2011 |&gt; \n  select(game_id, pitch_seq_tx, pseq, c10, c01) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\ngame_id\npitch_seq_tx\npseq\nc10\nc01\n\n\n\n\nANA201104080\nFBSX\nFBSX\nFALSE\nTRUE\n\n\nANA201104080\nX\nX\nFALSE\nFALSE\n\n\nANA201104080\nCBCS\nCBCS\nFALSE\nTRUE\n\n\nANA201104080\nCBBBB\nCBBBB\nFALSE\nTRUE\n\n\nANA201104080\nBCSBS\nBCSBS\nTRUE\nFALSE\n\n\nANA201104080\nCBB1&gt;S\nCBBS\nFALSE\nTRUE\n\n\nANA201104080\nCBB1&gt;S.FBFB\nCBBSFBFB\nFALSE\nTRUE\n\n\nANA201104080\nCCX\nCCX\nFALSE\nTRUE\n\n\nANA201104080\nBX\nBX\nTRUE\nFALSE\n\n\nANA201104080\nCBBFX\nCBBFX\nFALSE\nTRUE\n\n\n\n\n\n\nNow, things start getting a little more complicated. Next, let’s create variables for 2-0, 3-0, and 0-2 counts. With these, we just have to see if the patterns repeat themselves. In the regular expression below, the “{2}” and “{3}” indicate the number of repetitions of the pattern required for a match.\n\n\nretro2011 &lt;- retro2011 |&gt; \n  mutate(c20 = str_detect(pseq, \"^[BIPV]{2}\"),\n         c30 = str_detect(pseq, \"^[BIPV]{3}\"),\n         c02 = str_detect(pseq, \"^[CFKLMOQRST]{2}\"))\n\nretro2011 |&gt; \n  select(game_id, pseq, c10, c01, c20, c30, c02) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\ngame_id\npseq\nc10\nc01\nc20\nc30\nc02\n\n\n\n\nANA201104080\nFBSX\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\n\n\nANA201104080\nX\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\n\n\nANA201104080\nCBCS\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\n\n\nANA201104080\nCBBBB\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\n\n\nANA201104080\nBCSBS\nTRUE\nFALSE\nFALSE\nFALSE\nFALSE\n\n\nANA201104080\nCBBS\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\n\n\nANA201104080\nCBBSFBFB\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\n\n\nANA201104080\nCCX\nFALSE\nTRUE\nFALSE\nFALSE\nTRUE\n\n\nANA201104080\nBX\nTRUE\nFALSE\nFALSE\nFALSE\nFALSE\n\n\nANA201104080\nCBBFX\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\n\n\n\n\n\n\nCounts with some number of balls and one strike aren’t much more difficult to find; you just have to account for the different combinations.\n\n# Ball codes.\nb &lt;- \"[BIPV]\"\n# Strike codes.\ns &lt;- \"[CFKLMOQRST]\"  \n\n# 1-1, 2-1, and 3-1 counts.\nretro2011 &lt;- retro2011 |&gt;  \n  mutate(c11 = str_detect(pseq, paste0(\"^\", s, b,\n                                 \"|\", b, s)),\n         c21 = str_detect(pseq, paste0(\"^\", s, b, b, \n                                 \"|\", b, s, b, \n                                 \"|\", b, b, s)),  \n         c31 = str_detect(pseq, paste0(\"^\", s, b, b, b,  \n                                 \"|\", b, s, b, b, \n                                 \"|\", b, b, s, b, \n                                 \"|\", b, b, b, s))) \n\nTwo strike counts are considerably different. A foul ball keeps the number of strikes at two. In other words, the hitter can hit foul balls indefinitely without changing the count when there are two strikes.\n\n\n# 1-2, 2-2, and 3-2 counts.\nretro2011 &lt;- retro2011 |&gt; \n  mutate(c12 = str_detect(pseq, paste0(\"^\", b, s, s,  \n                                       \"|\", s, b, s,\n                                       \"|\", s, s, \"[FR]*\", b)), \n         c22 = str_detect(pseq, paste0(\"^\", b, b, s, s, \n                                       \"|\", b, s, b, s, \n                                       \"|\", b, s, s, \"[FR]*\", b,  \n                                       \"|\", s, b, b, s, \n                                       \"|\", s, b, s, \"[FR]*\", b,  \n                                       \"|\", s, s, \"[FR]*\", b, \"[FR]*\", b)),\n         c32 = str_detect(pseq, paste0(\"^\", s, \"*\", b, s, \n                                       \"*\", b, s,\n                                       \"*\", b))  & \n           str_detect(pseq, paste0(\"^\", b, \"*\", s, b, \"*\", s))) \n\nretro2011 |&gt; \n  select(pseq, c10, c01,c20, c30, c02, c11, c21, c31, c12, c22, c32) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\npseq\nc10\nc01\nc20\nc30\nc02\nc11\nc21\nc31\nc12\nc22\nc32\n\n\n\n\nFBSX\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\nTRUE\nFALSE\nFALSE\nTRUE\nFALSE\nFALSE\n\n\nX\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\n\n\nCBCS\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\nTRUE\nFALSE\nFALSE\nTRUE\nFALSE\nFALSE\n\n\nCBBBB\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\nTRUE\nTRUE\nTRUE\nFALSE\nFALSE\nFALSE\n\n\nBCSBS\nTRUE\nFALSE\nFALSE\nFALSE\nFALSE\nTRUE\nFALSE\nFALSE\nTRUE\nTRUE\nFALSE\n\n\nCBBS\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\nTRUE\nTRUE\nFALSE\nFALSE\nTRUE\nFALSE\n\n\nCBBSFBFB\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\nTRUE\nTRUE\nFALSE\nTRUE\nTRUE\nTRUE\n\n\nCCX\nFALSE\nTRUE\nFALSE\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\n\n\nBX\nTRUE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\nFALSE\n\n\nCBBFX\nFALSE\nTRUE\nFALSE\nFALSE\nFALSE\nTRUE\nTRUE\nFALSE\nFALSE\nTRUE\nFALSE\n\n\n\n\n\nLastly, let’s convert to long format (why is the current format called wide?) and filter for counts the plate appearances passed through.\n\n\n# Convert to long format.\npbp_counts &lt;- retro2011 |&gt; \n  mutate(c00 = TRUE) |&gt;  # All plate appearances pass through 0-0 count.\n  select(starts_with(\"c\"), run_value) |&gt; \n  pivot_longer(cols = -run_value,\n               names_to = \"count\",\n               values_to = \"passes_thru\") |&gt; \n  filter(passes_thru == TRUE)\n\npbp_counts |&gt; \n  head(10)\n\n# A tibble: 10 × 3\n   run_value count passes_thru\n       &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt;      \n 1   -0.216  c01   TRUE       \n 2   -0.216  c11   TRUE       \n 3   -0.216  c12   TRUE       \n 4   -0.216  c00   TRUE       \n 5   -0.158  c00   TRUE       \n 6   -0.0972 c01   TRUE       \n 7   -0.0972 c11   TRUE       \n 8   -0.0972 c12   TRUE       \n 9   -0.0972 c00   TRUE       \n10    0.364  c01   TRUE       \n\nrun_value_by_count &lt;- pbp_counts |&gt; \n  group_by(count) |&gt; \n  summarize(mean_run_value = mean(run_value))\n\nrun_value_by_count |&gt; \n  kable()\n\n\n\n\ncount\nmean_run_value\n\n\n\n\nc00\n0.0019988\n\n\nc01\n-0.0374706\n\n\nc02\n-0.0891545\n\n\nc10\n0.0391984\n\n\nc11\n-0.0137881\n\n\nc12\n-0.0504418\n\n\nc20\n0.0980970\n\n\nc21\n0.0216407\n\n\nc22\n-0.0209781\n\n\nc30\n0.1886023\n\n\nc31\n0.1059794\n\n\nc32\n0.0476942\n\n\n\n\n\n\n\n# Plot the results.\nrun_value_by_count |&gt; \n  mutate(balls = str_sub(count,2,2),\n         strikes = str_sub(count,3,3)) |&gt; \n  ggplot(aes(x = strikes, y = balls, fill = mean_run_value)) +\n  geom_tile() +\n  geom_text(aes(label = round(mean_run_value,3))) +\n  scale_fill_gradient2(\"Mean Run Value\", \n                       low = \"grey10\",\n                       high = \"blue\",\n                       mid = \"white\",\n                       midpoint = 0) + \n  labs(title = \"Mean Run Value for Possible Ball-Strike Counts\")"
  },
  {
    "objectID": "lessons/lsn_11_swinging_tendencies.html#pitch-and-event-codes",
    "href": "lessons/lsn_11_swinging_tendencies.html#pitch-and-event-codes",
    "title": "MA388 Sabermetrics: Lesson 11",
    "section": "Pitch and Event Codes",
    "text": "Pitch and Event Codes\n\n\n\nRetrosheet Pitch Codes\n\n\n\n\n\nEVENT_CD codes"
  },
  {
    "objectID": "calendar/calendar.html",
    "href": "calendar/calendar.html",
    "title": "MA388 Sabermetrics Calendar",
    "section": "",
    "text": "Your browser does not support PDFs. &lt;a href=\"MA388_CompositeCalendar_AY26-2_Current.pdf\"&gt;Download the calendar PDF&lt;/a&gt;."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "MA388 Sabermetrics AY26-2",
    "section": "",
    "text": "Welcome to MA388 Sabermetrics for AY26-2.\nUse the navigation menu above to access lesson materials.\n\n\nCourse Objectives. By the end of the semester, you should be able to:\n\nUse the investigative process in statistics to answer research questions of interest in sabermetrics.\nUse statistical software to obtain, prepare, summarize, visualize, and model complex data.\nIdentify and employ advanced statistical methods for estimation and prediction to answer questions in sabermetrics.\nDraw appropriate conclusions from statistical analyses and communicate them to general audiences.\nAppreciate the importance and limitations of statistical inquiry to answer questions of interest.\nBe critical consumers of statistically based results and recognize whether reported results reasonably follow from the study and analysis conducted. Course Materials.\n\n\n\nTextbooks:\n\nAnalyzing Baseball Data with R (Third Edition) by Marchi, Albert, and Baumer\nThe textbook authors have made this book available for free online at this link.\nUnderstanding Sabermetrics (2nd Edition) by Costa, Huber, and Saccoman\nThis textbook will be provided to cadets by the instructor."
  },
  {
    "objectID": "lessons/lsn_10_hits_stealing.html",
    "href": "lessons/lsn_10_hits_stealing.html",
    "title": "MA388 Sabermetrics: Lesson 10",
    "section": "",
    "text": "Last class, we discussed the Run Expectancy Matrix and how to obtain it from the Retrosheet play-by-play data.\n\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(Lahman)\n\nerm_2011_wide &lt;- read_csv(file = \"erm_2011_wide.csv\")\n\nkable(erm_2011_wide)\n\n\n\n\nbases\nOuts=0\nOuts=1\nOuts=2\n\n\n\n\n000\n0.4711649\n0.2546956\n0.0971845\n\n\n001\n1.4543568\n0.9374359\n0.3173913\n\n\n010\n1.0582804\n0.6501976\n0.3091673\n\n\n011\n1.9304897\n1.3388641\n0.5407407\n\n\n100\n0.8350992\n0.4960492\n0.2179536\n\n\n101\n1.7526998\n1.1496169\n0.4882597\n\n\n110\n1.4144549\n0.8739176\n0.4222569\n\n\n111\n2.1718266\n1.4745146\n0.7610094"
  },
  {
    "objectID": "lessons/lsn_10_hits_stealing.html#review",
    "href": "lessons/lsn_10_hits_stealing.html#review",
    "title": "MA388 Sabermetrics: Lesson 10",
    "section": "",
    "text": "Last class, we discussed the Run Expectancy Matrix and how to obtain it from the Retrosheet play-by-play data.\n\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(Lahman)\n\nerm_2011_wide &lt;- read_csv(file = \"erm_2011_wide.csv\")\n\nkable(erm_2011_wide)\n\n\n\n\nbases\nOuts=0\nOuts=1\nOuts=2\n\n\n\n\n000\n0.4711649\n0.2546956\n0.0971845\n\n\n001\n1.4543568\n0.9374359\n0.3173913\n\n\n010\n1.0582804\n0.6501976\n0.3091673\n\n\n011\n1.9304897\n1.3388641\n0.5407407\n\n\n100\n0.8350992\n0.4960492\n0.2179536\n\n\n101\n1.7526998\n1.1496169\n0.4882597\n\n\n110\n1.4144549\n0.8739176\n0.4222569\n\n\n111\n2.1718266\n1.4745146\n0.7610094"
  },
  {
    "objectID": "lessons/lsn_10_hits_stealing.html#measuring-the-success-of-a-batting-play",
    "href": "lessons/lsn_10_hits_stealing.html#measuring-the-success-of-a-batting-play",
    "title": "MA388 Sabermetrics: Lesson 10",
    "section": "Measuring the Success of a Batting Play",
    "text": "Measuring the Success of a Batting Play\nWe can estimate the value of a plate appearance as the difference in run expectancy between the new and old states plus the number of runs scored on the play.\n\\(\\text{RUN VALUE} = \\text{E[RUNS]}_\\text{new state} -  \\text{E[RUNS]}_\\text{old state} + \\text{RUNS}_\\text{scored on play}\\)\nCalculate the RUN VALUE of the following plays:\n\nThere are runners on first and second with no outs. The batter successfully sacrifice bunts, resulting in runners on second and third with one out.\n\n\nThere is a runner on second base with no outs. The batter hits a single that scores the runner from second. The batter stops at first base.\n\n\nWhat is the most valuable play in baseball? Explain."
  },
  {
    "objectID": "lessons/lsn_10_hits_stealing.html#measuring-batting-success-over-a-season-david-ortiz",
    "href": "lessons/lsn_10_hits_stealing.html#measuring-batting-success-over-a-season-david-ortiz",
    "title": "MA388 Sabermetrics: Lesson 10",
    "section": "Measuring Batting Success Over a Season: David Ortiz",
    "text": "Measuring Batting Success Over a Season: David Ortiz\nWe’ll start with all batting events in the 2011 season.\n\n# Load the data.\nsite = \"https://raw.githubusercontent.com/maxtoki/baseball_R/\"\nfields &lt;- read_csv(file = paste(site, \"master/data/fields.csv\", sep =\"\"))\nretro2011 &lt;- read_csv(file = paste(site, \"master/data/all2011.csv\", sep = \"\"),\n                    col_names = pull(fields, Header),\n                    na = character())\ncolnames(retro2011) &lt;- tolower(colnames(retro2011))\n\n# Add states and run values.\n# (Note the data set has to be called retro2011.)\nsource(\"./RunExpectancyMatrix.R\")\n\nNow let’s look specifically at David Ortiz.\n\n# Get Ortiz's playerID.\nortizID &lt;- People |&gt;\n  filter(nameFirst == \"David\", nameLast == \"Ortiz\") |&gt; \n  pull(retroID)\n\nortiz_df &lt;- retro2011 |&gt; \n  filter(bat_id == ortizID,\n         bat_event_fl == TRUE)\n\nortiz_df |&gt; \n  select(game_id, inn_ct, state, new_state, run_value) |&gt;\n  head(10) |&gt; \n  kable()\n\n\n\n\ngame_id\ninn_ct\nstate\nnew_state\nrun_value\n\n\n\n\nANA201104210\n2\n000 0\n010 0\n0.5871155\n\n\nANA201104210\n4\n000 0\n000 1\n-0.2164694\n\n\nANA201104210\n6\n000 0\n100 0\n0.3639342\n\n\nANA201104210\n7\n110 2\n110 3\n-0.4222569\n\n\nANA201104210\n9\n000 2\n100 2\n0.1207691\n\n\nANA201104220\n2\n000 0\n000 1\n-0.2164694\n\n\nANA201104220\n4\n000 1\n000 2\n-0.1575110\n\n\nANA201104220\n5\n101 2\n101 3\n-0.4882597\n\n\nANA201104220\n7\n010 2\n010 3\n-0.3091673\n\n\nANA201104230\n2\n000 0\n000 1\n-0.2164694\n\n\n\n\n\nHere’s a plot of Ortiz’s run values by runner state.\n\nortiz_df |&gt;\n  ggplot(aes(x = bases, y = run_value)) +\n  geom_jitter(width = 0.25, alpha = 0.5) +\n  geom_hline(yintercept = 0, color = \"blue\") +\n  labs(x = \"Baserunners\",\n       y = \"Run Value\",\n       title = \"Run Values of Big Papi At-Bats in 2011\")\n\n\n\n\n\n\n\n\nNext, let’s look at total runs in different baserunner situations.\n\nruns_ortiz &lt;- ortiz_df |&gt;\n  group_by(bases) |&gt; \n  summarize(runs = sum(run_value) |&gt; round(1),\n            PA = n())\n\nruns_ortiz |&gt; kable()\n\n\n\n\nbases\nruns\nPA\n\n\n\n\n000\n13.1\n301\n\n\n001\n0.8\n11\n\n\n010\n3.4\n44\n\n\n011\n-0.9\n27\n\n\n100\n14.9\n127\n\n\n101\n-2.2\n27\n\n\n110\n4.4\n50\n\n\n111\n2.1\n18\n\n\n\n\n\nLastly, we can calculate a statistic called RE24 which sums runs over the different baserunner combinations.\n\nruns_ortiz |&gt; \n  summarize(RE24 = sum(runs))\n\n# A tibble: 1 × 1\n   RE24\n  &lt;dbl&gt;\n1  35.6\n\n\nHow do we interpret RE24?\nCome up with a modification for RE24 that could be used to rank batters according to what they produced given the opportunity they had. How would you do it?"
  },
  {
    "objectID": "lessons/lsn_10_hits_stealing.html#part-ii---measuring-the-success-of-a-stolen-base-attempt",
    "href": "lessons/lsn_10_hits_stealing.html#part-ii---measuring-the-success-of-a-stolen-base-attempt",
    "title": "MA388 Sabermetrics: Lesson 10",
    "section": "Part II - Measuring the Success of a Stolen Base Attempt",
    "text": "Part II - Measuring the Success of a Stolen Base Attempt\nYour book dedicates roughly three pages to evaluating base stealing. We’re going to discuss it briefly and return to our evaluation of batting performance. Your task: Develop an RE24-inspired measure to rank MLB’s top base stealers.\nLet’s start with the same approach to valuing an individual event.\n\\(\\text{RUN VALUE} = \\text{RUNS}_\\text{new state} -  \\text{RUNS}_\\text{old state} + \\text{RUNS}_\\text{scored on play}\\)\nwhere \\(\\text{RUNS}_\\text{new state}\\) and \\(\\text{RUNS}_\\text{old state}\\) are their respective entries in the run expectancy matrix and \\(\\text{RUNS}_\\text{scored on play}\\) is the number of runs that scored on the play.\n\nkable(erm_2011_wide)\n\n\n\n\nbases\nOuts=0\nOuts=1\nOuts=2\n\n\n\n\n000\n0.4711649\n0.2546956\n0.0971845\n\n\n001\n1.4543568\n0.9374359\n0.3173913\n\n\n010\n1.0582804\n0.6501976\n0.3091673\n\n\n011\n1.9304897\n1.3388641\n0.5407407\n\n\n100\n0.8350992\n0.4960492\n0.2179536\n\n\n101\n1.7526998\n1.1496169\n0.4882597\n\n\n110\n1.4144549\n0.8739176\n0.4222569\n\n\n111\n2.1718266\n1.4745146\n0.7610094\n\n\n\n\n\nLet’s say there is a runner on first base with no outs and you are considering bunting. Historically, a bunt in this situation would result in a runner on second with one out 75% of the time, a runner on first and second with no outs 10% of the time, a runner on first with one out 10% of the time, and runners on second and third with no outs 5% of the time. If you have an average hitter at bat, does bunting or hitting away have the highest expected run value?\nFor more on bunting, see our textbook author’s blog."
  },
  {
    "objectID": "lessons/lsn_10_hits_stealing.html#re24",
    "href": "lessons/lsn_10_hits_stealing.html#re24",
    "title": "MA388 Sabermetrics: Lesson 10",
    "section": "RE24",
    "text": "RE24\nEarlier, we investigated the run value of David Ortiz’s 2011 plate appearances. We can aggregate these run values for each player to a single statistic called “RE24”.\n\nIn baseball, there are context-dependent and context-independent statistics. \nCalculate the RE24, plate appearances, and total starting run expectancy for each player in 2011.\n\nre24_2011 &lt;- retro2011 |&gt; \n  group_by(bat_id) |&gt; \n  summarize(re24 = sum(run_value),\n            PA = length(run_value),\n            runs_start = sum(rv_start)) |&gt; \n  arrange(-re24)\n\n# Add names from the People data frame (note it's not playerID, but retroID).\nre24_2011 &lt;- re24_2011 |&gt;\n  left_join(select(People, retroID, nameLast, nameFirst),\n            by = c(\"bat_id\" = \"retroID\")) |&gt; \n  mutate(name = paste(nameFirst, nameLast, sep = \" \")) |&gt; \n  select(-nameLast, -nameFirst)\n\nre24_2011 |&gt; \n  head(15) |&gt; \n  kable(digits = 1)\n\n\n\n\nbat_id\nre24\nPA\nruns_start\nname\n\n\n\n\ncabrm001\n73.9\n701\n332.9\nMiguel Cabrera\n\n\nbautj002\n73.6\n693\n332.8\nJose Bautista\n\n\nfielp001\n65.6\n734\n363.6\nPrince Fielder\n\n\nvottj001\n64.5\n743\n343.3\nJoey Votto\n\n\nbraur002\n61.9\n663\n316.3\nRyan Braun\n\n\nkempm001\n60.1\n704\n349.1\nMatt Kemp\n\n\nellsj001\n58.1\n748\n347.4\nJacoby Ellsbury\n\n\ngonza003\n57.3\n755\n367.3\nAdrian Gonzalez\n\n\nberkl001\n55.4\n600\n289.4\nLance Berkman\n\n\nmartv001\n49.3\n606\n318.2\nVictor Martinez\n\n\ncanor001\n49.1\n695\n335.9\nRobinson Cano\n\n\nnapom001\n46.6\n444\n215.0\nMike Napoli\n\n\ngranc001\n44.1\n727\n362.9\nCurtis Granderson\n\n\nteixm001\n41.2\n718\n347.9\nMark Teixeira\n\n\ngorda001\n41.1\n727\n344.3\nAlex Gordon\n\n\n\n\n\n\nFirst, let’s see if the average is about zero.\n\nre24_2011 |&gt; \n  summarize(mean_RE24 = mean(re24))\n\n# A tibble: 1 × 1\n  mean_RE24\n      &lt;dbl&gt;\n1     0.411\n\n\nNow, let’s plot RE24 for each player versus starting runs.\n\nlibrary(ggrepel)\n\n# Create data frame of points to label.\nlabels &lt;- re24_2011 |&gt; \n  filter(PA &gt;= 502) |&gt; \n  filter(re24 &gt; 50 | re24 &lt; -30)\n\n\nre24_2011 |&gt; \n  filter(PA &gt;= 502) |&gt; \n  ggplot(aes(x = runs_start, y = re24)) +\n  geom_point() +\n  geom_smooth(se = FALSE) +\n  geom_text_repel(data = labels, aes(x = runs_start, \n                                     y = re24,\n                                     label = name)) + \n  labs(title = \"Player RE24 vs. Opportunity\",\n       x = \"Cumulative Starting Run Value for All At-Bats\",\n       y = \"RE24\")\n\n\n\n\nRE24 versus starting runs for all players with at least 502 plate appearances (2011)\n\n\n\n\nBriefly summarize what you would conclude from this chart."
  },
  {
    "objectID": "lessons/lsn_10_hits_stealing.html#value-of-hits",
    "href": "lessons/lsn_10_hits_stealing.html#value-of-hits",
    "title": "MA388 Sabermetrics: Lesson 10",
    "section": "Value of Hits",
    "text": "Value of Hits\n - Traditionally, baseball analysts and fans used batting average to assess players.\n\\[AVG = \\frac{H}{AB}\\]\nwhere \\(H\\) is the number of hits and \\(AB\\) is the number of at bats.\n - Alternatively, slugging percentage weights the different types of hits by the number of bases the hitter gets.\n\\[SLG = \\frac{X_{1B} + 2\\times X_{2B} + 3 \\times X_{3B} + 4 \\times HR}{AB}\\] \n\n\n# Event Code (variable: EVENT_CD)\n# Single: 20\n# Double: 21\n# Triple: 22\n# Home Run: 23\n\n# Create a look-up table to add event names (single, etc) to the data set.\ncodes &lt;- data.frame(event_cd = 20:23,\n                    hit_type = factor(c(\"single\", \"double\", \"triple\", \"home run\"),\n                                      levels = c(\"single\", \"double\", \"triple\", \"home run\")))\n\ncodes |&gt; \n  kable(caption = \"Event codes for each hit type.\")\n\n\nEvent codes for each hit type.\n\n\nevent_cd\nhit_type\n\n\n\n\n20\nsingle\n\n\n21\ndouble\n\n\n22\ntriple\n\n\n23\nhome run\n\n\n\n\n# Calculate mean hit values.\nmean_hit_values &lt;- retro2011 |&gt; \n  filter(event_cd %in% 20:23) |&gt; \n  left_join(codes) |&gt; \n  group_by(hit_type) |&gt; \n  summarize(mean_value = mean(run_value))\n\nmean_hit_values |&gt; \n  kable(digits = 2, caption = \"Mean run value for each hit type (2011).\")\n\n\nMean run value for each hit type (2011).\n\n\nhit_type\nmean_value\n\n\n\n\nsingle\n0.44\n\n\ndouble\n0.74\n\n\ntriple\n1.06\n\n\nhome run\n1.39\n\n\n\n\n\n\n# Plot run values.\nretro2011 |&gt; \n  filter(event_cd %in% 20:23) |&gt; \n  left_join(codes) |&gt; \n  ggplot(aes(x = run_value)) +\n  geom_histogram() +\n  geom_vline(data = mean_hit_values, aes(xintercept = mean_value), col = \"red\", size = 2) + \n  facet_wrap(~ hit_type, ncol = 1, scales = \"free_y\") + \n  labs(title = \"Run Values of Various Hit Types\",\n       x = \"Run Value\",\n       y = \"Count\")\n\n\n\n\n\n\n\n\n\nLet’s see if we can find players whose slugging percentage is a good predictor of RE24.\n\n# Add slugging percentage to the RE24 data frame.\nre24_2011 &lt;- Batting |&gt; \n  filter(yearID == 2011) |&gt; \n  group_by(playerID) |&gt; \n  summarize(H = sum(H),\n            X2B = sum(X2B),\n            X3B = sum(X3B),\n            HR = sum(HR),\n            AB = sum(AB)) |&gt; \n  mutate(X1B = H - X2B - X3B - HR,\n         SLG = (X1B + 2*X2B + 3*X3B + 4*HR)/AB) |&gt; \n  left_join(select(People, playerID, retroID)) |&gt; \n  right_join(re24_2011, by = c(\"retroID\" = \"bat_id\"))\n\n\n(Random aside: As an alternative to a figure title, consider labeling the figure in a caption. Professional publications often prefer a caption that provides a title and description for a well-labeled figure.)\n\nre24_2011 |&gt; \n  filter(AB &gt; 400) |&gt; \n  ggplot(aes(x = SLG, y = re24)) +\n  geom_point() + \n  labs(x = \"Slugging Percentage\",\n       y = \"RE24\")\n\n\n\n\nRE24 versus slugging percentage\n\n\n\n\n\nre24_2011 |&gt; \n  filter(AB &gt; 400) |&gt; \n  arrange(-SLG) |&gt; \n  select(name, H, AB, PA, X1B, X2B, X3B, HR, SLG, re24, runs_start) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nname\nH\nAB\nPA\nX1B\nX2B\nX3B\nHR\nSLG\nre24\nruns_start\n\n\n\n\nJose Bautista\n155\n513\n693\n86\n24\n2\n43\n0.6081871\n73.61702\n332.8156\n\n\nRyan Braun\n187\n563\n663\n110\n38\n6\n33\n0.5968028\n61.94758\n316.2900\n\n\nMatt Kemp\n195\n602\n704\n119\n33\n4\n39\n0.5863787\n60.14660\n349.1314\n\n\nMiguel Cabrera\n197\n572\n701\n119\n48\n0\n30\n0.5856643\n73.90067\n332.8927\n\n\nPrince Fielder\n170\n569\n734\n95\n36\n1\n38\n0.5659051\n65.60064\n363.6424\n\n\nAdrian Beltre\n144\n487\n543\n79\n33\n0\n32\n0.5605749\n32.08008\n265.6730\n\n\nDavid Ortiz\n162\n525\n627\n92\n40\n1\n29\n0.5542857\n38.99476\n326.2239\n\n\nCurtis Granderson\n153\n583\n727\n76\n26\n10\n41\n0.5523156\n44.05812\n362.8833\n\n\nPablo Sandoval\n134\n426\n476\n82\n26\n3\n23\n0.5516432\n22.49106\n217.8158\n\n\nJacoby Ellsbury\n212\n660\n748\n129\n46\n5\n32\n0.5515152\n58.05313\n347.4389"
  },
  {
    "objectID": "lessons/lsn_12_umpire_tendencies.html",
    "href": "lessons/lsn_12_umpire_tendencies.html",
    "title": "MA388 Sabermetrics: Lesson 12",
    "section": "",
    "text": "library(tidyverse)\nlibrary(knitr)\n\nToday we’re going to take our first look at pitch data in terms of where a pitch crossed (or didn’t cross) home plate and the umpire’s associated call.\n\nload(\"./balls_strikes_count.Rdata\")\n\nHere’s a glimpse of the data frame we’ll use.\n\numpires |&gt; \n  head() |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nseason\numpire\nbatter_hand\npitch_type\nballs\nstrikes\npx\npz\ncalled_strike\n\n\n\n\n2012\nMike Muchlinski\nL\nFF\n3\n1\n-0.31\n5.00\n0\n\n\n2012\nMike Muchlinski\nR\nSL\n0\n0\n-0.18\n2.46\n1\n\n\n2012\nMike Muchlinski\nL\nFF\n2\n1\n0.78\n3.62\n0\n\n\n2012\nMike Muchlinski\nL\nFA\n1\n1\n-0.85\n0.89\n0\n\n\n2012\nMike Muchlinski\nL\nSL\n0\n0\n-0.55\n3.85\n0\n\n\n2012\nMike Muchlinski\nL\nFF\n2\n1\n-0.76\n2.97\n1\n\n\n\n\n\nDo umpires adjust their strike zone based on the count? How might we go about gathering evidence?\n\n\n\n\n\n\nWe’ll want to look at strike vs. ball calls throughout the strike zone and surrounding area, so let’s build a data frame consisting of combinations of horizontal locations from -2 (two feet to the left of the middle of home plate) to +2 (two feet to the right of home plate) and vertical locations from the ground (value of 0) to five feet above the ground.\n\npred_area &lt;- expand.grid(px = seq(-2, 2, by = 0.1),\n                        pz = seq(0, 5, by = 0.1))\n\nLet’s create a base plot with the strike zone outlined and then add our grid on top.\n\nk_zone_plot &lt;- ggplot(pred_area, aes(x = px, y = pz)) +\n  geom_rect(xmin = -0.947, xmax= 0.947, ymin = 1.5, ymax = 3.6, \n            fill = \"lightgray\", alpha = 0.3) +\n  coord_equal() +\n  scale_x_continuous(\"Horizontal Location (ft.)\", limits = c(-2, 2)) +\n  scale_y_continuous(\"Vertical Location (ft.)\", limits = c(0, 5))\nk_zone_plot + \n  geom_point(size = .5, alpha = 0.3)\n\n\n\n\n\n\n\n\n\n\nDigging into the Code!\nWhat’s happening here? Annotate the code.\n\nump_count_fits &lt;- umpires |&gt;\n  filter(batter_hand == \"R\",\n         balls == 0 & strikes == 0 |\n         balls == 3 & strikes == 0 |\n         balls == 0 & strikes == 2) |&gt; \n  \n  mutate(count = paste(balls, strikes, sep = \"-\")) %&gt;% \n  \n  # split(_$count) |&gt; \n  split(pull(., count)) |&gt;\n  \n  map(sample_n, 3000) %&gt;% \n  \n  map(~loess(called_strike ~ px + pz, \n             data = ., \n             control = loess.control(surface = \"direct\"))) |&gt; \n  \n  map(predict, newdata = pred_area) |&gt; \n  \n  map(~data.frame(fit = as.numeric(.))) |&gt; \n  \n  map_df(bind_cols, pred_area, .id = \"count\")\n\n\nk_zone_plot %+% \n  filter(ump_count_fits, \n         fit &lt; 0.6 & fit &gt; 0.4) +\n  geom_contour(aes(z = fit, color = count, linetype = count),\n               binwidth = 0.1, lwd = 1.5)\n\n\n\n\n\n\n\n\n\nMy Explanation: If we believe the count may affect an umpire’s strike zone, we’ll need to capture each unique count similarly to how we’ve previously captured the STATE when analyzing run expectancy. To do this we create a variable for count by combining the number of balls and strikes. We’ve narrowed our interest to right-handed batters and a neutral count, a hitter’s count, and a pitcher’s count. We then split the data on count and randomly draw 3,000 pitches that occurred with that count.\nWe then fit a LOESS model that attempts to fit a locally estimated surface to the average strike call value (0 vs. 1) at each of our data points (pitches).\nNext, we compute a set of predictions for each point on our grid for each count (one model per split in our original data frame). We then convert the numeric matrices returned by predict into a numeric vector called fit before turning those vectors into one dimensional data frames. These data frames are then added to the pred_area data frame with the bind_cols() command, effectively adding the likelihood of a strike call to every (px,pz) combination for every count (0-0, 0-2, 3-0)."
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html",
    "href": "lessons/lsn_2_intro_to_R.html",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)"
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html#compiling-an-.qmd-file",
    "href": "lessons/lsn_2_intro_to_R.html#compiling-an-.qmd-file",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "Compiling an .qmd file",
    "text": "Compiling an .qmd file\nYou’ll submit most assignments in this course as PDFs via Canvas. Let’s make sure you can produce a PDF from Quarto Markdown. If you already know how to do this, sit tight for a minute…\nIf this is new for you, you’ll need to install a TeX distribution. This is easy with TinyTeX.\n\ninstall.packages(\"tinytex\")\n\nWith that package loaded, you’re ready to install TeX.\n\ntinytex::install_tinytex()\n\nNow you should be able to download the source file for these class notes (see “lsn_2_intro_to_R.qmd”) and “Render to PDF.” Make sure this works before the end of class today."
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html#r-syntax-best-practices",
    "href": "lessons/lsn_2_intro_to_R.html#r-syntax-best-practices",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "R Syntax Best Practices",
    "text": "R Syntax Best Practices\n\nVariable Assignemnt\nA lot of folks like to use the = sign to assign variable names. While it generally does work, the more appropriate syntax is -&gt; or &lt;-, depending on which side of the argument your variable name is. = is used more for\n\n\nPiping\nThe pipe passes the output of the previous argument to the first argument of the following function. It’s incredibly useful for data munging. You are probably most familiar with the pipe that looks like %&gt;%. However, that pipe is specific to the dplyr package. There is now a pipe that is native to base R that is probably better to use |&gt;."
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html#review",
    "href": "lessons/lsn_2_intro_to_R.html#review",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "Review",
    "text": "Review\n\nYou are investigating whether the hit-and-run is a good strategy. Which data set should you use?\n\n\nYou are investigating whether pitchers throw more fastballs to hitters at the bottom of the batting order. Which data set would you use?\n\n\nUse R to find career batting average (H/AB) leaders of your favorite team. More specifically, select a team and report a table of the 10 players with at least 2500 at bats (AB) with the highest batting averages while playing for that team.\n\n\n\n\nRed Sox Career Batting Average Leaders\n\n\nplayerID\nH\nAB\nAVG\n\n\n\n\nwillite01\n2654\n7706\n0.344\n\n\nboggswa01\n2098\n6213\n0.338\n\n\nspeaktr01\n1327\n3935\n0.337\n\n\ngarcino01\n1281\n3968\n0.323\n\n\nrunnepe01\n825\n2578\n0.320\n\n\nfoxxji01\n1051\n3288\n0.320\n\n\npeskyjo01\n1277\n4085\n0.313\n\n\nramirma02\n1232\n3953\n0.312\n\n\nlynnfr01\n944\n3062\n0.308\n\n\ngoodmbi01\n1344\n4399\n0.306"
  },
  {
    "objectID": "lessons/lsn_2_intro_to_R.html#merging-data-frames-pg-41",
    "href": "lessons/lsn_2_intro_to_R.html#merging-data-frames-pg-41",
    "title": "MA388 Sabermetrics: Lesson 2",
    "section": "Merging Data Frames (pg 41)",
    "text": "Merging Data Frames (pg 41)\nWhen using a relational database (what does that mean again?), a common task is to add information from one table to another. For example, consider our table above from the review. Add the player’s name and when they played their final game.\n\n# I called my table from the review redSox.\n\nredSox &lt;- redSox |&gt;\n  left_join(select(People, playerID, nameLast, nameFirst, finalGame), by = \"playerID\" )\n\nYour turn…the HallofFame data frame contains data on every Hall of Fame ballot. Add to your table above whether the player is in the Hall of Fame. (hint: filter(inducted == \"Y\"))\n\n\n\nRed Sox career batting average leaders\n\n\n\n\n\n\n\n\n\n\n\n\n\nplayerID\nH\nAB\nAVG\nnameLast\nnameFirst\nfinalGame\nyearID\ninducted\n\n\n\n\nwillite01\n2654\n7706\n0.344\nWilliams\nTed\n1960-09-28\n1966\nY\n\n\nboggswa01\n2098\n6213\n0.338\nBoggs\nWade\n1999-08-27\n2005\nY\n\n\nspeaktr01\n1327\n3935\n0.337\nSpeaker\nTris\n1928-08-30\n1937\nY\n\n\ngarcino01\n1281\n3968\n0.323\nGarciaparra\nNomar\n2009-10-04\nNA\nNA\n\n\nrunnepe01\n825\n2578\n0.320\nRunnels\nPete\n1964-05-14\nNA\nNA\n\n\nfoxxji01\n1051\n3288\n0.320\nFoxx\nJimmie\n1945-09-23\n1951\nY\n\n\npeskyjo01\n1277\n4085\n0.313\nPesky\nJohnny\n1954-09-24\nNA\nNA\n\n\nramirma02\n1232\n3953\n0.312\nRamirez\nManny\n2011-04-06\nNA\nNA\n\n\nlynnfr01\n944\n3062\n0.308\nLynn\nFred\n1990-10-03\nNA\nNA\n\n\ngoodmbi01\n1344\n4399\n0.306\nGoodman\nBilly\n1962-09-30\nNA\nNA\n\n\n\n\n\nWhat cleaning would you still want to do to this table to make it more readable?\nWhat is the difference between left_join(), right_join(), inner_join(), and outer_join()?"
  },
  {
    "objectID": "lessons/lsn_4_r_graphics_I.html",
    "href": "lessons/lsn_4_r_graphics_I.html",
    "title": "MA388 Sabermetrics: Lesson 4",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)"
  },
  {
    "objectID": "lessons/lsn_4_r_graphics_I.html#henry-hank-aaron-1934-2021",
    "href": "lessons/lsn_4_r_graphics_I.html#henry-hank-aaron-1934-2021",
    "title": "MA388 Sabermetrics: Lesson 4",
    "section": "Henry (“Hank”) Aaron (1934-2021)",
    "text": "Henry (“Hank”) Aaron (1934-2021)\n\n\n\nHenry Aaron (Source: New York Times)"
  },
  {
    "objectID": "lessons/lsn_4_r_graphics_I.html#review",
    "href": "lessons/lsn_4_r_graphics_I.html#review",
    "title": "MA388 Sabermetrics: Lesson 4",
    "section": "Review",
    "text": "Review\nKey Concepts\n\nfive tidyverse verbs\nrelational databases\nsplit, apply, combine\n\nReview Question\n\nUsing the Batting data frame, determine who held the home run record by season from 1900 to the present. In other words, produce a table with one row per season indicating who the current career home run leader was in baseball at that time. Add their full name to the table using the People data frame.\n\nHere is one approach:\n\nAdd a column to the Batting data frame indicating each player’s cumulative home runs (hint: cumsum()) at the end of the season.\nWrite a function that takes a data frame and a year as arguments and returns the player with the most career home runs that year or earlier.\nMap the function over the seasons from 1900 to 2021.\nAdd player information from the People data frame.\n\n\n\n\nCareer home run leader by season. yearID indicates the season the record was set.\n\n\nyear\nplayerID\nHRcareer\nyearID\nnameFirst\nnameLast\n\n\n\n\n1900\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1901\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1902\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1903\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1904\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1905\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1906\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1907\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1908\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1909\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1910\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1911\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1912\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1913\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1914\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1915\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1916\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1917\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1918\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1919\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1920\nconnoro01\n138\n1897\nRoger\nConnor\n\n\n1921\nruthba01\n162\n1921\nBabe\nRuth\n\n\n1922\nruthba01\n197\n1922\nBabe\nRuth\n\n\n1923\nruthba01\n238\n1923\nBabe\nRuth\n\n\n1924\nruthba01\n284\n1924\nBabe\nRuth\n\n\n1925\nruthba01\n309\n1925\nBabe\nRuth\n\n\n1926\nruthba01\n356\n1926\nBabe\nRuth\n\n\n1927\nruthba01\n416\n1927\nBabe\nRuth\n\n\n1928\nruthba01\n470\n1928\nBabe\nRuth\n\n\n1929\nruthba01\n516\n1929\nBabe\nRuth\n\n\n1930\nruthba01\n565\n1930\nBabe\nRuth\n\n\n1931\nruthba01\n611\n1931\nBabe\nRuth\n\n\n1932\nruthba01\n652\n1932\nBabe\nRuth\n\n\n1933\nruthba01\n686\n1933\nBabe\nRuth\n\n\n1934\nruthba01\n708\n1934\nBabe\nRuth\n\n\n1935\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1936\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1937\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1938\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1939\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1940\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1941\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1942\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1943\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1944\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1945\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1946\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1947\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1948\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1949\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1950\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1951\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1952\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1953\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1954\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1955\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1956\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1957\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1958\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1959\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1960\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1961\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1962\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1963\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1964\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1965\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1966\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1967\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1968\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1969\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1970\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1971\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1972\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1973\nruthba01\n714\n1935\nBabe\nRuth\n\n\n1974\naaronha01\n733\n1974\nHank\nAaron\n\n\n1975\naaronha01\n745\n1975\nHank\nAaron\n\n\n1976\naaronha01\n755\n1976\nHank\nAaron\n\n\n1977\naaronha01\n755\n1976\nHank\nAaron\n\n\n1978\naaronha01\n755\n1976\nHank\nAaron\n\n\n1979\naaronha01\n755\n1976\nHank\nAaron\n\n\n1980\naaronha01\n755\n1976\nHank\nAaron\n\n\n1981\naaronha01\n755\n1976\nHank\nAaron\n\n\n1982\naaronha01\n755\n1976\nHank\nAaron\n\n\n1983\naaronha01\n755\n1976\nHank\nAaron\n\n\n1984\naaronha01\n755\n1976\nHank\nAaron\n\n\n1985\naaronha01\n755\n1976\nHank\nAaron\n\n\n1986\naaronha01\n755\n1976\nHank\nAaron\n\n\n1987\naaronha01\n755\n1976\nHank\nAaron\n\n\n1988\naaronha01\n755\n1976\nHank\nAaron\n\n\n1989\naaronha01\n755\n1976\nHank\nAaron\n\n\n1990\naaronha01\n755\n1976\nHank\nAaron\n\n\n1991\naaronha01\n755\n1976\nHank\nAaron\n\n\n1992\naaronha01\n755\n1976\nHank\nAaron\n\n\n1993\naaronha01\n755\n1976\nHank\nAaron\n\n\n1994\naaronha01\n755\n1976\nHank\nAaron\n\n\n1995\naaronha01\n755\n1976\nHank\nAaron\n\n\n1996\naaronha01\n755\n1976\nHank\nAaron\n\n\n1997\naaronha01\n755\n1976\nHank\nAaron\n\n\n1998\naaronha01\n755\n1976\nHank\nAaron\n\n\n1999\naaronha01\n755\n1976\nHank\nAaron\n\n\n2000\naaronha01\n755\n1976\nHank\nAaron\n\n\n2001\naaronha01\n755\n1976\nHank\nAaron\n\n\n2002\naaronha01\n755\n1976\nHank\nAaron\n\n\n2003\naaronha01\n755\n1976\nHank\nAaron\n\n\n2004\naaronha01\n755\n1976\nHank\nAaron\n\n\n2005\naaronha01\n755\n1976\nHank\nAaron\n\n\n2006\naaronha01\n755\n1976\nHank\nAaron\n\n\n2007\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2008\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2009\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2010\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2011\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2012\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2013\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2014\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2015\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2016\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2017\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2018\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2019\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2020\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2021\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2022\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2023\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2024\nbondsba01\n762\n2007\nBarry\nBonds\n\n\n2025\nbondsba01\n762\n2007\nBarry\nBonds"
  },
  {
    "objectID": "lessons/lsn_4_r_graphics_I.html#plotting-using-ggplot",
    "href": "lessons/lsn_4_r_graphics_I.html#plotting-using-ggplot",
    "title": "MA388 Sabermetrics: Lesson 4",
    "section": "Plotting using ggplot",
    "text": "Plotting using ggplot\nIn this course, we will use ggplot for graphics. While the code initially seems more complex, ggplot allows us to easily add variables to plots using aesthetics. Here are a few aesthetics ggplot makes available:\n\ncolor\nfill\nlinetype\nlinewidth\nshape\n\n\nLong vs. Wide Format\nWith ggplot, you will typically want data in long format as opposed to wide format. What’s the difference?\n\n# Here are Hank Aaron's and Carl Yastrzemski's HR totals for 1965-70.\ndata_long &lt;- Batting |&gt; \n  filter(yearID &gt;= 1965, \n         yearID &lt;= 1970, \n         playerID %in% c(\"aaronha01\",\"yastrca01\")) |&gt; \n  select(yearID, playerID, HR)\n\n# This data is in long format.\ndata_long |&gt; kable()\n\n\n\n\nyearID\nplayerID\nHR\n\n\n\n\n1965\naaronha01\n32\n\n\n1966\naaronha01\n44\n\n\n1967\naaronha01\n39\n\n\n1968\naaronha01\n29\n\n\n1969\naaronha01\n44\n\n\n1970\naaronha01\n38\n\n\n1965\nyastrca01\n20\n\n\n1966\nyastrca01\n16\n\n\n1967\nyastrca01\n44\n\n\n1968\nyastrca01\n23\n\n\n1969\nyastrca01\n40\n\n\n1970\nyastrca01\n40\n\n\n\n\ndata_wide &lt;- data_long |&gt; \n  pivot_wider(id_cols = playerID, names_from = yearID, values_from = HR)\n\n# This data is in wide format.\ndata_wide |&gt; kable()\n\n\n\n\nplayerID\n1965\n1966\n1967\n1968\n1969\n1970\n\n\n\n\naaronha01\n32\n44\n39\n29\n44\n38\n\n\nyastrca01\n20\n16\n44\n23\n40\n40\n\n\n\n\n\nA basic ggplot has the data frame, aesthetic, and at least one layer. Going back to the Review, let’s plot the number of home runs for the career home run leader by year.\n\nleaders |&gt; \n  ggplot(aes(x = year, \n             y = HRcareer)) +  \n  geom_line()\n\n\n\n\n\n\n\n\nNow, let’s add the player’s name to the plot:\n\nleaders |&gt; \n  ggplot(aes(x = year, \n             y = HRcareer,\n             linetype = nameLast)) + \n  geom_line()\n\n\n\n\n\n\n\n\nNext, let’s change the labels:\n\nleaders |&gt; \n  ggplot(aes(x = as.numeric(year), \n             y = HRcareer,\n             linetype = nameLast)) +  \n  geom_line() +\n  labs(title = \"Home Run Leaders Since 1900\",\n       x = \"Year\", \n       y = \"Home Runs\", \n       linetype = \"Player\")\n\n\n\n\n\n\n\n\n\n\nYour Turn\nUsing the Batting data frame, plot a scatter plot of Hank Aaron’s home runs (\\(y\\)-axis) vs. batting average (\\(x\\)-axis) by season. Color the points in the plot by team name. Change the labels to “Home Runs”, “Batting Average”, and “Team”.\n\n\n\n\n\nHank Aaron’s home runs vs. batting average by year and team."
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html",
    "href": "lessons/lsn_6_runs_and_wins_I.html",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "",
    "text": "library(Lahman)\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(ggrepel)\nlibrary(broom)"
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html#review",
    "href": "lessons/lsn_6_runs_and_wins_I.html#review",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "Review",
    "text": "Review\nWe finished our intro to R! I hope you feel more confident in your ability to work with databases and large data sets.\nMajor concepts:\n\nfive tidyverse verbs\nrelational databases\nsplit, apply, combine data\nplotting in R (ggplot)\n\nToday we begin our formal study of sabermetrics by answering a super important question: how many runs is a win?\nUsing the Teams data frame, plot the number of wins versus run differential (runs scored \\(R\\) - runs allowed \\(RA\\)) for all teams in the 2001 MLB season. Label the teams using the ggrepel package, color the points by lgID, and add a linear model using geom_smooth().\n\nteams2001 &lt;- Teams |&gt; \n  filter(yearID == 2001) |&gt; \n  mutate(RD = R - RA,\n         Wpct = W / G)\n\n\n\n\n\n\nWins vs. Run Differential (2001 MLB season)"
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html#introduction",
    "href": "lessons/lsn_6_runs_and_wins_I.html#introduction",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "Introduction",
    "text": "Introduction\nAt the end of 2001, the Oakland Athletics were losing three star players (Johnny Damon, Jason Giambi, and Jason Isringhausen) to free agency. Their general manager, Billy Beane, had a limited budget to work with as he looked for their replacements. He wanted to find players who were effective at producing runs but were undervalued in the market. At the time, teams used mostly traditional statistics like batting average (BA), home runs (HR), and runs batted in (RBI) to value players. However, evidence from sabermetrics suggested there were better statistics for determining players’ contributions to run scoring. The book Moneyball by Michael Lewis and the film by the same name follow the 2002 Oakland A’s.\nPut yourself in the position of Billy Beane. How would you approach this problem?"
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html#run-differential-and-wins",
    "href": "lessons/lsn_6_runs_and_wins_I.html#run-differential-and-wins",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "Run Differential and Wins",
    "text": "Run Differential and Wins\nIn Figure 1, is a linear model appropriate?\n\n\n\n\n\nIn Figure 1, how many wins are associated with a 100 run differential?\n\n\n\n\n\nA common rule of thumb in baseball is 10 additional net runs over the course of a season equals one additional win. This gives us a convenient way to evaluate the impact of different players and plays.\nTo be more formal, we could use linear regression.\n\\(Wins_i = \\beta_0 + \\beta_1 RD_i + \\epsilon_i \\quad \\epsilon_i \\sim \\text{Normal}(0,\\sigma^2)\\)\nwhere \\(Wins_i\\) and \\(RD_i\\) are the wins and run differential for team \\(i\\).\nInterpret the coefficients in this model.\n\n\n\n\n\n\n# Fit a linear regression model.\nwins_lm = lm(W ~ RD, data = teams2001)\n\n# Summary of linear model.\nwins_lm |&gt; \n  summary()\n\n\nCall:\nlm(formula = W ~ RD, data = teams2001)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.6914 -2.5399  0.2891  3.0442  8.4091 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) 80.93333    0.70715  114.45   &lt;2e-16 ***\nRD           0.10341    0.00598   17.29   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.873 on 28 degrees of freedom\nMultiple R-squared:  0.9144,    Adjusted R-squared:  0.9113 \nF-statistic:   299 on 1 and 28 DF,  p-value: &lt; 2.2e-16\n\n# Print a clean table of results.\nwins_lm |&gt; \n  tidy() |&gt; \n  kable(digits = 2)\n\n\n\n\nterm\nestimate\nstd.error\nstatistic\np.value\n\n\n\n\n(Intercept)\n80.93\n0.71\n114.45\n0\n\n\nRD\n0.10\n0.01\n17.29\n0\n\n\n\n\n\nCalculate the run differential that would typically result in one additional win.\n\n\n\n\n\nBased on the regression model, do you feel confident in your recommended run differential? Explain how you decided.\n\n\n\n\n\nLet’s look at the residuals for this regression. The broom package helps get model results for model diagnostic plots.\n\n# Look at the teams2001 column names before and after running the next line.\nteams2001 = augment(wins_lm, data = teams2001)\n\nteams2001 |&gt;\n  ggplot(aes(x = .fitted, y = .resid)) +\n  geom_point() +\n  geom_text_repel(data = filter(teams2001, abs(.resid) &gt; 7.5),\n                  aes(label = paste(teamID,yearID))) +\n  labs(x = \"Predicted Wins\", \n       y = \"Residuals\")\n\n\n\n\nFigure 2: Residuals vs. Fitted Values of the Linear Model for Wins\n\n\n\n\nWhat units are the residuals in?\n\n\n\n\n\nIn Figure 2, there are two labeled teams with large residuals. Briefly explain why these teams might have large residuals.\n\n\n\n\n\nAbove, we used run differential to predict number of wins. Typically, we use win percentage instead of wins. Does it matter?\nRepeat the above analysis using win percentage instead of wins. Report the run differential that typically results in one additional win."
  },
  {
    "objectID": "lessons/lsn_6_runs_and_wins_I.html#how-many-wins-to-make-the-playoffs",
    "href": "lessons/lsn_6_runs_and_wins_I.html#how-many-wins-to-make-the-playoffs",
    "title": "MA388 Sabermetrics: Lesson 6",
    "section": "How many wins to make the playoffs?",
    "text": "How many wins to make the playoffs?\nLet’s see historically how many wins it takes to make the playoffs. Below, we will look at the five seasons (1997-2001) preceding the 2002 season. First, we need to add a variable playoff to the Teams table, which is an indicator of whether the team made the playoffs (1) or did not make the playoffs (2).\n\n# Get teams in the 1997-2001 seasons.\nmy_teams &lt;- Teams |&gt; \n  filter(yearID &gt;= 1997, yearID &lt;= 2001)\n\n# Obtain a list of teams who made the playoffs by year.\nplayoff_teams &lt;- SeriesPost |&gt; \n  filter(yearID &gt;= 1997, yearID &lt;= 2001) |&gt;\n  select(yearID, teamIDwinner, teamIDloser) |&gt; \n  pivot_longer(-yearID, \n               names_to = \"result\",\n               values_to = \"teamID\") |&gt; \n  select(-result) |&gt; \n  distinct() |&gt; \n  mutate(playoffs = \"yes\")\n\n# Add playoff information to my teams.\nmy_teams = my_teams |&gt; \n  left_join(playoff_teams, by = c(\"yearID\", \"teamID\")) |&gt;\n  mutate(playoffs = replace_na(playoffs, \"no\")) \n\n# Let's check whether we did this correctly.  \n# There should be eight playoff teams each year.\nmy_teams |&gt;\n  count(yearID, playoffs)\n\n   yearID playoffs  n\n1    1997       no 20\n2    1997      yes  8\n3    1998       no 22\n4    1998      yes  8\n5    1999       no 22\n6    1999      yes  8\n7    2000       no 22\n8    2000      yes  8\n9    2001       no 22\n10   2001      yes  8\n\n\nNext, let’s look at the data.\n\nmy_teams |&gt;\n  ggplot(aes(x = W, y = R, color = factor(playoffs))) +\n  geom_point() +\n  labs(x = \"Wins\", \n       y = \"Runs Scored\", \n       color = \"Made Playoffs\",\n       title = \"Wins and Making the Playoffs\") +\n  geom_text_repel(data = filter(my_teams, teamID == \"OAK\"),\n                  aes(x = W, y = R, label = paste(teamID,yearID)),\n                  show.legend = FALSE)\n\n\n\n\n\n\n\n\nBased on the figure above, if you were Billy Beane, how many wins should you shoot for in order to have a good chance of making the playoffs?\n\n\n\n\n\nBesides visual inspection, list methods you could use to assess whether a team will make the playoffs based on number of wins."
  },
  {
    "objectID": "lessons/lsn_9_runs_expectancy_matrix.html",
    "href": "lessons/lsn_9_runs_expectancy_matrix.html",
    "title": "MA388 Sabermetrics: Lesson 9",
    "section": "",
    "text": "library(tidyverse)\nlibrary(Lahman)\nlibrary(knitr)\nlibrary(ggrepel)\nlibrary(broom)"
  },
  {
    "objectID": "lessons/lsn_9_runs_expectancy_matrix.html#review",
    "href": "lessons/lsn_9_runs_expectancy_matrix.html#review",
    "title": "MA388 Sabermetrics: Lesson 9",
    "section": "Review",
    "text": "Review\nLast lesson, we discussed the following three models:\n\\[\\begin{align}\nWpct &= \\beta_0 + \\beta_1 RD + \\epsilon \\\\\nWpct &= \\frac{R^2}{R^2 + RA^2} + \\epsilon \\\\\nWpct &= \\frac{R^k}{R^k + RA^k} + \\epsilon\n\\end{align}\\]\n\nDetermine the value of \\(k\\) in the third model for the 2018 season.\nCalculate the predicted wins for each team in 2018 and plot the residuals vs. the predicted values.\n\n\n\n\n\n\nPythagorean predictions (2018)"
  },
  {
    "objectID": "lessons/lsn_9_runs_expectancy_matrix.html#value-of-plays",
    "href": "lessons/lsn_9_runs_expectancy_matrix.html#value-of-plays",
    "title": "MA388 Sabermetrics: Lesson 9",
    "section": "Value of Plays",
    "text": "Value of Plays\nUsing the 10-runs-per-win rule of thumb (or more precise estimates using the other models), we now have a nice way of converting runs to wins. This leads to our next obvious question – how do we score runs? Simply put, players make plays, and sometimes those plays lead to runs. It’s time to assess how many runs players and plays are worth.\n\nRun Expectancy Matrix\n* The first step is to calculate the run expectancy matrix. The run expectancy matrix tells us the average number of runs scored in the remainder of an inning for each state (runner/out combination) of an inning.\nThe state of the game consists of four digits. The first three digits indicate the location of runners on base. The last digit indicates the number of outs.\nExamples:\n\n“000 0” - no runners on base; no outs\n“111 2” - bases loaded; two outs\n“010 1” - runner on second base; one out\n\n\n\n\nRun Expectancy Matrices (source: http://tangotiger.net/re24.html)\n\n\nHow do we interpret the values in the matrix?\n\n\n\n\n\nDo you see any trends over time?\n\n\n\n\n\nWe are looking at run expectancy matrices. There is another type of matrix called a run probability matrix. Explain how they differ.\n\n\n\n\n\n\n\nRun Expectancy Matrix from Retrosheet Data\nTypically, we use Retrosheet play-by-play data to calculate the run expectancy matrix. Below, we will calculate it for 2011 using the code from our textbook.\n\n# Import Retrosheet play-by-play data from our textbook site.\n\nsite = \"https://raw.githubusercontent.com/maxtoki/baseball_R/\"\nfields &lt;- read_csv(file = paste(site, \"master/data/fields.csv\", sep =\"\"))\nretro2011 &lt;- read_csv(file = paste(site, \"master/data/all2011.csv\", sep = \"\"),\n                    col_names = pull(fields, Header),\n                    na = character())\ncolnames(retro2011) &lt;- tolower(colnames(retro2011))\n\nThis data frame contains one line for every play in the 2011 season. There are approximately 200,000 lines in this data set.\n\nretro2011 |&gt; \n  select(game_id, away_team_id, inn_ct, outs_ct,\n         bat_id, pit_id, event_cd) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\ngame_id\naway_team_id\ninn_ct\nouts_ct\nbat_id\npit_id\nevent_cd\n\n\n\n\nANA201104080\nTOR\n1\n0\ndavir003\nsante001\n2\n\n\nANA201104080\nTOR\n1\n1\nnix-j001\nsante001\n2\n\n\nANA201104080\nTOR\n1\n2\nbautj002\nsante001\n3\n\n\nANA201104080\nTOR\n1\n0\niztum001\ndrabk001\n14\n\n\nANA201104080\nTOR\n1\n0\nkendh001\ndrabk001\n3\n\n\nANA201104080\nTOR\n1\n1\nabreb001\ndrabk001\n6\n\n\nANA201104080\nTOR\n1\n2\nabreb001\ndrabk001\n14\n\n\nANA201104080\nTOR\n1\n2\nhuntt001\ndrabk001\n20\n\n\nANA201104080\nTOR\n1\n2\nwellv001\ndrabk001\n2\n\n\nANA201104080\nTOR\n2\n0\nlinda001\nsante001\n2\n\n\n\n\n\nTo understand what happened in this game, we’ll need to know what all the event codes are for various baseball outcomes described by the event_cd field.\n\n\n\nEvent codes\n\n\nIf we further consider the event_tx and pitch_seq_tx fields, we can more comprehensively reconstruct each at-bat. Let’s try to describe what happened in the first inning of this game. We’ll need to know the position numbers to interpret the event text strings.\n\n\n\nBaseball Position Numbers\n\n\n\n\nretro2011 |&gt; \n  select(inn_ct, outs_ct,\n         bat_id, pit_id, pitch_seq_tx, event_tx) |&gt; \n  head(10) |&gt; \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\ninn_ct\nouts_ct\nbat_id\npit_id\npitch_seq_tx\nevent_tx\n\n\n\n\n1\n0\ndavir003\nsante001\nFBSX\n9/F\n\n\n1\n1\nnix-j001\nsante001\nX\n9/F\n\n\n1\n2\nbautj002\nsante001\nCBCS\nK\n\n\n1\n0\niztum001\ndrabk001\nCBBBB\nW\n\n\n1\n0\nkendh001\ndrabk001\nBCSBS\nK\n\n\n1\n1\nabreb001\ndrabk001\nCBB1&gt;S\nCS2(26)\n\n\n1\n2\nabreb001\ndrabk001\nCBB1&gt;S.FBFB\nW\n\n\n1\n2\nhuntt001\ndrabk001\nCCX\nS9/L.1-H(E9/TH)(UR)(NR);B-3\n\n\n1\n2\nwellv001\ndrabk001\nBX\n63/G\n\n\n2\n0\nlinda001\nsante001\nCBBFX\n3/L-\n\n\n\n\n\n\n\n\nCalculate the Run Expectancy Matrix\nThe textbook provides the code below to generate the run expectancy matrix.\n\nretro2011 &lt;- retro2011 |&gt; \n  mutate(runs_before = away_score_ct + home_score_ct,\n         half_inning = paste(game_id, inn_ct, bat_home_id),\n         runs_scored = \n           (bat_dest_id &gt; 3) + (run1_dest_id &gt; 3) + \n           (run2_dest_id &gt; 3) + (run3_dest_id &gt; 3))\n\nhalf_innings &lt;- retro2011 |&gt;\n  group_by(half_inning) |&gt;\n  summarize(outs_inning = sum(event_outs_ct),\n            runs_inning = sum(runs_scored),\n            runs_start = first(runs_before),\n            max_runs = runs_inning + runs_start)\n\nretro2011 &lt;- retro2011 |&gt;\n  inner_join(half_innings, by = \"half_inning\") |&gt;\n  mutate(runs_roi = max_runs - runs_before)\n\nretro2011 &lt;- retro2011 |&gt;\n  mutate(bases = \n           paste(ifelse(base1_run_id &gt; '',1,0),\n                 ifelse(base2_run_id &gt; '',1,0),\n                 ifelse(base3_run_id &gt; '',1,0), sep = \"\"),\n         state = paste(bases, outs_ct))\n\nretro2011 &lt;- retro2011 |&gt;\n  mutate(is_runner1 =\n           as.numeric(run1_dest_id==1 | bat_dest_id == 1),\n         is_runner2 = \n           as.numeric(run1_dest_id == 2 | run2_dest_id == 2 |\n                        bat_dest_id == 2),\n         is_runner3 = \n           as.numeric(run1_dest_id == 3 | run2_dest_id == 3 |\n                        run3_dest_id == 3 | bat_dest_id == 3),\n         new_outs = outs_ct + event_outs_ct,\n         new_bases = paste(is_runner1,is_runner2, is_runner3, sep = \"\"),\n         new_state = paste(new_bases, new_outs))\n\n\n\nretro2011 &lt;- retro2011 |&gt;\n  filter((state != new_state) | (runs_scored &gt; 0))\n\nretro2011_complete &lt;- retro2011 |&gt;\n  filter(outs_inning == 3)\n\nerm_2011 &lt;- retro2011_complete |&gt;\n  group_by(bases, outs_ct) |&gt; # same as grouping by state\n  summarize(mean_run_value = mean(runs_roi))\n\nerm_2011_wide &lt;- erm_2011 |&gt; \n  pivot_wider(\n    names_from = outs_ct, \n    values_from = mean_run_value, \n    names_prefix = \"Outs=\"\n  )\n\nwrite_csv(erm_2011_wide, \"erm_2011_wide.csv\")\n\nerm_2011_wide |&gt; kable()\n\n\n\n\nbases\nOuts=0\nOuts=1\nOuts=2\n\n\n\n\n000\n0.4711649\n0.2546956\n0.0971845\n\n\n001\n1.4543568\n0.9374359\n0.3173913\n\n\n010\n1.0582804\n0.6501976\n0.3091673\n\n\n011\n1.9304897\n1.3388641\n0.5407407\n\n\n100\n0.8350992\n0.4960492\n0.2179536\n\n\n101\n1.7526998\n1.1496169\n0.4882597\n\n\n110\n1.4144549\n0.8739176\n0.4222569\n\n\n111\n2.1718266\n1.4745146\n0.7610094\n\n\n\n\n\nNow we use this expected run table to determine the value of every event.\n\nretro2011 &lt;- retro2011 |&gt; \n  left_join(erm_2011, join_by(\"bases\", \"outs_ct\")) |&gt; \n  rename(rv_start = mean_run_value) |&gt; \n  left_join(\n    erm_2011, \n    join_by(new_bases == bases, new_outs == outs_ct)\n  ) |&gt; \n  rename(rv_end = mean_run_value) |&gt; \n  replace_na(list(rv_end = 0)) |&gt; \n  mutate(run_value = rv_end - rv_start + runs_scored)\n\nNote the code above also adds some very useful columns to the play-by-play data related to the state and run expectancy at the start and end of each play.\n\nretro2011 |&gt; \n select(bat_id, event_cd, state, rv_start,\n        new_state, rv_end, runs_scored, run_value) |&gt;\n  head(10) |&gt; \n  kable(digits = 3)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nbat_id\nevent_cd\nstate\nrv_start\nnew_state\nrv_end\nruns_scored\nrun_value\n\n\n\n\ndavir003\n2\n000 0\n0.471\n000 1\n0.255\n0\n-0.216\n\n\nnix-j001\n2\n000 1\n0.255\n000 2\n0.097\n0\n-0.158\n\n\nbautj002\n3\n000 2\n0.097\n000 3\n0.000\n0\n-0.097\n\n\niztum001\n14\n000 0\n0.471\n100 0\n0.835\n0\n0.364\n\n\nkendh001\n3\n100 0\n0.835\n100 1\n0.496\n0\n-0.339\n\n\nabreb001\n6\n100 1\n0.496\n000 2\n0.097\n0\n-0.399\n\n\nabreb001\n14\n000 2\n0.097\n100 2\n0.218\n0\n0.121\n\n\nhuntt001\n20\n100 2\n0.218\n001 2\n0.317\n1\n1.099\n\n\nwellv001\n2\n001 2\n0.317\n001 3\n0.000\n0\n-0.317\n\n\nlinda001\n2\n000 0\n0.471\n000 1\n0.255\n0\n-0.216\n\n\n\n\n\n\nlibrary(baseballr) #the appendix does not tell you that you need this. \n\nretro_data&lt;-retrosheet_data(years=2022)\nretro2022 &lt;- retro_data |&gt;\npluck(\"2022\") |&gt;\npluck(\"events\")\nroster2022 &lt;- retro_data |&gt;\npluck(\"2022\") |&gt;\npluck(\"rosters\")\nroster2022_clean&lt;-roster2022 |&gt;\nselect(player_id,last_name,first_name) |&gt;\nrename(bat_id=player_id) |&gt; \n  distinct()\n\nstats&lt;-retro2022 |&gt; #I split the code chunk so I don't have to do the slow step every time I run it\nselect(bat_id,event_cd,bat_home_id) |&gt; #grab only the columns I want\nfilter(event_cd&gt;=20|event_cd==2|event_cd==3) |&gt; #events &gt;= 20 are hits, 2+3 are out/strikeout\ngroup_by(bat_id,bat_home_id) |&gt;\nmutate(\nhit=if_else(event_cd&gt;=20,1,0), #if play event was hit make it 1 if not 0\nab=1, #all of these are ABs, making them 1 to sum later\nhome_away=if_else(bat_home_id==1,\"Home\",\"Away\"))\n\nplayer_stats&lt;-stats |&gt;\ngroup_by(bat_id,home_away) |&gt;\nsummarize(AB=sum(ab),H=sum(hit),AVG=H/AB) |&gt;\nfilter(AB&gt;=100) #filter out players with &lt;100 ABs\n\nplayer_home_v_away&lt;-player_stats |&gt;\nselect(bat_id,home_away,AVG) |&gt;\npivot_wider(id_cols = bat_id,\nnames_from = home_away,\nvalues_from=AVG,\n)\n\nroster2022 |&gt; count(player_id) |&gt; arrange(-n)\n\n# A tibble: 1,495 × 2\n   player_id     n\n   &lt;chr&gt;     &lt;int&gt;\n 1 chany001      4\n 2 fordm002      4\n 3 abrea001      3\n 4 banda001      3\n 5 canor001      3\n 6 chavj001      3\n 7 duggs001      3\n 8 fairs001      3\n 9 gonzc002      3\n10 keucd001      3\n# ℹ 1,485 more rows\n\nplayer_home_v_away&lt;-player_home_v_away |&gt;\nleft_join(roster2022_clean,by=\"bat_id\")\nplayer_home_v_away |&gt;\nmutate(Difference=abs(Home-Away)) |&gt;\narrange(Difference) |&gt;\nhead(10) |&gt;\nselect(last_name,first_name,Difference)\n\n# A tibble: 10 × 4\n# Groups:   bat_id [10]\n   bat_id   last_name  first_name Difference\n   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;\n 1 darnt001 d'Arnaud   Travis       0       \n 2 vierm001 Vierling   Matt         0.000149\n 3 andre001 Andrus     Elvis        0.000569\n 4 wendj002 Wendle     Joey         0.000605\n 5 santc002 Santana    Carlos       0.00110 \n 6 merrw001 Merrifield Whit         0.00151 \n 7 heimj001 Heim       Jonah        0.00156 \n 8 smitp002 Smith      Pavin        0.00192 \n 9 estrt001 Estrada    Thairo       0.00196 \n10 rizza001 Rizzo      Anthony      0.00208"
  }
]